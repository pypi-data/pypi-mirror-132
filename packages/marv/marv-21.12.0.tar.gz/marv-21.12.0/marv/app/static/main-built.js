/*!
 * Copyright 2016 - 2021  Ternaris.
 * SPDX-License-Identifier: AGPL-3.0-only
 */

const t=Symbol("uuid"),e=Symbol("watcher"),s=Symbol("watched");let n=0;class i{constructor(t,e,s,n){this.keys=t,this.get=e,this.set=s,this.notify=n}}function r(...t){let e=t,s=t.pop(),n=null,r=null;return"object"==typeof s&&(e=s.keys?s.keys:t,r=s.notify?s.notify:null,n=s.set,s=s.get),new i(e,s,n,r)}function o(t){return t instanceof g||t instanceof f}function c(t,n,i,r,u=0){const h=t[s][n];if(h){const t=o(i),s=o(r);for(const[o,{origin:d,subtree:m}]of Object.entries(h)){t&&m._hasLeaf&&l(i.instance,d,m,o),s&&m._hasLeaf&&a(r.instance,d,m,o);const{target:h,property:f}=d,p=h[e][f];p.cached&&(p.cached=!1,p.notify&&p.notify(h,n,i,r),c(h,f,null,null,u+1))}}}function a(t,n,i,r){const c=t[s];for(let s in i){const l=i[s],u=`${r}.${s}`;if(c[s]||(c[s]={}),c[s][u])c[s][u].ref++;else if(c[s][u]={ref:1,origin:n,subtree:l},l._hasLeaf)if("@each"===s)for(let e=0,s=t.length;e<s;e++){const s=t[e];o(s)&&a(s.instance,n,l,u)}else{const i=t[e][s],r=i?i.value:t[s];o(r)&&a(r.instance,n,l,u)}}}function l(t,n,i,r){const c=t[s];for(let s in i){const a=i[s],u=`${r}.${s}`;if(!--c[s][u].ref&&(delete c[s][u],a._hasLeaf))if("@each"===s)for(let e=0,s=t.length;e<s;e++){const s=t[e];o(s)&&l(s.instance,n,a,u)}else{const i=t[e][s],r=i?i.value:t[s];o(r)&&l(r.instance,n,a,u)}}}const u={};function h(t){const e=t.join("");if(!u[e]){const s={};Object.defineProperty(s,"_hasLeaf",{value:!1,enumerable:!1,writable:!0}),t.forEach((t=>{const e=t.split(".");let n=s;for(let t=0,s=e.length;t<s;t++){const s=e[t];n._hasLeaf=!0,n[s]||(n[s]={},Object.defineProperty(n[s],"_hasLeaf",{value:!1,enumerable:!1,writable:!0})),n=n[s]}})),u[e]=s}return u[e]}const d={push(t){return this.splice(this.length,0,t)},pop(){return this.splice(this.length-1,1)},unshift(t){return this.splice(0,0,t)},shift(){return this.splice(0,1)},splice(t,e,...n){const i=this.instance,r=Array.from(i.splice.apply(i,arguments)),u=i[s]["@each"];if(u)for(const[t,{subtree:e,origin:s}]of Object.entries(u))e._hasLeaf&&(r.forEach((n=>{o(n)&&l(n.instance,s,e,t)})),n.forEach((n=>{o(n)&&a(n.instance,s,e,t)})));c(i,"@each",r,n),c(i,"includes",r,n);const h=n.length-r.length;return h&&c(i,"length",i.length-h,i.length),r}},m={set(t,e,s){const n=t[e];return n!==s&&(t[e]=s,c(t,Number.isFinite(+e)?"@each":e,n,s),c(t,Number.isFinite(+e)?"includes":e,n,s)),!0},get:(t,e,s)=>"instance"===e?t:"string"==typeof e&&"-"===e[0]?Reflect.get(t,+e+t.length,s):d[e]||t[e]};class f extends Array{constructor(){return super(),Object.defineProperties(this,{[e]:{enumerable:!1,value:{}},[s]:{enumerable:!1,value:{}},[t]:{enumerable:!1,value:n++},instance:{enumerable:!1,get(){throw new Error("Attempted instance access")}}}),new Proxy(this,m)}static create(t){return t instanceof Array?f.from(t):new f}}const p={deleteProperty:(s,n)=>n in s[e]?(function(s,n){const i=s[e][n];console.assert(i,`${n} is not defined on ${s.__oid__}`);const r={target:s,property:n,wdesc:i};i.keys.length&&l(s,r,h(i.keys),`${s[t]}:${n}`),delete s[e][n],delete s[n]}(s,n),!0):Reflect.deleteProperty(s,n),get:(t,e,s)=>"instance"===e?t:Reflect.get(t,e,s),set(n,r,o,l){if(o instanceof i)!function(n,i,r){n[e][i]={keys:r.keys,value:null,cached:!1,notify:r.notify};const o=n[e][i];Object.defineProperty(n,i,{get(){if(!o.cached){const t=o.value;if(o.value=r.get.apply(this),o.value instanceof Promise){const t=o.promise=o.value;o.promise.then((e=>{t===o.promise&&(o.value=e,c(n,i,o.promise,o.value),o.cached=!0)}),(e=>{t===o.promise&&(o.value={error:e},c(n,i,o.promise,o.value),o.cached=!0)}))}c(n,i,t,o.value),o.cached=!0}return o.value},set(t,...s){r.set&&r.set.call(this,t,...s);const n=this[e][i];n.cached=!0,n.value=t},configurable:!0,enumerable:!0}),r.keys.length&&a(n,{target:n,property:i,wdesc:o},h(r.keys),`${n[t]}:${i}`),n[s][i]&&c(n,i,null,null)}(n,r,o);else{if(n[s][r]){const t=n[r];if(t===o)return!0;c(n,r,t,o)}Reflect.set(n,r,o,l)}return!0}};class g{constructor(){return Object.defineProperties(this,{[e]:{enumerable:!1,value:{}},[s]:{enumerable:!1,value:{}},[t]:{enumerable:!1,value:n++},instance:{enumerable:!1,get(){throw new Error("Attempted instance access")}}}),new Proxy(this,p)}init(){}dispose(){}static create(t){const e=Object.assign(new this,t);return e.init(),e}getOwner(){return this.__owner__}get __oid__(){return`${this.constructor.name}(${this[t]})`}}class x extends g{constructor(){super()}subscope(t){return t.parent=this,x.create(t)}createUpdater(t,e,s,n,i){console.assert(4===n.type,"expr type should be binding"),e.updaters.push([this,s]);let o=!0;this[s]=r({get(){const t=n.func.apply(this);i.apply(this,[t,o]),o=!1},set:null,keys:n.keys,notify:()=>{t.__dirty__.push([this,s,e.depth]),t.getOwner().asyncEvent((()=>{}))()}}),this[s]}}function y(t,e,s,n,i,o,c,a,l,u){if(console.assert(i.ctx===a),console.assert(c===a.__owner__),0===s[0]){const[,r,c]=s;t.leafs.push(e);const u=n.createTextNode("");l.appendChild(u);const h={type:4,keys:Array.from(new Set(c.map((t=>t[2])).flat())),func(){for(let t=0,e=c.length;t<e;t++){const e=c[t];if(null===e[1])return t;if(a.template[1][e[1]].apply(this))return t}return-1}};i.createUpdater(o,e,`${e.prefix}-condition`,h,((t,s)=>{if(e.branch!==t){e.unrender(!0),e.branch=t;const n=r[e.branch];n&&(s?w(e,n,i,u.parentNode,null):e.renderEnter(n,i,u))}}))}else if(1===s[0]){const[,r,c,u,h]=s;t.leafs.push(e);const d=n.createTextNode("");l.appendChild(d);const m=c[0]||"__itemname__",f=c[1]||"__indexname__",p=[];i.createUpdater(o,e,`${e.prefix}-loop`,{type:4,func:a.template[1][r[0]],keys:r[1].map((t=>`${t}.@each`))},((t,s)=>{if(t&&t.length){if(1===e.leafs.length&&h)e.unrender(!0);else if(e.leafs.length){for(let s=t.length*u.length,n=e.leafs.length;s<n;s++)e.leafs[s].unrender(!0,!0);e.leafs.splice(t.length*u.length,e.leafs.length-t.length*u.length),p.splice(t.length,p.length-t.length)}for(let e=p.length,s=t.length;e<s;e++){const s=x.create({parent:i,[m]:t[e],[f]:e,ctx:i.ctx});p.push(s)}for(let e=0,s=t.length;e<s;e++){const s=o.__dirty__.length;p[e][m]=t[e];const n=o.__dirty__.slice(s);o.__dirty__.splice(s,o.__dirty__.length-s),n.forEach((([t,e])=>t[e]))}for(let n=e.leafs.length/u.length,i=t.length;n<i;n++)s?w(e,u,p[n],d.parentNode,d):e.renderEnter(u,p[n],d)}else p.length&&(p.splice(0,p.length),e.unrender(!0)),h&&!e.leafs.length&&(s?w(e,h,i,d.parentNode,d):e.renderEnter(h,i,d));const n=d;e.getElements().forEach((t=>d.parentNode.insertBefore(t,n)))}))}else if(3===s[0]&&"m-slot"===s[1]){const c=s[2];t.leafs.push(e);const u=c.find((t=>"name"===t[0])),h=u?u[1]:"default",d=n.createTextNode("");l.appendChild(d),i.createUpdater(o,t,`${t.prefix}-slot${h}`,{type:4,keys:[`ctx.__slots__.${h}`],func(){return this.ctx.__slots__[h]}},(t=>{if(e.component&&e.unrender(!0),t&&"Embed"===t.type){let s=t.scope;return t.as=t.as??"__embedder__",t.as&&(s=s.subscope({ctx:s.ctx,[t.as]:g.create(Object.fromEntries(c.map((t=>{let e=t[0],s=t[1];return":"===e[0]&&(e=e.slice(1),s=r({get:()=>a.template[1][t[1]].apply(i),set:null,keys:t[2]})),[e,s]}))))}),s[t.as].ctx=i.ctx),void w(e,t.content,s,d.parentNode,d)}e.component=t,t&&(Object.assign(t,{__doc__:n,__owner__:a.__owner__,leaf:e}),w(e,e.component.__ast__,e.component.scope,d.parentNode,d),e.component.__render__())}))}else if(3===s[0]&&/-/.test(s[1])){const[,c,h,d,m]=s;t.leafs.push(e);const f=g.create({});m.forEach((t=>{let e="default";if(3===t[0]){const s=t[2].find((t=>"into"===t[0]));s&&(e=s[1])}e in f||(f[e]={type:"Embed",content:[],scope:i,as:d[0]}),f[e].content.push(t)}));const p={__doc__:n,__owner__:a.__owner__,__slots__:f,scope:i.subscope({}),leaf:e};h.forEach((t=>{const e=t[0];if(console.assert(!["class",":class"].includes(e)),":"!==e[0])p[e]=t[1];else{if(2===t.length)return void(p[e.slice(1)]=r((function(){const e=new g;return Object.defineProperty(e,"scope",{value:i}),t[1].forEach((t=>{1!==t.length?1===t[1].length?e[t[0][0]]=t[1][0]:e[t[0][0]]=r({get(){return a.template[1][t[1][0]].apply(this.scope)},keys:t[1][1].map((t=>`scope.${t}`))}):Object.keys(a.template[1][t[0][0]].apply(i)).forEach((s=>{e[s]=r({get:()=>a.template[1][t[0][0]].apply(i)[s],keys:[`scope.${t[0][1]}.${s}`]})}))})),e})));p[e.slice(1)]=r({get(){return a.template[1][t[1]].apply(this.scope.parent)},keys:t[2].map((t=>`scope.parent.${t}`))})}}));const x=t=>{e.component=t.create(p),w(e,e.component.__ast__,e.component.scope,l,u),e.component.__render__()},y=h.find((t=>":component"===t[0]));if(y){const t={type:4,func:a.template[1][y[1]],keys:y[2]};i.createUpdater(o,e,`${e.prefix}-component`,t,((t,s)=>{const n=a.getOwner().components[t];if(!n)throw new Error(`Component ${t} does not exist`);s||(u=e.getElements().slice(-1)[0].nextSibling,e.unrender(!0)),x(n)}))}else{const t=h.find((t=>"component"===t[0])),e=t?t[1]:c,s=a.getOwner().components[e];if(!s)throw new Error(`Component ${e} does not exist`);x(s)}}else if(2===s[0]){const[,i]=s;t.leafs.push(e),e.elements=[n.createTextNode(i)],l.insertBefore(e.elements[0],u)}else if(3===s[0]){const[,r,c,,h]=s;t.leafs.push(e),e.elements=[n.createElement(r)],l.insertBefore(e.elements[0],u);for(let t=0,s=c.length;t<s;t++){const s=c[t];console.assert("classes"!==s[0]),console.assert(":classes"!==s[0]);const n=s[0];if("@"===n[0]){e.elements[0].addEventListener(n.slice(1),i.ctx.getOwner().asyncEvent((t=>a.template[1][s[1]].call(i,t))),!1);const t=i.ctx.getOwner().actions.id++;e.elements[0].setAttribute(`data-action${n.slice(1)}`,t)}else if(":"!==n[0])"class"===n?s[1].split(" ").forEach((t=>e.elements[0].classList.add(t))):e.elements[0].setAttribute(n,s[1]);else{const t=n.slice(1);"class"===t&&2===s.length?s[1].forEach(((s,n)=>{if(1===s.length){const r={type:4,func:a.template[1][s[0][0]],keys:s[0][1]};return void i.createUpdater(o,e,`${e.prefix}-${t}-clskey${n}`,r,(s=>{"string"==typeof s&&(s=Object.fromEntries(s.split(" ").map((t=>[t,1]))),Object.keys(s).forEach((t=>e.elements[0].classList.add(t)))),Object.entries(s??{}).forEach((([c,a],l)=>{a&&e.elements[0].classList.add(c),i.createUpdater(o,e,`${e.prefix}-${t}-clskey${n}-${l}`,{type:4,func:()=>s[c],keys:[`${r.keys[0]}.${c}`]},(t=>{t?e.elements[0].classList.add(c):e.elements[0].classList.remove(c)}))}))}))}let r=s[0][0],c=s[1][0];1===s[0].length?r=s[0][0]:i.createUpdater(o,e,`${e.prefix}-${t}-clskey${n}`,{type:4,func:a.template[1][s[0][0]],keys:s[0][1]},(t=>{c&&(r&&e.elements[0].classList.remove(r),t&&e.elements[0].classList.add(t)),r=t})),1===s[1].length?c=s[1][0]:i.createUpdater(o,e,`${e.prefix}-${t}-clsvalue${n}`,{type:4,func:a.template[1][s[1][0]],keys:s[1][1]},(t=>{r&&(c&&e.elements[0].classList.remove(r),t&&e.elements[0].classList.add(r)),c=t})),r&&c&&e.elements[0].classList.add(r)})):i.createUpdater(o,e,`${e.prefix}-${t}`,{type:4,func:a.template[1][s[1]],keys:s[2]},(s=>{":html"===t?e.elements[0].innerHTML=(null==s?void 0:s.content)??s??"":":text"===t?e.elements[0].textContent=s:void 0!==s&&!1!==s?e.elements[0].setAttribute(t,s):e.elements[0].removeAttribute(t)}))}}w(e,h,i,e.elements[0],null)}else{console.assert(4===s[0],`neither ${s[0]} !== Binding`),s={type:s[0],func:a.template[1][s[1]],keys:s[2]},t.leafs.push(e),e.elements=[n.createTextNode("")],l.insertBefore(e.elements[0],u);let r=0;i.createUpdater(o,e,`${e.prefix}-content`,s,(t=>{const s=e.elements;if(t instanceof class{constructor(t){this.content=t}}){const i=n.createElement("div");i.innerHTML=t.content,e.elements=Array.from(i.children),e.elements.length||(e.elements=[n.createTextNode("")]),e.elements.forEach((t=>s[0].parentNode.insertBefore(t,s[0]))),s.forEach((t=>t.remove())),r=0}else(void 0===t||t instanceof Promise)&&(t=""),1!==r?(e.elements=[n.createTextNode(t)],s[0].parentNode.insertBefore(e.elements[0],s[0]),s.forEach((t=>t.remove())),r=1):e.elements[0].textContent=t}))}}function w(t,e,s,n,i){const r=s.ctx,o=r.__owner__,c=r.__doc__,{rootNode:a}=o;for(let l=0,u=e.length;l<u;l++){const u=e[l];y(t,new v(o,t.depth+1,`${t.prefix}-${l}`),u,c,s,a,o,r,n,i)}}class v{constructor(t,e,s){this.owner=t,this.depth=e,this.prefix=s,this.updaters=[],this.leafs=[],this.elements=null,this.component=null}render(t){console.assert(this.component,"Render should only be called on leafs having component"),w(this,this.component.__ast__,this.component.scope,t,null),this.component.__render__()}renderEnter(t,e,s){const n=s.ownerDocument.createDocumentFragment();w(this,t,e,n,null);const i=[];Array.from(n.children).forEach((t=>{t.classList&&t.classList.contains("m-animate")&&i.push(t)})),i.length&&i.forEach((t=>{t.classList.add("m-animating","m-enter-from");const e=new g;e.owner=this.owner;let s=0;e.enter=r({get(){0===s&&(t.classList.remove("m-enter-from"),t.classList.add("m-enter-to")),s++},notify:()=>{this.owner.rootNode.__dirty__.push([e,"enter",this.depth]),this.owner.asyncEvent((()=>{}))()},keys:["owner.now"]});const n=e=>{e.target===t&&(t.classList.remove("m-animating","m-enter-to"),t.removeEventListener("transitionend",n))};t.addEventListener("transitionend",n,!1),this.owner.rootNode.__dirty__.push([e,"enter",this.depth]),this.owner.asyncEvent((()=>{}))()})),s.parentNode.insertBefore(n,s)}notifyUnrender(){this.component&&(this.component.__unrender__(),this.component.__route__||this.component.dispose(),this.component=null)}unrender(t,e){let s=[];if(t&&(s=this.getElements()),t&&!e||(this.updaters.forEach((([t,e])=>delete t[e])),this.updaters=[]),this.component&&this.notifyUnrender(),this.leafs.forEach((t=>t.unrender())),this.leafs=[],t){const t=[];s.forEach((e=>{e.classList&&e.classList.contains("m-animate")?t.push(e):e.remove()})),t.length&&t.forEach((t=>{t.classList.add("m-animating","m-leave-from");const e=new g;e.owner=this.owner;let s=0;e.leave=r({get(){0===s&&(t.classList.remove("m-leave-from"),t.classList.add("m-leave-to")),s++},notify:()=>{this.owner.rootNode.__dirty__.push([e,"leave",this.depth]),this.owner.asyncEvent((()=>{}))()},keys:["owner.now"]});const n=e=>{e.target===t&&(t.removeEventListener("transitionend",n),t.remove())};t.addEventListener("transitionend",n,!1),this.owner.rootNode.__dirty__.push([e,"leave",this.depth]),this.owner.asyncEvent((()=>{}))()}))}}getElements(){return this.elements?this.elements:(this.component&&console.assert(this.component.leaf===this),this.leafs.reduce(((t,e)=>t.concat(e.getElements())),[]))}}class b extends g{constructor(){super(),this.template=null,this.__ast__=r((function(){return this.template?JSON.parse(this.template[0]):[]})),this.__dirty__=null,this.__inDOM__=!1,this.__slots__=new g}init(){super.init(),this.scope.ctx=this}dispose(){console.assert(!this.__inDOM__,`component ${this.__oid__} should be unrenderd before dispose`),console.assert(!this.__component_disposed__,`component ${this.__oid__} was already disposed`),this.__component_disposed__=!0,super.dispose()}initializeLeaf(){this.__dirty__=[],this.leaf=new v(this.getOwner(),0,"watch"),this.leaf.component=this}__render__(){console.assert(!this.__inDOM__,`Element ${this.__oid__} should not be in DOM for render`),this.__inDOM__=!0,this.didInsertElement()}__unrender__(){console.assert(this.__inDOM__,`Element ${this.__oid__} should be in DOM for unrender`),this.willRemoveElement(),this.__inDOM__=!1}didInsertElement(){}willRemoveElement(){}getElements(){return this.leaf.getElements()}getElement(){for(const t of this.leaf.getElements())if(1===t.nodeType)return t}update(){const t=this.__dirty__;this.__dirty__=[],t.sort(((t,e)=>t[2]<=e[2]?-1:1));for(let e=0,s=t.length;e<s;e++)t[e][0][t[e][1]]}}class M extends b{constructor(){super(),this.scope=x.create(),this.__route__=!0}redirect(){}error(){}loading(){}didEnter(){}didLeave(){}willTransition(){}transitionTo(t){this.getOwner().router.transitionTo(t)}}class k extends b{constructor(){super(),this.template=[JSON.stringify([[3,"a",[[":href",0,["ctx.chref"]],[":class",1,["ctx.cclass"]]],[],[[3,"m-slot",[],[],[]]]]]),[function(){return this.ctx.chref},function(){return this.ctx.cclass}]],this.chref=r("href","__owner__.router.currentQueryString",(function(){const t=this.__owner__.router.currentQueryString;return`${window.location.pathname}${t?`?${t}`:""}#/${this.href}`})),this.cclass=r("__owner__.router.currentLocation","href","classes",(function(){return`${this.classes||""} ${this.getOwner().router.currentLocation===`#/${this.href}`?"is-active":""}`.trim()}))}}class _ extends g{constructor(){super(),this.ilen=0,this.olen=0,this.ops=f.create()}static fromJSON(t){const e=this.create();for(let s of t)switch(s.t){case"n":e.retain(s.n);break;case"i":e.insert(s.i);break;case"r":e.remove(s.r);break;default:console.assert(!1,"Unknown operation: "+JSON.stringify(s))}return e}toJSON(){return this.ops}isNoop(){const t=this.ops.length;return 0===t||1===t&&"n"===this.ops[0].t}retain(t){if(console.assert("number"==typeof t&&t>=0,`Retain expects a positive integer, got ${t}`),t>0){this.ilen+=t,this.olen+=t;const{ops:e}=this,s=e[-1];s&&"n"===s.t?s.n+=t:e.push({t:"n",n:t})}return this}insert(t){if(console.assert(t[Symbol.iterator],`Insert expects an iterable, got ${t}`),t.length){this.olen+=t.length;const{ops:e}=this,s=e[-1];if(s&&"i"===s.t)s.i=s.i.concat(Array.from(t));else if(s&&"r"===s.t){const s=e[-2];s&&"i"===s.t?s.i=s.i.concat(Array.from(t)):e.splice(e.length-1,0,{t:"i",i:Array.from(t)})}else e.push({t:"i",i:Array.from(t)})}return this}remove(t){if(console.assert(t[Symbol.iterator],`Remove expects an iterable, got ${t}`),t.length){this.ilen+=t.length;const e=this.ops[-1];e&&"r"===e.t?e.r=e.r.concat(Array.from(t)):this.ops.push({t:"r",r:Array.from(t)})}return this}invert(){const t=this.constructor.create();for(const e of this.ops)"n"===e.t?t.retain(e.n):"i"===e.t?t.remove(e.i):t.insert(e.r);return t}apply(t){if(console.assert(t.length===this.ilen,`Apply length mismatch ${t.length} !== ${this.ilen}`),t.buffer instanceof ArrayBuffer){const e=new t.constructor(this.olen);let s=0,n=0;for(const i of this.ops)"n"===i.t?(console.assert(s+i.n<=t.length,"Input is too short."),e.set(t.slice(s,s+i.n),n),s+=i.n,n+=i.n):"i"===i.t?(e.set(i.i,n),n+=i.i.length):(console.assert(!0,"Removal does not match content."),s+=i.r.length);return console.assert(s===t.length,"Apply operation did not consume complete input."),e}{const e=Array.from(t);let s=[],n=0;for(const t of this.ops)"n"===t.t?(console.assert(n+t.n<=e.length,"Input is too short."),s=s.concat(e.slice(n,n+t.n)),n+=t.n):"i"===t.t?s=s.concat(t.i):(console.assert(!0,"Removal does not match content."),n+=t.r.length);return console.assert(n===t.length,`Apply operation did not consume complete input. ${n} ${t.length} ${JSON.stringify(this.ops)}`),"string"==typeof t?s.join(""):t.constructor.from(s)}}update(t){if(console.assert(t.length===this.ilen,`Apply length mismatch ${t.length} !== ${this.ilen}`),t instanceof Array){let e=0;for(const s of this.ops)if("n"===s.t)console.assert(e+s.n<=t.length,"Input is too short."),e+=s.n;else if("i"===s.t){let n=e,i=s.i.length;const r=4096;for(;i;)t.splice.apply(t,[n,0].concat(s.i.slice(n-e,n-e+r))),n+=r,i=i-r<0?0:i-r;e+=s.i.length}else console.assert(!0,"Removal does not match content."),t.splice(e,s.r.length);return console.assert(e===t.length,"Apply operation did not consume complete input."),t}return this.apply(t)}compose(t){console.assert(this.olen===t.ilen,`Cannot compose due to length mismatch ${this.olen} !== ${t.ilen}.`);const e=this.ops,s=t.ops;let n=0,i=0,r=e[n++],o=s[i++];const c=this.constructor.create();for(;r||o;)r&&"r"===r.t?(c.remove(r.r),r=e[n++]):"i"===o.t?(c.insert(o.i),o=s[i++]):"n"===r.t?"n"===o.t?r.n>o.n?(c.retain(o.n),r={t:"n",n:r.n-o.n},o=s[i++]):r.n<o.n?(c.retain(r.n),o={t:"n",n:o.n-r.n},r=e[n++]):(c.retain(r.n),r=e[n++],o=s[i++]):r.n>o.r.length?(c.remove(o.r),r={t:"n",n:r.n-o.r.length},o=s[i++]):r.n<o.r.length?(c.remove(o.r.slice(0,r.n)),o={t:"r",r:o.r.slice(r.n)},r=e[n++]):(c.remove(o.r),r=e[n++],o=s[i++]):"n"===o.t?r.i.length>o.n?(c.insert(r.i.slice(0,o.n)),r={t:"i",i:r.i.slice(o.n)},o=s[i++]):r.i.length<o.n?(c.insert(r.i),o={t:"n",n:o.n-r.i.length},r=e[n++]):(c.insert(r.i),r=e[n++],o=s[i++]):r.i.length>o.r.length?(r={t:"i",i:r.i.slice(o.r.length)},o=s[i++]):r.i.length<o.r.length?(o={t:"r",r:o.r.slice(r.i.length)},r=e[n++]):(r=e[n++],o=s[i++]);return c}transform(t){console.assert(this.ilen===t.ilen,"Both operations have to have the same base length");const e=this.ops,s=t.ops;let n=0,i=0,r=e[n++],o=s[i++];const c=this.constructor.create(),a=this.constructor.create();let l;for(;r||o;)r&&"i"===r.t?(c.insert(r.i),a.retain(r.i.length),r=e[n++]):o&&"i"===o.t?(c.retain(o.i.length),a.insert(o.i),o=s[i++]):"n"===r.t?"n"===o.t?(r.n>o.n?(l=o.n,r={t:"n",n:r.n-o.n},o=s[i++]):r.n<o.n?(l=r.n,o={t:"n",n:o.n-r.n},r=e[n++]):(l=o.n,r=e[n++],o=s[i++]),c.retain(l),a.retain(l)):(r.n>o.r.length?(l=o.r,r={t:"n",n:r.n-o.r.length},o=s[i++]):r.n<o.r.length?(l=o.r.slice(0,r.n),o={t:"r",r:o.r.slice(r.n)},r=e[n++]):(l=o.r,r=e[n++],o=s[i++]),a.remove(l)):"r"===o.t?r.r.length>o.r.length?(r={t:"r",r:r.r.slice(o.r.length)},o=s[i++]):r.r.length<o.r.length?(o={t:"r",r:o.r.slice(r.r.length)},r=e[n++]):(r=e[n++],o=s[i++]):(r.r.length>o.n?(l=r.r.slice(0,o.n),r={t:"r",r:r.r.slice(o.n)},o=s[i++]):r.r.length<o.n?(l=r.r,o={t:"n",n:o.n-r.r.length},r=e[n++]):(l=r.r,r=e[n++],o=s[i++]),c.remove(l));return[c,a]}}function E(t,e,s,n){console.assert(e<s,"count_run lo <= hi");let i=e+1;if(i===s)return 1;if(n(t[i++],t[e])<0){for(;i<s&&n(t[i],t[i-1])<0;)i++;!function(t,e,s){for(s--;e<s;){const n=t[e];t[e++]=t[s],t[s--]=n}}(t,e,i)}else for(;i<s&&n(t[i],t[i-1])>=0;)i++;return i-e}function L(t,e,s,n,i){for(console.assert(e<=n&&n<=s,"binarysort"),console.assert(e<n,"lo should be < start");n<s;n++){let s=e,r=n;const o=t[r];console.assert(s<r,"binarysort l < r");do{const e=s+(r-s>>>1);i(o,t[e])<0?r=e:s=e+1}while(s<r);console.assert(s===r,"binarysort l===r");let c=n-s;switch(c){case 4:t[s+4]=t[s+3];case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;c>0;)t[s+c]=t[s+c-1],c--}t[s]=o}}function A(t,e,s,n,i,r){console.assert(n>0&&i>=0&&i<n);let o=0,c=1;if(r(e[s+=i],t)<0){const a=n-i;for(;c<a&&r(e[s+c],t)<0;)o=c,console.assert(c<(2**53-1)/2),c=1+(c<<1);c>a&&(c=a),o+=i,c+=i}else{const n=i+1;for(;c<n&&r(t,e[s-c])<=0;)o=c,console.assert(c<(2**53-1)/2),c=1+(c<<1);c>n&&(c=n);const a=o;o=i-c,c=i-a}for(s-=i,console.assert(-1<=o&&o<c&&c<=n),o++;o<c;){const n=o+(c-o>>>1);r(t,e[s+n])>0?o=n+1:c=n}return console.assert(o==c),c}function S(t,e,s,n,i,r){console.assert(n>0&&i>=0&&i<n);let o=0,c=1;if(r(t,e[s+=i])<0){const n=i+1;for(;c<n&&r(t,e[s-c])<0;)o=c,console.assert(c<(2**53-1)/2),c=1+(c<<1);c>n&&(c=n);const a=o;o=i-c,c=i-a}else{const a=n-i;for(;c<a&&r(t,e[s+c])>=0;)o=c,console.assert(c<(2**53-1)/2),c=1+(c<<1);c>a&&(c=a),o+=i,c+=i}for(s-=i,console.assert(-1<=o&&o<c&&c<=n),o++;o<c;){const n=o+(c-o>>>1);r(t,e[s+n])<0?c=n:o=n+1}return console.assert(o==c),c}function j(t,e,s){const n=t.stackSize++;t.runStart[n]=e,t.runLength[n]=s}function I(t,e,s){for(;t.stackSize>1;){let n=t.stackSize-2;if(n>=1&&t.runLength[n-1]<=t.runLength[n]+t.runLength[n+1]||n>=2&&t.runLength[n-2]<=t.runLength[n-1]+t.runLength[n])t.runLength[n-1]<t.runLength[n+1]&&n--;else if(t.runLength[n]>t.runLength[n+1])break;C(t,n,e,s)}}function C(t,e,s,n){let i=t.runStart[e],r=t.runLength[e],o=t.runStart[e+1],c=t.runLength[e+1];t.runLength[e]=r+c,e===t.stackSize-3&&(t.runStart[e+1]=t.runStart[e+2],t.runLength[e+1]=t.runLength[e+2]),t.stackSize--;let a=S(s[o],s,i,r,0,n);i+=a,r-=a,0!==r&&(c=A(s[i+r-1],s,o,c,c-1,n),console.assert(c>=0,"should be pos"),console.assert(c>0,"should be impossible to get 0 here"),r<=c?function(t,e,s,n,i,r,o){const c=t.tmp;for(let t=0;t<i;t++)c[t]=e[n+t];let a=n;if(n=0,e[a++]=e[r++],0==--o){for(let t=0;t<i;t++)e[a+t]=c[n+t];return}if(1===i){for(let t=0;t<o;t++)e[a+t]=e[r+t];return void(e[a+o]=c[n])}let l=t.minGallop;t:for(;;){let t=0,u=0;do{if(s(e[r],c[n])<0){if(e[a++]=e[r++],u++,t=0,0==--o)break t}else if(e[a++]=c[n++],t++,u=0,1==--i)break t}while((t|u)<l);do{if(t=S(e[r],c,n,i,0,s),t){for(let s=0;s<t;s++)e[a+s]=c[n+s];if(a+=t,n+=t,(i-=t)<=1)break t}if(e[a++]=e[r++],0==--o)break t;if(u=A(c[n],e,r,o,0,s),u){for(let t=0;t<u;t++)e[a+t]=e[r+t];if(a+=u,r+=u,0===(o-=u))break t}if(e[a++]=c[n++],1==--i)break t;l--}while(t>=7||u>=7);l<0&&(l=0),l+=2}if(t.minGallop=l<1?1:l,1===i){for(let t=0;t<o;t++)e[a+t]=e[r+t];e[a+o]=c[n]}else{if(0===i)throw new Error("Comparison method violates conditions");for(let t=0;t<i;t++)e[a+t]=c[n+t]}}(t,s,n,i,r,o,c):function(t,e,s,n,i,r,o){let c=t.tmp;for(let t=0;t<o;t++)c[t]=e[r+t];let a=n+i-1,l=o-1,u=r+o-1;if(e[u--]=e[a--],console.assert(i>1,"Should be na > nb >= 1"),--i,1===o){u-=i,a-=i;const t=a+1,s=u+1;for(let n=i-1;n>=0;n--)e[s+n]=e[t+n];return void(e[u]=c[l])}let h=t.minGallop;t:for(;;){let t=0,r=0;do{if(s(c[l],e[a])<0){if(e[u--]=e[a--],t++,r=0,0==--i)break t}else if(e[u--]=c[l--],r++,t=0,1==--o)break t}while((t|r)<h);do{if(t=i-S(c[l],e,n,i,i-1,s),0!==t){u-=t,a-=t,i-=t;const s=a+1,n=u+1;for(let i=t-1;i>=0;i--)e[n+i]=e[s+i];if(0===i)break t}if(e[u--]=c[l--],1==--o)break t;if(r=o-A(e[a],c,0,o,o-1,s),0!==r){u-=r,l-=r,o-=r;const t=l+1,s=u+1;for(let n=0;n<r;n++)e[s+n]=c[t+n];if(o<=1)break t}if(e[u--]=e[a--],0==--i)break t;h--}while(t>=7||r>=7);h<0&&(h=0),h+=2}if(t.minGallop=h<1?1:h,1===o){u-=i,a-=i;const t=a+1,s=u+1;for(let n=i-1;n>=0;n--)e[s+n]=e[t+n];e[u]=c[l]}else{if(0===o)throw new Error("Comparison method violates conditions");{const t=u-(o-1);for(let s=0;s<o;s++)e[t+s]=c[s]}}}(t,s,n,i,r,o,c))}class N{constructor(t){this.minGallop=7,this.tmp=new Array(t<512?t>>>1:256);const e=t<120?5:t<1542?10:t<119151?19:40;this.runStart=new Float64Array(e),this.runLength=new Float64Array(e),this.stackSize=0}}function D(t,e,s,n){s||(s=0),n||(n=t.length);let i=n-s;if(i<2)return;if(i<32){return void L(t,s,n,s+E(t,s,n,e),e)}const r=new N(t.length),o=function(t){console.assert(t>=0,"minrun n >= 0");let e=0;for(;t>=32;)e|=1&t,t>>=1;return t+e}(i);do{let c=E(t,s,n,e);if(c<o){const n=i<=o?i:o;L(t,s,s+n,s+c,e),c=n}j(r,s,c),I(r,t,e),s+=c,i-=c}while(0!==i);!function(t,e,s){for(;t.stackSize>1;){let n=t.stackSize-2;console.assert(!(n>0&&t.runLength[n-1]<t.runLength[n+1])),C(t,n,e,s)}}(r,t,e)}function O(){return Array.from({length:16},((t,e)=>33825>>e&1))}function z(t,e,s,n){const i=Math.tan(.5*(Math.PI-t)),r=1/(s-n);return[i/e,0,0,0,0,i,0,0,0,0,(s+n)*r,-1,0,0,s*n*r*2,0]}function T(t,e,s){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,s,1]}function R(t,e,s){return[t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1]}function F(t,e){const[s,n,i,r,o,c,a,l,u,h,d,m,f,p,g,x]=t,[y,w,v,b,M,k,_,E,L,A,S,j,I,C,N,D]=e;return[y*s+w*o+v*u+b*f,y*n+w*c+v*h+b*p,y*i+w*a+v*d+b*g,y*r+w*l+v*m+b*x,M*s+k*o+_*u+E*f,M*n+k*c+_*h+E*p,M*i+k*a+_*d+E*g,M*r+k*l+_*m+E*x,L*s+A*o+S*u+j*f,L*n+A*c+S*h+j*p,L*i+A*a+S*d+j*g,L*r+A*l+S*m+j*x,I*s+C*o+N*u+D*f,I*n+C*c+N*h+D*p,I*i+C*a+N*d+D*g,I*r+C*l+N*m+D*x]}function B(t,e){const[s,n,i]=t,[r,o,c]=e;return[n*c-i*o,i*r-s*c,s*o-n*r]}function P(t){const[e,s,n]=t;var i=(e**2+s**2+n**2)**.5;return i>1e-5?[e/i,s/i,n/i]:[0,0,0]}function $(t,e,s){const n=P((r=t,[(i=e)[0]-r[0],i[1]-r[1],i[2]-r[2]]));var i,r;const o=P(B(n,s)),c=P(B(o,n));return F([o[0],c[0],-n[0],0,o[1],c[1],-n[1],0,o[2],c[2],-n[2],0,0,0,0,1],T(-t[0],-t[1],-t[2]))}function V(t,e){for(var s=[],n=0;n<4;++n){s[n]=0;for(var i=0;i<4;++i)s[n]+=e[i]*t[4*i+n]}return s}function Y(t,e,s){/^#/.test(s)||(s=atob(s));const n=t.createShader(e);t.shaderSource(n,s),t.compileShader(n);if(!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(`Error compiling "${s}" -- "${t.getShaderInfoLog(n)}"`);return n}function G(t,e,s,n,i){const r=t.createProgram();t.attachShader(r,Y(t,t.VERTEX_SHADER,e)),t.attachShader(r,Y(t,t.FRAGMENT_SHADER,s)),t.linkProgram(r);if(!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(`Error linking "${e+s}" -- "${t.getProgramInfoLog(r)}"`);return r}class U extends b{constructor(){super(),this.template=['[[3,"canvas",[],[],[[3,"m-slot",[[":gl",0,["ctx.gl"]],[":add",1,[]],[":remove",2,[]],[":world",3,["ctx.world"]]],[],[]],[4,4,["ctx.glyRender"]]]]]',[function(){return this.ctx.gl},function(){return t=>this.ctx.add(t)},function(){return t=>this.ctx.remove(t)},function(){return this.ctx.world},function(){return this.ctx.glyRender}]],this.children=f.create(),this.add=t=>this.children.push(t),this.remove=t=>this.children.splice(this.children.indexOf(t),1),this.width=0,this.height=0,this.ctxver=0,this.gl=r("ctxver",(function(){const t=this.getElement().querySelector("canvas"),e={};let s=t.getContext("webgl2",e)||t.getContext("experimental-webgl2",e);if(!s){if(s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!s){const e=t.getContext("2d");return t.width=t.clientWidth,t.height=t.clientHeight,e.font="48px serif",e.fillText("No WebGL 1.0 support detected",50,50,t.width-200),null}s.shaderSource=(t,e)=>(e=e.replace(/#version 300 es/,""),e=/precision/.test(e)?e.replace(/^ *in /gm,"varying ").replace(/^ *out [^;]*;/gm,"").replace(/outColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D("):e.replace(/^ *in /gm,"attribute ").replace(/^ *out /gm,"varying "),WebGLRenderingContext.prototype.shaderSource.call(s,t,e));const n=s.getExtension("OES_vertex_array_object");s.bindVertexArray=(...t)=>n.bindVertexArrayOES(...t),s.createVertexArray=(...t)=>n.createVertexArrayOES(...t)}return s})),this.dirty=r("world","localDirty","children.@each.dirty",(function(){return this.oldWorld!==this.world?(this.oldWorld=this.world,!0):!!this.localDirty||this.children.some((t=>t.dirty))})),this.self=this,this.glyRender=r("__owner__.now","world",(function(){this.gl&&(this.resize(),this.dirty&&this.animate())})),this.clearColor=r("model.bgcolor",(function(){const t=this.model&&this.model.bgcolor;if(t&&t.length){if("string"==typeof t){const e=parseInt(t.slice(1),16);return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1]}return t.map((t=>t/255))}return[0,0,0,1]})),this.world=O()}init(){super.init(),this.resizeCb=this.getOwner().asyncEvent((()=>this.resize()))}resize(){if(!this.gl)return;const t=this.gl.canvas,e=window.devicePixelRatio,s=t.clientWidth*e,n=t.clientHeight*e;t.width===s&&t.height===n||(this.width=t.width=s,this.height=t.height=n)}animate(){const{gl:t}=this;t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(...this.clearColor),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);const e=this.getOwner().now;this.glRender(e),this.localDirty=!1,this.children.forEach((t=>{t.glRender(e),t.dirty=!1})),this.dirty=!1}glRender(){}didInsertElement(){if(!this.gl)return;const{canvas:t}=this.gl;t.addEventListener("webglcontextlost",(t=>t.preventDefault()),!1),t.addEventListener("webglcontextrestored",(()=>this.ctxver++),!1),this.getOwner().addAfterRender((()=>this.resize())),window.addEventListener("resize",this.resizeCb),function(t){const e=t.getOwner(),s=t.gl.canvas;let n=!1,i=!1;const r=e.asyncEvent((e=>{if(!n){const{clientX:s,clientY:n}=e,{x:i,y:r,width:o,height:c}=e.target.getClientRects()[0];t.mousemove(s-i-o/2,n-r-c/2)}}));s.addEventListener("mousemove",r);const o=e.asyncEvent((r=>{if(0!==r.button)return;n=!0,i=!1;let o=r.clientX,c=r.clientY;const a=e.asyncEvent((e=>{const s=(e.clientX-o)*window.devicePixelRatio,n=(e.clientY-c)*window.devicePixelRatio;o=e.clientX,c=e.clientY,i=!0,t.panAndZoom(s,-n,0)})),l=e.asyncEvent((e=>{if(s.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),n=!1,!i){const{clientX:s,clientY:n}=e,{x:i,y:r,width:o,height:c}=e.target.getClientRects()[0];t.click(s-i-o/2,n-r-c/2)}}));s.addEventListener("mousemove",a),document.addEventListener("mouseup",l),r.stopPropagation(),r.preventDefault()}));s.addEventListener("mousedown",o);const c=e.asyncEvent((e=>{const n=(e.offsetX-(s.clientWidth>>1))*window.devicePixelRatio,i=((s.clientHeight>>1)-e.offsetY)*window.devicePixelRatio;let r=e.deltaY;1==e.deltaMode?r*=40:2==e.deltaMode&&(r*=800),r&&(t.panAndZoom(n,i,r),e.stopPropagation(),e.preventDefault())}));s.addEventListener("wheel",c)}(this)}willRemoveElement(){this.gl&&(window.removeEventListener("resize",this.resizeCb),cancelAnimationFrame(this.reqid))}mousemove(){}click(){}}function Z(t){return Object.entries(t).reduce(((t,[e,s])=>(t.set(e,s),t)),new URLSearchParams).toString()}function W(t,e){const s=Z(t);return`${s?`?${s}`:""}#/${e.map((({route:{path:t,name:e}})=>void 0!==t?t:e)).map(((t,s)=>t.split("/").map((t=>":"===t[0]?e[s].dynamics[t.slice(1)]:t)))).flat().filter((t=>t)).join("/")}`}function H(t,e){return e?e.map((e=>{const s=t.slice(0),{name:n,path:i,routes:r}=e,o=("string"==typeof i?i:n).split("/"),c={};let a=0;for(const n of o)if(""!==n){if(a*=10,"*"===n[0])return a=(a+3)*10**(t.length-1),c[n.slice(1)]=s.join("/"),{score:a,stack:[{route:e,dynamics:c}]};if(":"===n[0])a+=2,c[n.slice(1)]=s.shift();else{if(n!==s[0])return{score:1/0};a+=1,s.shift()}}const l=H(s,r);return l.score===1/0?s.length?l:{score:a,stack:[{route:e,dynamics:c}]}:{score:a*10**s.length+l.score,stack:[{route:e,dynamics:c},...l.stack]}})).sort(((t,e)=>t.score-e.score))[0]:{score:1/0}}function X(t,e){return`${t.slice(0,e+1).map((({route:{name:t}})=>t)).join("-")}-route`}class Q extends g{init(){super.init(),this.currentStack=f.create(),this.currentQuery=g.create(),this.currentLocation=r("currentStack.@each",(function(){return W({},this.currentStack)})),this.currentRoute=r("currentStack.@each",(function(){return this.currentStack.map((({route:{name:t}})=>t)).join(".")})),this.currentQueryString=r("currentQuery",(function(){return Z(this.currentQuery)})),this.currentTransition=null,this.lock=Promise.resolve()}getLock(){const{lock:t}=this;let e;return this.lock=new Promise((t=>e=t)),{lock:t,unlock:e}}pathFromLocation(){const t=Object.fromEntries(new URLSearchParams(window.location.search.slice(1)).entries()),{hash:e}=window.location;return{query:t,path:"#"===e[0]?e.slice(1):e}}stackFromPath(t){return H(t.split("/").filter((t=>t.length)),this.routes).stack}async performTransition(t,e){const s=(t,e)=>t.route===e.route&&Object.entries(t.dynamics).every((([t,s])=>e.dynamics[t]===s)),{currentStack:n}=this,i=Math.min(e.length,n.length);let r=0;for(;r<i&&s(e[r],n[r]);)r++;const o={aborted:!1,abort(){this.aborted=!0},stack:e},c=this.getOwner(),a=n.map(((t,e)=>c.lookup(X(n,e)))),l=e.map(((t,s)=>c.lookup(X(e,s))));for(const t of a.slice(r).reverse())if(t.willTransition(o),o.aborted)return;for(;r<i&&e[r].route==n[r].route;){if(!s(e[r],n[r])){l[r].params=e[r].dynamics,n.splice(r,1,e[r])}r++}for(let t=a.length-1;t>=r;t--){const e=a[t];(t?a[t-1]:c.lookup("application-route")).__slots__.default=null,c.update(),e.didLeave(),n.pop()}for(this.currentQuery=g.create(t);r<l.length;r++){const t=l[r],s=r?l[r-1]:c.lookup("application-route");t.params=e[r].dynamics,s.__slots__.default=t,c.update(),t.didEnter(),n.push(e[r])}}async updateFromLocation(){const{query:t,path:e}=this.pathFromLocation();if(window.location.hash===this.currentLocation&&this.currentQueryString===window.location.search.slice(1))return;const s=this.stackFromPath(e),{lock:n,unlock:i}=this.getLock();await n,await this.performTransition(t,s),i()}async transitionTo({route:t,dynamics:e={},query:s}){const{lock:n,unlock:i}=this.getLock();await n,t=t||this.currentRoute,s=Object.assign({},this.currentQuery,s);const[,r]=t.split(".").reduce((([t,s],n,i)=>{const r=t.find((t=>t.name===n)),o={};this.currentStack[i].route===r&&Object.assign(o,this.currentStack[i].dynamics);return(void 0!==r.path?r.path:r.name).split("/").forEach((t=>{":"===t[0]&&t.slice(1)in e&&(o[t.slice(1)]=e[t.slice(1)])})),[r.routes,[...s,{route:r,dynamics:g.create(o)}]]}),[this.routes,[]]);this.nextTransition=[s,r,1],await this.performTransition(s,r),window.history.pushState(null,null,W(s,r)),i()}}function K(t){return 4800*t/146097}const J=45,q=45,tt=22,et=26,st=11;class nt{constructor(t){this.diff=t}as(t){switch(t){case"y":return K(this.diff/864e5)/12;case"M":return K(this.diff/864e5);case"w":return this.diff/6048e5;case"d":return this.diff/864e5;case"h":return this.diff/36e5;case"m":return this.diff/6e4;case"s":return this.diff/1e3;case"ms":return this.diff;default:throw new Error("Unknown unit "+t)}}}const it={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};class rt{constructor(t){if("number"==typeof t||"string"==typeof t)this.d=new Date(t);else if(t instanceof rt)this.d=new Date(t.d);else{if(t)throw new Error(`Bad moment initialization: ${t}`);this.d=new Date}}clone(){return new rt(this)}monthDays(t,e){return new Date(t,e,0).getDate()}get year(){return this.d.getFullYear()}set year(t){this.d.setFullYear(t)}get month(){return this.d.getMonth()+1}set month(t){const e=this.monthDays(this.year,t);this.date>e&&(this.date=e),this.d.setMonth(t-1)}get date(){return this.d.getDate()}set date(t){this.d.setDate(t)}get hour(){return this.d.getHours()}set hour(t){this.d.setHours(t)}get minute(){return this.d.getMinutes()}set minute(t){this.d.setMinutes(t)}get second(){return this.d.getSeconds()}set second(t){this.d.setSeconds(t)}get millisecond(){return this.d.getMilliseconds()}set millisecond(t){this.d.setMilliseconds(t)}get weekday(){return this.d.getDay()}set weekday(t){const e=t-this.weekday;this.date=this.date+e}add(t,e){return"week"===e&&(t*=7,e="date"),this[e]=this[e]+t,this}startOf(t){switch(t){case"year":this.month=1;case"month":this.date=1;case"week":case"date":this.hour=0;case"hour":this.minute=0;case"minute":this.second=0;case"second":this.millisecond=0}return"week"===t&&(this.weekday=0),this}endOf(t){return this.startOf(t).add(1,t).add(-1,"millisecond")}format(t,e){t=t||"YYYY-MM-DDTHH:mm:ssZZ";const s={timeZone:e,timeZoneName:"short",formatMatcher:"basic"},n=()=>{const t=(this.d-new Date(this.format("YYYY-MM-DDTHH:mm:ss",e)+"+0000"))/6e4;return`${t<=0?"+":"-"}${String(Math.abs(t)/60>>0).padStart(2,"0")}:${String(Math.abs(t)%60).padStart(2,"0")}`},i={},r={MMMM:t=>(t.month="long","{month}"),MMM:t=>(t.month="short","{month}"),MM:t=>(t.month="2-digit","{month}"),M:t=>(t.month="numeric","{month}"),DD:t=>(t.day="2-digit","{day}"),D:t=>(t.day="numeric","{day}"),dddd:t=>(t.weekday="long","{weekday}"),ddd:t=>(t.weekday="short","{weekday}"),dd:t=>(t.weekday="narrow","{weekday}"),YYYY:t=>(t.year="numeric","{year}"),YY:t=>(t.year="2-digit","{year}"),HH:t=>(t.hour="2-digit",i.hour=t=>t.padStart(2,"0"),t.hourCycle="h23","{hour}"),H:t=>(t.hour="numeric",i.hour=t=>""+ +t,t.hourCycle="h23","{hour}"),hh:t=>(t.hour="2-digit",i.hour=t=>t.padStart(2,"0"),t.hourCycle="h12","{hour}"),h:t=>(t.hour="numeric",i.hour=t=>""+ +t,t.hourCycle="h12","{hour}"),mm:t=>(t.minute="2-digit",i.minute=t=>t.padStart(2,"0"),"{minute}"),m:t=>(t.minute="numeric",i.minute=t=>""+ +t,"{minute}"),ss:t=>(t.second="2-digit",i.second=t=>t.padStart(2,"0"),"{second}"),s:t=>(t.second="numeric",i.second=t=>""+ +t,"{second}"),LL:t=>(t.month="long",t.day="numeric",t.year="numeric","{month} {day} {year}"),LT:t=>(t.hour="2-digit",t.minute="2-digit",t.day="2-digit","{hour}:{minute} {dayPeriod}"),z:()=>"{timeZoneName}",ZZ:()=>(i.timeZoneName=n,"{timeZoneName}")},o=new RegExp(`${Object.keys(r).join("|")}|.`,"g"),c=t.replace(o,(t=>r[t]?r[t](s):t)),a=Intl.DateTimeFormat([],s).formatToParts(this.d);a.push({type:"dayPeriod",value:""});return c.replace(/{([^}]+)}/g,(function(t,e){return(i[e]||(t=>t))(a.find((t=>t.type===e)).value)})).trim()}valueOf(){return this.d.valueOf()}fromNow(){return function(t){const e=t<0,s=new nt(Math.abs(t)),n=Math.round,i=n(s.as("s")),r=n(s.as("m")),o=n(s.as("h")),c=n(s.as("d")),a=n(s.as("M")),l=n(s.as("y")),u=i<J&&["s",i]||r<=1&&["m"]||r<q&&["mm",r]||o<=1&&["h"]||o<tt&&["hh",o]||c<=1&&["d"]||c<et&&["dd",c]||a<=1&&["M"]||a<st&&["MM",a]||l<=1&&["y"]||["yy",l];let h=it[u[0]].replace(/%d/i,u[1]);return it[e?"future":"past"].replace(/%s/i,h)}(Date.now()-this.d.valueOf())}toJSON(){return this.format()}toString(){return""+this.d.valueOf()}}function ot(t,e,s,n){for(;s<n;){const i=s+n>>>1;t[i]<e?s=i+1:n=i}return s}function ct(t,e,s,n){for(;s<n;){const i=s+n>>>1;t[i]<=e?s=i+1:n=i}return s}function at(t){return[0,t.length]}function lt(t,e){const s=new Array(e.length);for(let n=0,i=e.length;n<i;n++)s[n]=t[e[n]];return s}class ut extends g{constructor(t,e=32){super(),console.assert(e<=32,"no support for wide matrix"),this.data=new Uint32Array(t),this.gen=0}extend(t){const e=new Uint32Array(this.data.length+t);e.set(this.data),this.data=e}clear(t){const e=~(1<<t);for(let t=0,s=this.data.length;t<s;t++)this.data[t]&=e;this.gen++}isIn(t,e=-1){return!(this.data[t]&e)}update(t){this.data=t.update(this.data),this.gen++}subarray(t){const e=1<<t,s=~e;return{pos:e,neg:s,set:(t,n)=>{n?this.data[t]|=e:this.data[t]&=s,this.gen++},isIn:t=>this.isIn(t),isGIn:t=>!(this.data[t]&s)}}}class ht{constructor(t){return new Uint32Array(t||0)}}const dt=[t=>t+1,t=>t-1,()=>0];class mt extends g{constructor(){super(),this.reduceFn=dt,this.orderFn=t=>t,this.linear=f.create(),this.count=[],this.acount=[],this.state=[],this.pending=new _,this.faux=r({keys:["dim.lastUpdate"],notify:(t,e,s,n)=>{this.faux,"lastUpdate"===e&&(this.pending=this.pending.compose(n))},get(){}}),this.faux,this.groups=r("pending","dim.xf.filters.gen",(function(){const t=this.pending;this.pending=(new _).retain(t.olen);const e=this.dim.rows,s=this.linear,n=(t,e)=>{const n=this.dim.rowIndex[t],i=this.state[t]<<1|(this.state[t]=this.dim.filters.isGIn(n)),r=s[e];2===i?(r.value=this.reduceFn[1](r.value,this.dim.xf.data[n]),this.count[e]--):1===i&&(r.value=this.reduceFn[0](r.value,this.dim.xf.data[n]),this.count[e]++)},i=(t,e)=>{const s=typeof t;return s===typeof e?t<e:t===ft||e!==ft&&("string"===s||void 0)},r=(t,e)=>"object"==typeof t?+t!=+e:t!==e;let o=0,c=0;for(let a of t.ops)if("n"===a.t)for(let t=0,r=a.n;t<r;t++){const t=this.mapFn(e[o]);for(;i(s[c].key,t);)c++;n(o++,c)}else if("i"===a.t){this.state.splice.apply(this.state,[o,0].concat(a.i.map((()=>!0))));let t,l,u=s.length;for(let h=0,d=a.i.length;h<d;h++){if(r(t,e[o])){t=e[o];const n=this.mapFn(e[o]);for(;c<u&&i(s[c].key,n);)c++;l=s[c],l&&!r(n,l.key)||(l=g.create({key:n,value:this.reduceFn[2]()}),s.splice(c,0,l),u=s.length,this.count.splice(c,0,0),this.acount.splice(c,0,0),console.assert(l===s[c],"added group does not match"))}l.value=this.reduceFn[0](l.value,this.dim.xf.data[this.dim.rowIndex[o]],!0),this.count[c]++,this.acount[c]++,n(o++,c)}}else if("r"===a.t){c=0;for(let t=0;t<a.r.length;t++){const e=this.mapFn(a.r[t][0]);for(;i(s[c].key,e);)c++;console.assert(!r(e,s[c].key));const n=s[c];this.state[o+t]||(n.value=this.reduceFn[0](n.value,a.r[t][1]),this.count[c]++),n.value=this.reduceFn[1](n.value,a.r[t][1],!0),this.count[c]--,this.acount[c]--,0===this.acount[c]&&(s.splice(c,1),this.count.splice(c,1),this.acount.splice(c,1))}this.state.splice(o,a.r.length)}return this.linear}))}static create(t,e=(t=>t)){const s=super.create({dim:t,mapFn:e});return s.pending.insert(t.rows),s}filterRange(){return[this.mapFn(this.dim.rows[this.dim.lo]),this.mapFn(this.dim.rows[this.dim.hi])]}size(){return this.groups.length}reduce(t,e,s){return this.reduceFn=[t,e,s],this.linear.splice(0,this.linear.length),this.count=[],this.acount=[],this.state=[],this.pending=(new _).insert(this.dim.rows),this}reduceCount(){return this.reduce(...dt)}reduceSum(t){return this.reduce(((e,s)=>e+t(s)),((e,s)=>e-t(s)),(()=>0))}order(t){return this.orderFn=t,this}orderNatural(){return this.orderFn=t=>t,this}top(t){const e=this.groups,s=e.filter(((t,e)=>this.count[e])).sort(((t,e)=>this.orderFn(t.value)<=this.orderFn(e.value)?-1:1)).reverse(),n=e.filter(((t,e)=>!this.count[e])).sort(((t,e)=>this.orderFn(t.value)<=this.orderFn(e.value)?-1:1));return s.concat(n).slice(0,t).map((t=>({key:t.key===ft?null:t.key,value:t.value})))}all(){return this.groups}dispose(){}}const ft=null;class pt extends g{constructor(){super(),this.filterFx=at,this.filterFn=()=>!0,this.lo=this.hi=0,this.rowsPerValue=new ht,this.rows=[],this.rowIndex=new ht,this.rowHidden=new ht,this.groups=Array(32)}static create(t,e,s){const n=super.create({xf:t,filters:e});return n.accessor=t=>{const e="function"==typeof s?s(t):t[s];return"function"==typeof e?e.apply(t):e},n.update((new _).insert(t.data)),n}update(t){let e=0,s=(new _).retain(this.rows.length);for(let n of t.ops)"n"===n.t?e+=n.n:"i"===n.t?(s=s.compose(this.insert(e,n.i)),e+=n.i.length):s=s.compose(this.remove(e,n.r));this.lastUpdate=s}remove(t,e){const s=e.length,n=new _,i=new ht(this.rowsPerValue.length-s);if(i.set(this.rowsPerValue.slice(0,t)),i.set(this.rowsPerValue.slice(t+s),t),this.rowsPerValue=i,!this.rowsPerValue.length)return n.remove(this.rows.map(((t,s)=>[t,e[s]]))),this.rows=[],this.rowIndex=new ht(0),this.rowHidden=new ht(0),n;let r=0;for(let i=0,o=this.rows.length;i<o;i++){const o=this.rowIndex[i];t<=o&&o<t+s?(r++,n.remove([[this.rows[i],e[o-t]]])):n.retain(1)}const o=[],c=new ht(this.rows.length-r),a=new ht(this.rows.length-r);for(let e=0,n=0,i=this.rows.length;e<i;e++){const i=this.rowIndex[e];t<=i&&i<t+s||(o[n]=this.rows[e],c[n]=i>=t+s?i-s:i,a[n]=this.rowHidden[e],n++)}return this.rows=o,this.rowIndex=c,this.rowHidden=a,n}insert(t,e){const s=new _,n=e.map(this.accessor),i=new ht(e.length);let r,o,c=[];if(n[0]instanceof Array){for(let t=0,e=n.length;t<e;t++)i[t]=n[t].length||1;const t=i.reduce(((t,e)=>t+e),0);r=new ht(t);let e=0;for(let t=0,s=n.length;t<s;t++)n[t].length?n[t].forEach((s=>{c.push(s),r[e++]=t})):(c.push(ft),r[e++]=t);console.assert(e===t,"should be identical")}else i.fill(1),c=n.slice().concat(c),r=Uint32Array.from(n,((t,e)=>e));o=new ht(c.length);const a=Array.from(r,((t,e)=>e));D(a,((t,e)=>{let s=c[t],n=c[e];return s===n?0:typeof s==typeof n?(s.valueOf&&(s=s.valueOf(),n=n.valueOf()),s<n?-1:s>n?1:0):s===ft?-1:n===ft?1:"string"==typeof s&&"number"==typeof n?-1:"number"==typeof s&&"string"==typeof n?1:s<n})),c=lt(c,a),r.set(lt(r,a));const l=this.rows.length,u=c.length,h=new ht(this.rowsPerValue.length+e.length),d=[],m=new ht(l+u),f=new ht(l+u);for(let e=0;e<u;e++)r[e]+=t;h.set(this.rowsPerValue.subarray(0,t),0),h.set(i,t),h.set(this.rowsPerValue.subarray(t),t+e.length);let p=0,g=0,x=0;const[y,w]=this.filterFx(c),v=[];for(;g<l&&x<u;p++)this.rows[g]<=c[x]?(d[p]=this.rows[g],f[p]=this.rowHidden[g],m[p]=this.rowIndex[g],s.retain(1),g++):(d[p]=c[x],f[p]=o[x],m[p]=r[x],s.insert([c[x]]),x<y?(v.push(p),this.lo++,this.hi++):x<w?(this.filterFn(c[x])||v.push(p),this.hi++):v.push(p),x++);for(s.retain(l-g);g<l;g++,p++)d[p]=this.rows[g],f[p]=this.rowHidden[g],m[p]=this.rowIndex[g];for(s.insert(c.slice(x));x<u;x++,p++)d[p]=c[x],f[p]=o[x],m[p]=r[x],x<y?(v.push(p),this.lo++,this.hi++):x<w?(this.filterFn(c[x])||v.push(p),this.hi++):v.push(p);return this.rowsPerValue=h,this.rows=d,this.rowIndex=m,this.rowHidden=f,v.forEach((t=>this.hide(t))),s}setFilter(t,e){this.filters.set(t,e)}filter(t){return null==t?this.filterAll():Array.isArray(t)?this.filterRange(t):"function"==typeof t?this.filterFunction(t):this.filterExact(t)}filterExact(t){return this.filterFx=function(t){return function(e){const s=e.length;return[ot(e,t,0,s),ct(e,t,0,s)]}}(t),this.filterFn=()=>!0,this.filterFlipper(this.filterFx(this.rows))}filterRange(t){return this.filterFx=function(t){const[e,s]=t;return function(t){const n=t.length;return[ot(t,e,0,n),ot(t,s,0,n)]}}(t),this.filterFn=()=>!0,this.filterFlipper(this.filterFx(this.rows))}filterAll(){return this.filterFx=at,this.filterFn=()=>!0,this.filterFlipper(this.filterFx(this.rows))}filterFunction(t){return this.filterFx=at,this.filterFn=t,this.filterFlipper(this.filterFx(this.rows))}hide(t){if(!this.rowHidden[t]){const e=this.rowIndex[t];this.rowsPerValue[e]--,this.rowsPerValue[e]||this.setFilter(e,!0),this.rowHidden[t]=1}}show(t){if(this.rowHidden[t]){const e=this.rowIndex[t];this.rowsPerValue[e]++,1===this.rowsPerValue[e]&&this.setFilter(e,!1),this.rowHidden[t]=0}}filterFlipper([t,e]){for(let e=0;e<t;e++)this.hide(e);for(let s=t;s<e;s++)this.filterFn(this.rows[s])?this.show(s):this.hide(s);for(let t=e;t<this.rows.length;t++)this.hide(t);this.lo=t,this.hi=e}top(t,e=0){if(t<=0)return[];return Array.from(this.rowIndex.filter((t=>this.filters.isIn(t)))).map((t=>this.xf.data[t])).reverse().slice(e,t+e)}bottom(t,e=0){if(t<=0)return[];return Array.from(this.rowIndex.filter((t=>this.filters.isIn(t)))).map((t=>this.xf.data[t])).slice(e,t+e)}group(t){return mt.create(this,t)}groupAll(){return{g:mt.create(this,(()=>0)),value(){const t=this.g.all();return t.length?t[0].value:this.g.reduceFn[2]()},reduceCount(){return this.g.reduceCount(),this},reduceSum(...t){return this.g.reduceSum(...t),this},reduce(...t){return this.g.reduce(...t),this},dispose(){return this.g.dispose(),this}}}dispose(){this.xf.disposeDimension(this)}}class gt extends g{constructor(t){super(),this.data=t||[],this.n=this.data.length,this.filters=new ut(this.n),this.dimmask=0,this.dimensions=Array(32),this.allFilteredA=r("filters.gen",(function(){return f.from(this.allFiltered())}))}add(t){const e=(new _).retain(this.n).insert(t);this.n+=t.length,e.update(this.data),this.filters.extend(t.length);for(let t of this.dimensions)t&&t.update(e);return this}remove(){this.removeElements(this.allFiltered())}removeElements(t){const e=new _;for(let s=0;s<this.n;s++)~t.indexOf(this.data[s])?e.remove([this.data[s]]):e.retain(1);this.n+=e.olen-e.ilen,e.update(this.data),this.filters.update(e);for(let t of this.dimensions)t&&t.update(e)}clear(){const t=new _;t.remove(this.data),this.n=0,t.update(this.data),this.filters.update(t);for(let e of this.dimensions)e&&e.update(t)}dimension(t){const e=~this.dimmask&-~this.dimmask,s=Math.log(e)/Math.log(2)|0;return this.dimmask|=e,this.dimensions[s]=pt.create(this,this.filters.subarray(s),t)}disposeDimension(t){const e=this.dimensions.indexOf(t);this.dimensions[e]=void 0,this.dimmask^=1<<e,this.filters.clear(e)}groupAll(){return this.dimension((()=>0)).groupAll()}size(){return this.n}all(){return this.data}allFiltered(){const t=[];for(let e=0;e<this.data.length;e++)this.filters.isIn(e)&&t.push(this.data[e]);return t}isElementFiltered(t,e=[]){let s=-1;return e.forEach((t=>{s^=1<<this.dimensions.indexOf(t)})),this.filters.isIn(t,s)}}class xt{constructor(t){this.content=t}}const yt=t=>t;class wt extends M{constructor(){super(),this.template=['[[3,"widget-waiting",[["icon","list-rich"],["acl","true"],[":user",0,["ctx.app.user"]],["e401","Sign in to access details"],[":e403",1,["ctx.app.user","ctx.params.id"]],[":e404",2,["ctx.params.id"]]],[],[[3,"widget-modal",[[":open",3,["ctx.runRes"]],[":setopen",4,[]],["title","Dataset node run"]],["target"],[[3,"div",[["into","body"]],[],[[0,[[[4,5,["ctx.runRes.waiting"]]],[[4,6,["ctx.runRes.errors"]]],[[0,[[[3,"div",[],[],[[2,"\\n                The node run has successfully finished.\\n              "]]]],[[3,"div",[],[],[[2,"An error occured during the node run"]]]]],[[4,7,["ctx.runRes.status"]],[4,null,[]]]],[3,"div",[],[],[[2,"Raw output of command:"]]],[3,"pre",[],[],[[2,"---begin---"],[3,"br",[],[],[]],[4,8,["ctx.runRes.stdout"]],[3,"br",[],[],[]],[4,9,["ctx.runRes.stderr"]],[3,"br",[],[],[]],[2,"---end---"]]]]],[[4,5,["ctx.runRes.waiting"]],[4,6,["ctx.runRes.errors"]],[4,null,[]]]]]],[3,"div",[["into","footer"]],[],[[3,"button",[["type","button"],["class","m-button"],["@click",10,[]]],[],[[2,"Close"]]]]]]],[3,"div",[["class","l-detail"]],[],[[3,"div",[["class","mu-d-flex mu-justify-content-between"]],[],[[3,"nav",[["class","m-breadcrumb"]],[],[[3,"ul",[],[],[[3,"li",[],[],[[3,"link-to",[[":href",11,["ctx.model.collection"]]],[],[[2,"overview"]]]]],[3,"li",[["class","is-active"]],[],[[3,"a",[],[],[[4,12,["ctx.model.title"]]]]]]]]]],[0,[[[3,"div",[["class","m-buttons is-small"]],[],[[0,[[[3,"widget-tag",[["classes","m-button is-right"],[":disabled",15,["ctx.app.user"]],[":tags",16,["ctx.model.tags"]],[":alltags",17,["ctx.model.all_known_tags"]],[":altaction",18,[]],[":changeaction",19,[]],["menuclass","is-right"]],[],[]]]],[[4,14,["ctx.acl.tag"]]]],[0,[[[3,"widget-comment",[["classes","m-button is-right"],[":disabled",15,["ctx.app.user"]],[":changeaction",21,[]],["menuclass","is-right"]],[],[]]]],[[4,20,["ctx.acl.comment"]]]],[0,[[[3,"m-dropdown",[["classes","is-right"]],["dd"],[[3,"button",[["into","trigger"],["role","button"],["class","m-button m-dropdown-toggle"],["@click",23,[]]],[],[[2,"fetch file lists"]]],[3,"div",[["into","content"],["class","m-dropdown-item"]],[],[[0,[[[3,"div",[["class","m-buttons"]],[],[[3,"widget-clipboard",[["classes","m-button is-fullwidth"],[":model",25,["ctx.copyFilelist"]]],[],[]],[3,"widget-clipboard",[["classes","m-button is-fullwidth"],[":model",26,["ctx.copyUrllist"]]],[],[]]]]],[[3,"div",[],[],[[2,"\\n                      Fetching ...\\n                    "]]]]],[[4,24,["ctx.listFetched"]],[4,null,[]]]]]]]]]],[[4,22,["ctx.acl.download_raw"]]]],[0,[[[3,"button-confirm",[["classes","m-button is-outlined"],["actionbuttonclasses","is-danger"],["title","Discard dataset"],[":text",28,["ctx.discardText"]],[":action",29,[]],["confirmtext","Discard dataset"]],[],[[2,"Discard dataset"]]]]],[[4,27,["ctx.acl.delete"]]]]]]]],[[4,13,["ctx.type"]]]]]],[3,"div",[["class","m-tabs is-boxed"]],[],[[3,"ul",[],[],[[0,[[[3,"li",[[":class",[[["is-active"],[31,["ctx.tabindex"]]]]]],[],[[3,"a",[["href","#"],["@click",32,[]],["title","Summary"]],[],[[2,"Summary"]]]]]]],[[4,30,["ctx.model.summary"]]]],[1,[33,["ctx.model.sections"]],["section","index"],[[3,"li",[[":class",[[["is-active"],[34,["ctx.tabindex","index"]]]]],["@click",35,[]],[":title",36,["section.title"]]],[],[[3,"a",[],[],[[4,36,["section.title"]]]]]]]]]]]],[3,"div",[["class","m-card"]],[],[[3,"div",[["class","m-card-body m-tab-content"]],[],[[0,[[[3,"div",[["role","tabpanel"],["class","m-tab-pane m-stack"],[":class",[[["is-active"],[31,["ctx.tabindex"]]]]]],[],[[1,[37,["ctx.model.summary.widgets"]],["widget"],[[3,"div",[["class","m-card widget-container"]],[],[[3,"div",[["class","m-card-body"]],[],[[3,"h3",[],[],[[4,38,["widget.caption"]]]],[3,"widget-loader",[[":model",39,["widget"]]],[],[]]]]]]]],[3,"div",[["class","m-card"]],[],[[3,"div",[["class","m-card-body mu-d-flex mu-flex-gap mu-align-items-center"]],[],[[3,"span",[],[],[[2,"Tagged"]]],[3,"ul",[["class","l-detail--tagged"]],[],[[1,[40,["ctx.model.tags.sort"]],["tag"],[[3,"li",[],[],[[3,"span",[["class","m-tag"]],[],[[4,41,["tag"]]]]]]]]]],[0,[[[3,"widget-tag",[["classes","m-button is-small"],[":disabled",15,["ctx.app.user"]],[":tags",16,["ctx.model.tags"]],[":alltags",17,["ctx.model.all_known_tags"]],[":altaction",18,[]],[":changeaction",19,[]]],[],[]]]],[[4,14,["ctx.acl.tag"]]]]]]]],[1,[42,["ctx.model.comments"]],["comment"],[[3,"div",[["class","l-detail--comment m-message is-bordered"]],[],[[3,"div",[["class","m-message-header"]],[],[[3,"span",[],[],[[3,"strong",[],[],[[4,43,["comment.author"]]]],[2," commented\\n                      "],[3,"time",[[":datetime",44,["comment.timeAdded"]],["is","relative-time"],[":title",44,["comment.timeAdded"]]],[],[[4,45,["ctx.print_relatime","comment.timeAdded"]]]]]]]],[3,"div",[["class","m-message-body"]],[],[[4,46,["comment.text"]]]]]]]],[0,[[[3,"div",[["class","l-detail--comment-add m-card"]],[],[[3,"div",[["class","m-card-body m-stack"]],[],[[3,"div",[["class","m-control"]],[],[[0,[[[3,"input-textarea",[["classes","m-textarea"],["placeholder","Leave a comment"],[":value",47,["ctx.comment"]],["rows","5"],[":changeaction",48,[]]],[],[]]],[[3,"input-textarea",[["classes","m-textarea"],["placeholder","Sign in to comment"],[":value",47,["ctx.comment"]],["rows","5"],[":changeaction",48,[]],[":disabled",49,[]]],[],[]]]],[[4,0,["ctx.app.user"]],[4,null,[]]]]]],[3,"div",[["class","m-control"]],[],[[0,[[[3,"button",[["type","button"],["class","m-button is-primary is-outlined"],["@click",50,[]]],[],[[2,"Comment"]]]]],[[4,0,["ctx.app.user"]]]]]]]]]]]],[[4,20,["ctx.acl.comment"]]]]]]]],[[4,30,["ctx.model.summary"]]]],[1,[33,["ctx.model.sections"]],["section","index"],[[3,"div",[["role","tabpanel"],["class","m-tab-pane"],[":class",[[["is-active"],[34,["ctx.tabindex","index"]]]]]],[],[[0,[[[0,[[[1,[52,["section.widgets"]],["widget"],[[3,"div",[["class","widget-container"]],[],[[0,[[[3,"h3",[],[],[[4,38,["widget.caption"]]]]]],[[4,38,["widget.caption"]]]],[3,"widget-loader",[[":model",39,["widget"]]],[],[]]]]]]],[[0,[[[3,"h3",[],[],[[4,53,["section.widgets.0.caption"]]]]]],[[4,53,["section.widgets.0.caption"]]]],[3,"widget-loader",[[":model",54,["section.widgets.0"]]],[],[]]]],[[4,51,["section.widgets.length"]],[4,null,[]]]]]],[[4,34,["ctx.tabindex","index"]]]]]]]]]]]]]]]]]',[function(){return this.ctx.app.user},function(){return"User "+this.ctx.app.user+" is not permitted to access details for dataset "+this.ctx.params.id},function(){return"Dataset "+this.ctx.params.id+" does not exist"},function(){return this.ctx.runRes},function(){return t=>this.ctx.closeRun(t)},function(){return this.ctx.runRes.waiting},function(){return this.ctx.runRes.errors},function(){return 0===this.ctx.runRes.status},function(){return this.ctx.runRes.stdout},function(){return this.ctx.runRes.stderr},function(t){this.ctx.closeRun()},function(){return"collection/"+this.ctx.model.collection},function(){return this.ctx.model.title},function(){return"dataset"===this.ctx.type},function(){return this.ctx.acl.tag},function(){return!this.ctx.app.user},function(){return this.ctx.model.tags},function(){return this.ctx.model.all_known_tags},function(){return()=>this.ctx.openSignin()},function(){return t=>this.ctx.retag(t)},function(){return this.ctx.acl.comment},function(){return t=>this.ctx.Xcomment(t)},function(){return this.ctx.acl.download_raw},function(t){this.ctx.getFilelist(),this.dd.open()},function(){return this.ctx.listFetched},function(){return this.ctx.copyFilelist},function(){return this.ctx.copyUrllist},function(){return this.ctx.acl.delete},function(){return this.ctx.discardText},function(){return t=>this.ctx.deleteAction(t)},function(){return this.ctx.model.summary},function(){return"summary"===this.ctx.tabindex},function(t){this.ctx.settab("summary",t)},function(){return this.ctx.model.sections},function(){return this.ctx.tabindex===this.index},function(t){this.ctx.settab(this.index,t)},function(){return this.section.title},function(){return this.ctx.model.summary.widgets},function(){return this.widget.caption},function(){return this.widget},function(){return this.ctx.model.tags.sort(((t,e)=>t<e?-1:1))},function(){return this.tag},function(){return this.ctx.model.comments},function(){return this.comment.author},function(){return this.comment.timeAdded},function(){return this.ctx.print_relatime(this.comment.timeAdded)},function(){return this.comment.text},function(){return this.ctx.comment},function(){return t=>this.ctx.comment=t},function(){return!0},function(t){this.ctx.saveComment()},function(){return this.section.widgets.length>1},function(){return this.section.widgets},function(){return this.section.widgets[0].caption},function(){return this.section.widgets[0]}]],this.type="dataset",this.app=r((function(){return this.getOwner().lookup("application-route")})),this.comment="",this.modelId=null,this.model=r("params","app.user",(async function(){const{id:t}=this.params,e=await this.app.api({url:`${this.type}/${t}`});if(this.baseurl="marv/api/dataset"+("dataset"===this.type?`/${t}`:""),document.title=`MARV > ${"dataset"===this.type?t.slice(0,10):this.type}`,this.rebaseUrls(e),this.app.activeCollection=e.collection,this.modelId!==t&&(this.tabindex=e.summary?"summary":0,this.modelId=t),e.comments=f.create(e.comments),e.tags=f.create(e.tags),e.leaf_perms=g.create(e.leaf_perms),e.dataset_perms=g.create(e.dataset_perms),this.listFetched=!1,!e.acl.includes("download_raw")){var s,n;const t=null===(s=e.summary)||void 0===s||null===(n=s.widgets)||void 0===n?void 0:n.find((t=>"table"===t.type));t&&(t.data.columns[0].formatter="string",t.data.rows.forEach((t=>t.values[0]=t.values[0].title)))}if(e.acl.includes("setacl")){const s=await this.app.api({url:`annotate/${t}?type=userdata`});e.userdata=s[0]}return g.create(e)})),this.acl=r("model",(function(){const t={};return this.model.acl&&this.model.acl.forEach((e=>t[e.replace("-","_")]=!0)),t})),this.discardText=r("model",(function(){return`Are you sure you want to mark dataset ${this.params.id} for\n      deletion?  If the corresponding files still exists on disk, they would be\n      re-added as new dataset during the next scan. The discarded dataset would\n      be deleted during the next cleanup and its tags and comments would be\n      IRREVOCABLY gone.`})),this.print_relatime=r("__owner__.formatters.version",(function(){return this.getOwner().formatters["print-relatime"]}))}getFilelist(){this.app.getFilelist([this.model.id]).then((t=>{this.copyFilelist={data:t.paths.join("\n"),title:"file paths"},this.copyUrllist={data:t.urls.map((t=>`${this.app.apiEndpoint}${t}`)).join("\n"),title:"URLs"},this.listFetched=!0}))}toggleControls(){this.controlsOpen=!this.controlsOpen}saveComment(){this.comment&&(this.app.comment({[this.model.id]:{add:[this.comment]}}).then((()=>this.reloadModel())),this.comment="")}settab(t,e){this.tabindex=t,e.preventDefault()}openSignin(){this.app.openSignin()}retag(t){const e={},s={};t.added.forEach((t=>e[t]=[this.model.id])),t.removed.forEach((t=>s[t]=[this.model.id])),this.app.tag({[this.model.collection]:{add:e,remove:s}}).then((()=>this.reloadModel()))}Xcomment(t){this.app.comment({[this.model.id]:{add:[t]}}).then((()=>this.reloadModel()))}deleteAction(){this.app.delete([this.model.id]).then((()=>{this.getOwner().lookup("collection-route").reloadModel(),this.transitionTo({route:"index"})}))}async runNodes(){this.runRes={waiting:"Waiting for node run to complete"},this.runRes=await this.app.api({url:"v1/trigger",method:["POST"],data:{action:"run",setid:this.params.id}})}closeRun(){this.runRes&&0===this.runRes.status&&this.reloadModel(),this.runRes=!1}rebaseUrls(t){const e=(t.summary?[t.summary]:[]).concat(t.sections),s=t=>{t.forEach((t=>{t.data&&("image"===t.type?/^data:/.test(t.data.src)||(t.data.src=`${this.baseurl}/${t.data.src}`):"gallery"===t.type?t.data.images.forEach((t=>{/^data:/.test(t.src)||(t.src=`${this.baseurl}/${t.src}`)})):"table"===t.type?t.data.columns.forEach(((e,s)=>{"rellink"===e.formatter&&(e.formatter="link",t.data.rows.forEach((t=>{/^data:/.test(t.values[s].href)||(t.values[s].href=`${this.baseurl}/${t.values[s].href}`)})))})):"video"===t.type||"pdf"===t.type?/^data:/.test(t.data.src)||(t.data.src=`${this.baseurl}/${t.data.src}`):"dropdown"===t.type&&s(t.data.widgets))}))};e.forEach((t=>s(t.widgets)))}reloadModel(){this.params={id:this.params.id},this.getOwner().lookup("collection-route").reloadModel()}didEnter(){this.app.lastDetailHash=location.hash}}const{url:vt}=import.meta;const bt=/^\s*([0-9.]+)\s*([kmgtpezy][b]?)?\s*$/i,Mt=["b","k","m","g","t","p","e","z","y"];function kt(t){if(""===t)return"";{const e=bt.exec(t);return!e||isNaN(e[1])?NaN:(t=+e[1],e[2]&&(t*=Math.pow(2,10*Mt.indexOf(e[2][0].toLowerCase()))),Math.floor(t))}}const _t=/^\s*(?:(\d+)\s*h)?\s*(?:(\d+)\s*m)?\s*(?:(\d+)\s*s?)?\s*$/;function Et(t){if(""===t)return"";{const e=_t.exec(t);return e?3600*(e[1]||0)+60*(e[2]||0)+1*(e[3]||0):NaN}}const Lt=([t,e],[s,n])=>{if(t===s&&e===n)return null;const i=e-n,r=s-t,o=(i**2+r**2)**.5;return[i/o,r/o]};const At=Float32Array.from([0,0,1,0,0,1,1,1]);const St={};const jt=/^marv-partial:/;const It=Math.PI;function Ct([t,e]){return e=e*It/180,[(1+(t=t*It/180)/It)/2,(1+Math.log(Math.tan(e)+1/Math.cos(e))/It)/2]}function Nt(t){const e=t.geojson.features.reduce(((e,s)=>{const{type:n,coordinates:i}=s.geometry;return"LineString"===n?("WGS84"===s.properties.coordinatesystem&&(s.geometry.coordinates=i.map((t=>Ct(t))),s.properties.coordinatesystem="cartesian"),e.concat(s.geometry.coordinates)):"Polygon"===n?("WGS84"===s.properties.coordinatesystem&&(s.geometry.coordinates[0]=i[0].map((t=>Ct(t))),s.properties.coordinatesystem="cartesian"),e.concat(s.geometry.coordinates[0])):"Circle"===n||"Point"===n?("WGS84"===s.properties.coordinatesystem&&(s.geometry.coordinates=Ct(i),s.properties.coordinatesystem="cartesian"),t.hidden?e:e.concat([s.geometry.coordinates])):void console.assert(!1,`${s.geometry.type} not supported`)}),[]);let s=1/0,n=-1/0,i=-1/0,r=1/0;e.forEach((([t,e])=>{t<s&&(s=t),t>i&&(i=t),e<r&&(r=e),e>n&&(n=e)})),t.bbox=[s,n,i,r];const o=t.geojson.features.filter((({properties:t})=>t.timestamps&&t.timestamps.length));o.length&&(t.timebox=o.reduce(((t,{properties:e})=>[Math.min(t[0],e.timestamps[0]),Math.max(t[1],e.timestamps.slice(-1)[0])]),[1/0,-1/0]))}class Dt extends U{constructor(){super(),this.template=['[[3,"div",[["class","widget-gl widget-map"],["@keyup",0,[]]],[],[[3,"canvas",[["tabindex","-1"],["@click",1,[]]],[],[[4,2,["ctx.glyRender"]]]],[0,[[[1,[4,["ctx.layers"]],["layer","index"],[[0,[[[3,"glycine-tyler",[[":model",6,["layer"]],[":index",7,["index"]],[":z",8,["ctx.z"]],[":pos",9,["ctx.pos"]],[":gl",3,["ctx.gl"]],[":add",10,[]],[":remove",11,[]],[":world",12,["ctx.world"]]],[],[]]],[[3,"glycine-geojson",[[":model",6,["layer"]],[":index",7,["index"]],[":gl",3,["ctx.gl"]],[":add",10,[]],[":remove",11,[]],[":world",12,["ctx.world"]],[":timerange",14,["ctx.timeRange"]],[":width",15,["ctx.width"]],[":height",16,["ctx.height"]]],[],[]]],[],[[2,"\\n              Layer "],[4,18,["layer.type"]],[2," not supported\\n            "]]],[[4,5,["layer.type"]],[4,13,["layer.type"]],[4,17,["layer.type"]],[4,null,[]]]]]]]],[[4,3,["ctx.gl"]]]],[3,"div",[["class","widget-gl-controls mu-top mu-left m-buttons"]],[],[[3,"button",[["class","m-button"],["@click",19,[]]],[],[[3,"widget-icon",[["glyph","zoom-out"]],[],[]]]],[3,"button",[["class","m-button"],["@click",20,[]]],[],[[3,"widget-icon",[["glyph","fullscreen-exit"]],[],[]]]],[3,"button",[["class","m-button"],["@click",21,[]]],[],[[3,"widget-icon",[["glyph","zoom-in"]],[],[]]]]]],[3,"div",[["class","widget-gl-controls mu-top mu-right mu-d-flex"]],[],[[0,[[[3,"form",[],[],[[1,[4,["ctx.layers"]],["layer","index"],[[0,[[[3,"m-select",[[":options",23,["layer.tiles"]],["namekey","title"],["valuekey","url"],[":selected",24,["layer.tile"]],[":changeaction",25,[]]],[],[]]],[[3,"div",[["class","m-field"]],[],[[3,"label",[["class","m-checkbox"]],[],[[3,"span",[[":style",27,["layer.color"]]],[],[]],[3,"input",[["type","checkbox"],[":checked",28,["layer.hidden"]],["@click",29,[]]],[],[]],[2," "],[4,30,["layer.title"]]]]]]]],[[4,5,["layer.type"]],[4,26,["layer.title.0"]]]]]]]]]],[[4,22,["ctx.burgerOpen"]]]],[3,"div",[],[],[[3,"button",[["class","m-button"],["@click",31,[]]],[],[[3,"widget-icon",[["glyph","menu"]],[],[]]]]]]]],[3,"div",[["class","widget-gl-controls mu-bottom mu-left mu-right"]],[],[[3,"div",[["class","mu-d-flex mu-justify-content-between"]],[],[[0,[[[3,"span",[["class","widget-gl-attribution"],["::html",32,["ctx.layers.0.tile.attribution"]]],[],[]]]],[[4,32,["ctx.layers.0.tile.attribution"]]]]]]]]]]]',[function(t){this.ctx.up(t)},function(t){this.ctx.focus()},function(){return this.ctx.glyRender},function(){return this.ctx.gl},function(){return this.ctx.layers},function(){return"tiles"===this.layer.type},function(){return this.layer},function(){return this.index},function(){return this.ctx.z},function(){return this.ctx.pos},function(){return t=>this.ctx.add(t)},function(){return t=>this.ctx.remove(t)},function(){return this.ctx.world},function(){return"geojson"===this.layer.type},function(){return this.ctx.timeRange},function(){return this.ctx.width},function(){return this.ctx.height},function(){return"waiting"===this.layer.type},function(){return this.layer.type},function(t){this.ctx.zoom(-1)},function(t){this.ctx.zoom(0)},function(t){this.ctx.zoom(1)},function(){return this.ctx.burgerOpen},function(){return this.layer.tiles},function(){return this.layer.tile},function(){return t=>this.layer.tile=t},function(){return"_"!==this.layer.title[0]},function(){return"background-color:"+this.layer.color},function(){return!this.layer.hidden},function(t){this.ctx.toggleLayer(this.layer)},function(){return this.layer.title},function(t){this.ctx.burgerOpen=!this.ctx.burgerOpen},function(){return this.ctx.layers[0].tile.attribution}]],this.shortcuts=[{key:"m",desc:"Toggle menu"},{key:"k",desc:"Toggle playback"},{key:"f",desc:"Toggle fullscreen"},{key:"j",desc:"Go 1 frame back"},{key:"l",desc:"Go 1 frame forward"},{key:"SHIFT-j",desc:"Go 10 frames back"},{key:"SHIFT-l",desc:"Go 10 frames forward"}],this.oid=r((()=>this.__oid__)),this.zoomTimer=null,this.zoomAcc=0,this.zoomCount=0,this.nextPlaytime=null,this.controls=!0,this.playState="paused",this.playSpeed=1,this.playLength=240,this.timeRange=r("timebox","playState","playTime","playLength",(function(){return null===this.timebox||this.timebox[0]===this.playTime?this.timebox:[this.playTime-1e3*this.playLength,this.playTime]})),this.layers=r("model",(function(){return this.model.zoom=[-30,40],f.from(this.model.layers.map((t=>{if((t=g.create(t)).color instanceof Array&&t.color.length){const[e,s,n,i]=t.color;t.color=`rgba(${255*e|0}, ${255*s|0}, ${255*n|0}, ${i})`}return"::encapdata"===t.title?this.decapdata?(t.type="waiting",this.decapdata(this,t)):(t.type="geojson",t.geojson={features:[{geometry:{type:"LineString",coordinates:[[-180,-85],[180,85]]},properties:{coordinatesystem:"WGS84",colors:[],color:[],fillcolor:[]}}]},Nt(t)):"tiles"===t.type?t.tile=t.tiles[0]:"geojson"===t.type&&Nt(t),t})))})),this.bbox=r("layers.@each.title",(function(){const t=this.layers.filter((t=>t.bbox)).map((t=>t.bbox));return[Math.min.apply(null,t.map((t=>t[0]))),Math.max.apply(null,t.map((t=>t[1]))),Math.max.apply(null,t.map((t=>t[2]))),Math.min.apply(null,t.map((t=>t[3])))]})),this.timebox=r("layers.@each.title",(function(){const t=this.layers.filter((t=>t.timebox)).map((t=>t.timebox));return t.length?[Math.min.apply(null,t.map((t=>t[0]))),Math.max.apply(null,t.map((t=>t[1])))]:null})),this.playTime=r("timebox",(function(){return this.timebox?this.timebox[0]:null})),this.duration=r("timebox",(function(){const{timebox:t}=this;return t[1]-t[0]})),this.pos=r("bbox",(function(){return[(this.bbox[0]+this.bbox[2])/2,(this.bbox[1]+this.bbox[3])/2]})),this.z_auto=r("bbox","width","height",(function(){const t=this.bbox,e=t[2]-t[0],s=t[1]-t[3];if(0===e||0===s)return 30;const[n,i]=this.model.zoom,{width:r,height:o}=this;let c;for(c=i;c>n&&!(e*2**c<r&&s*2**c<o);c--);return c})),this.z_manual=null,this.z=r("z_auto","z_manual",(function(){const{z_auto:t,z_manual:e}=this;return null!==e?e:t})),this.world=r("pos","z","width","height","children.@each.layerWorld","cammode",(function(){const{cammode:t}=this;if("child"===t){const t=this.children.filter((t=>t.layerWorld))[0];return t?t.layerWorld.slice():O()}if("perspective"===t){const{width:t,height:e}=this;let s=O();return s=z(Math.PI/2,t/e,1,1e3),s=F(s,$([0,-40,60],[0,0,0],[0,0,1])),s=F(s,R(2**this.z,2**this.z,1)),s=F(s,T(-this.pos[0],-this.pos[1],0)),s}{const{width:t,height:e}=this;let s=O();return s=F(s,[2/t,0,0,0,0,2/e,0,0,0,0,-2/(1- -1),0,0,0,0,1]),s=F(s,R(2**this.z,2**this.z,1)),s=F(s,T(-this.pos[0],-this.pos[1],0)),s}})),this.pnow=r("playState",(function(){return this.getOwner().now})),this.playing=r("playState",(function(){return"playing"===this.playState})),this.localDirty=r("__owner__.now","playState","playTime","layers.@each.hidden","world",(function(){return!0})),this.infull=!1,this.format_timedelta=r("__owner__.formatters.version",(function(){return this.getOwner().formatters["format-timedelta"]})),this.format_datetime=r("__owner__.formatters.version",(function(){return this.getOwner().formatters["format-datetime"]}))}focus(){this.getElements()[0].firstElementChild.focus()}up(t){}zoom(t){if(t)if("full"===t){if(this.infull)document.webkitExitFullscreen();else{this.getElement().webkitRequestFullScreen()}this.infull=!this.infull}else{const[e,s]=this.model.zoom;this.z=Math.min(s,Math.max(e,this.z+t))}else this.bbox=this.bbox.slice()}toggleLayer(t){t.hidden=!t.hidden}panAndZoom(t,e,s){if(s)this.zoomAcc+=s,this.zoomCount+=1,this.zoomPos=[t,e],this.zoomTimer||(this.zoomTimer=setTimeout((()=>{s=this.z-(this.zoomAcc>0?1:-1);const[n,i]=this.model.zoom;n<=s&&s<=i&&([t,e]=this.zoomPos,this.zoomAcc<0?(t*=.5,e*=.5,this.pos=[this.pos[0]+t/2**this.z,this.pos[1]+e/2**this.z]):(t=1*-t,e=1*-e,this.pos=[this.pos[0]+t/2**this.z,this.pos[1]+e/2**this.z]),this.z_manual=s),this.zoomAcc=0,this.zoomCount=0,this.zoomTimer=null}),40));else{const{z:s}=this;this.pos=[this.pos[0]-t/2**s,this.pos[1]-e/2**s]}}number(t){return Number(t)}}const Ot="https://raw.githubusercontent.com/mpld3/mpld3";let zt={d3:`${Ot}/2cd46f942703a098b2183791cff71ce63ee30092/mpld3/js/d3.v5.min.js`,mpl:`${Ot}/2cd46f942703a098b2183791cff71ce63ee30092/mpld3/js/mpld3.v0.5.1.min.js`,async draw_figure(t,e){const s=await fetch(zt.d3),n=await s.text(),i=new Function(`var module={exports:{}}, exports=module.exports; ${n}; return module.exports;`)(),r=await fetch(zt.mpl),o=await r.text(),c=new Function("d3",`var module={exports:{}}; ${o}; return module.exports;`)(i);return zt=c,zt.draw_figure(t,e)}};const Tt=g.create({Plotly:r((function(){return new Promise(((t,e)=>{document.head.append(Object.assign(document.createElement("script"),{type:"text/javascript",src:"https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.54.5/plotly.min.js",onload(){t(window.Plotly)},onerror(){e(`Error loading ${this.src}`)}}))}))}))});class Rt extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-plotly"],[":class",[[[0,["ctx.classes"]]]]]],[],[[4,1,["ctx.updater"]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.updater}]],this.owner=r((function(){return this.getOwner()})),this.app=r("owner",(function(){return this.owner.lookup("application-route")})),this.datarevision=0,this.parts=r("model.data","model.layout","model.config",(function(){if(!this.model)return[[],{},{}];this.datarevision++;const t=Object.assign(new g,this.model.layout,{datarevision:this.datarevision});return f.from([this.model.data,t,this.model.config])})),this.updater=r("parts.@each","parts.1.datarevision",(function(){this.react()})),["addTraces","deleteTraces","extendTraces","moveTraces","prependTraces","purge","relayout","restyle","update"].forEach((t=>{this[t]=function(...e){return Tt.Plotly[t].call(Tt.Plotly,this.getElement(),...e)}}))}async didInsertElement(){await this.react(),this.resizer=this.owner.asyncEvent((()=>{this.forwarded.forEach((t=>this.getElement().removeAllListeners(t))),Tt.Plotly.purge(this.getElement()),this.newPlot(),this.setupListeners()})),window.addEventListener("resize",this.resizer),this.setupListeners()}setupListeners(){this.forwarded=["afterplot","animated","autosize","click","deselect","doubleclick","hover","redraw","relayout","restyle","selected","selecting","unhover"].map((t=>{const e=`plotly_${t}`;return t=`on${t}`,this.getElement().on(e,((...e)=>{this[t]&&this[t].call(this,...e)})),e}))}async willRemoveElement(){window.removeEventListener("resize",this.resizer),this.forwarded.forEach((t=>this.getElement().removeAllListeners(t))),Tt.Plotly.purge(this.getElement())}plot(){return Tt.Plotly.plot(this.getElement(),...this.parts)}newPlot(){return Tt.Plotly.newPlot(this.getElement(),...this.parts)}async react(){return(await Tt.Plotly).react(this.getElement(),...this.parts)}}const Ft=class extends g{constructor(){super(),Object.assign(this,{actions:{id:0},afterRender:[],components:{"link-to":k},id:1,initializers:{},loops:[],rootElement:"body",singletons:{},router:null,rootNode:null})}async documentReady(){for(let t of Object.values(this.initializers))await t.apply(this);return this.router=Q.create({__owner__:this,routes:this.routes}),window.onpopstate=()=>this.router.updateFromLocation(),this.rootNode=this.lookup("application-route"),this.rootNode.__doc__=document,this.rootNode.initializeLeaf(),this.rootNode.leaf.render(document.querySelector(this.rootElement)||document.body),this.router.updateFromLocation()}lookup(t){if(!this.singletons[t]){let e=this.components[t];this.singletons[t]=e?e.create({tagName:t,__owner__:this}):M.create({__owner__:this,template:[JSON.stringify([[2,`Autogenerated routable component ${t} `],[3,"div",[["class",t]],[],[[3,"m-slot",[],[],[]]]]]),[]]})}return this.singletons[t]}init(){const t=["interactive","complete"];if(t.includes(document.readyState))setTimeout((()=>this.documentReady()),0);else{const e=document.onreadystatechange;document.onreadystatechange=()=>{e&&e(),t.includes(document.readyState)&&(document.onreadystatechange=e,this.documentReady())}}}scheduleRunLoop(){this.reqid||(this.reqid=requestAnimationFrame((()=>this.update())))}asyncEvent(t){const e=this;return function(s){t.call(this,s),e.scheduleRunLoop()}}addAfterRender(t){this.afterRender.push(t)}update(){this.loops.pop(),this.now=Date.now(),this.reqid=null,this.rootNode.update(),this.afterRender.forEach((t=>t())),this.afterRender=[]}async ajax(t){const e=t.method||"GET",s=Object.assign({},t.headers);let n,i,r=t.url;"GET"===e&&t.data&&(r+=`?${new URLSearchParams(t.data).toString()}`),"GET"!==e&&t.data&&(s["Content-Type"]="application/json;charset=UTF-8",n=JSON.stringify(t.data));try{i=await fetch(r,{method:e,headers:s,body:n})}catch(t){throw{status:600,error:"Cannot connect to server"}}if(!i.ok){let t;try{t=await i.json()}catch(e){t="error not json"}throw{status:i.status,error:t}}return"raw"===t.responseType?i:"arraybuffer"===t.responseType?await i.arrayBuffer():await i.json()}saveData(t,e){const s=document.createElement("a");document.body.appendChild(s),s.style="display: none";const n=window.URL.createObjectURL(t);s.href=n,s.download=e,s.click(),window.URL.revokeObjectURL(n),s.remove()}}.create({version:"21.12.0+ce"});Ft.components["application-route"]=class extends M{constructor(){super(),this.template=['[[0,[[[3,"div",[["class","m-notification is-danger"]],[],[[2,"\\n        Your MARV installation is not secured. Please make sure your webserver\\n        serves MARV over an encrypted https connection.\\n      "]]]],[[3,"div",[["class","l-app"]],[],[[3,"nav",[["class","m-navbar"]],[],[[3,"div",[["class","m-navbar-brand"]],[],[[3,"link-to",[["href",""],["classes","m-navbar-item"]],[],[[3,"img",[[":src",1,["ctx.marvLogo"]],["alt","MARV Robotics"]],[],[]]]],[3,"a",[["role","button"],["class","m-navbar-burger"],[":class",[[["is-active"],[2,["ctx.navbarOpen"]]]]],["@click",3,[]]],[],[[3,"span",[["aria-hidden","true"]],[],[]],[3,"span",[["aria-hidden","true"]],[],[]],[3,"span",[["aria-hidden","true"]],[],[]]]]]],[3,"div",[["class","m-navbar-menu"],[":class",[[["is-active"],[2,["ctx.navbarOpen"]]]]]],[],[[3,"div",[["class","m-navbar-start"]],[],[[3,"div",[["class","m-navbar-item has-dropdown"],[":class",[[["is-active"],[4,["ctx.collectionsOpen"]]]]]],[],[[3,"a",[["class","m-navbar-link"],["@click",5,[]]],[],[[2,"\\n                    Collection "],[0,[[[2,"("],[3,"b",[],[],[[4,6,["ctx.activeCollection"]]]],[2,")"]]],[[4,6,["ctx.activeCollection"]]]]]],[3,"div",[["class","m-navbar-dropdown"]],[],[[0,[[[1,[8,["ctx.model.collections"]],["item"],[[3,"link-to",[[":href",9,["item.name"]],["classes","m-navbar-item"]],[],[[4,10,["parent.item.name"]]]]]]],[[3,"a",[["class","m-navbar-item"]],[],[[2,"No collections available"]]]]],[[4,7,["ctx.model.collections.length"]],[4,null,[]]]]]]]],[1,[11,["ctx.owner.headerlinks"]],["route"],[[3,"link-to",[[":href",12,["route.route"]],["classes","m-navbar-item"]],[],[[4,13,["parent.route.text"]]]]]],[0,[[[3,"link-to",[["classes","m-navbar-item"],["href","admin"]],[],[[3,"widget-icon",[["color","white"],["glyph","wrench"]],[],[]]]]]],[[4,14,["ctx.acl.admin"]]]]]],[3,"div",[["class","m-navbar-end"]],[],[[3,"a",[["class","m-navbar-item"],["@click",15,[]]],[],[[0,[[[3,"span",[],[],[[2,"\\n                  Sign out "],[3,"strong",[],[],[[4,16,["ctx.user"]]]]]]],[[2,"Sign in"]]],[[4,16,["ctx.user"]],[4,null,[]]]]]]]]]]]],[3,"div",[["class","m-container is-fluid l-main"]],[],[[0,[[[3,"div",[["class","m-message is-danger"]],[],[[3,"div",[["class","m-message-body"]],[],[[2,"\\n                Request failed: "],[4,17,["ctx.owner.ajaxError"]]]]]]]],[[4,17,["ctx.owner.ajaxError"]]]],[3,"widget-waiting",[["icon","lock-locked"],["acl","true"],[":user",16,["ctx.user"]],["e401","Sign in to access site"],[":e403",18,["ctx.user"]]],[],[[3,"m-slot",[],[],[]]]]]],[3,"form",[["@submit",19,[]]],[],[[3,"widget-modal",[[":open",20,["ctx.signinOpen"]],[":setopen",21,[]],["title","Sign in"]],["target"],[[3,"div",[["into","body"]],[],[[3,"div",[["class","m-tabs is-boxed"]],[],[[3,"ul",[],[],[[3,"li",[[":class",[[["is-active"],[22,["ctx.realm"]]]]]],[],[[3,"a",[["@click",23,[]]],[],[[2,"MARV"]]]]],[1,[24,["ctx.model.realms"]],["r"],[[3,"li",[[":class",[[["is-active"],[25,["ctx.realm","r"]]]]]],[],[[3,"a",[["@click",26,[]]],[],[[4,27,["r"]]]]]]]]]]]],[3,"p",[],[],[[2," "]]],[3,"div",[["class","l-tab-content"]],[],[[3,"div",[["role","tabpanel"],["class","m-tab-pane is-active"]],[],[[0,[[[3,"div",[["class","m-field"]],[],[[3,"label",[["class","m-label"]],[],[[2,"Username"]]],[3,"input-control",[["classes","m-input"],["placeholder","username"],["name","username"],[":value",28,["ctx.username"]],[":changeaction",29,[]]],[],[]]]],[3,"div",[["class","m-field"],[":class",[[["is-danger"],[30,["ctx.password_error"]]]]]],[],[[3,"label",[["class","m-label"]],[],[[2,"Password"]]],[3,"input-control",[["type","password"],[":classes",[[["m-input"],[1]]]],["placeholder","password"],["name","password"],[":value",31,["ctx.password"]],[":changeaction",32,[]]],[],[]],[3,"div",[["class","m-help"]],[],[[4,30,["ctx.password_error"]]]]]]],[[3,"auth-o2",[[":realm",33,["ctx.realm"]],[":authendpoint",34,[]],[":authcomplete",35,[]]],[],[]]]],[[4,22,["ctx.realm"]],[4,null,[]]]]]]]]]],[3,"div",[["into","footer"],["class","m-buttons mu-d-flex-grow-1 mu-justify-content-end"]],[],[[3,"button",[["type","button"],["class","m-button"],["@click",36,[]]],[],[[2,"Cancel"]]],[3,"button",[["type","submit"],["class","m-button is-primary is-outlined"]],[],[[2,"Sign in"]]]]]]]]],[3,"widget-modal",[[":open",37,["ctx.apiError"]],[":setopen",38,[]],["title","Operation failed"],["as","target"]],[],[[3,"div",[["into","body"]],[],[[3,"div",[],[],[[2,"Status: "],[3,"b",[],[],[[4,39,["ctx.apiError.status"]]]]]],[3,"div",[],[],[[2,"Reason: "],[3,"b",[],[],[[4,40,["ctx.apiError.error"]]]]]]]],[3,"div",[["into","footer"],["class","m-buttons mu-d-flex-grow-1 mu-justify-content-end"]],[],[[3,"button",[["type","button"],["class","m-button"],["@click",41,[]]],[],[[2,"Dismiss"]]]]]]],[3,"nav",[["class","m-navbar is-expanded"]],[],[[3,"div",[["class","m-navbar-brand"]],[],[[3,"a",[["class","m-navbar-item"],["href","https://ternaris.com"],["rel","noopener"],["target","_blank"]],[],[[3,"img",[[":src",42,["ctx.ternarisLogo"]],["alt","TERNARIS"]],[],[]]]]]],[3,"div",[["class","m-navbar-menu"]],[],[[3,"div",[["class","m-navbar-start"]],[],[[1,[43,["ctx.owner.footerlinks"]],["link"],[[3,"a",[["class","m-navbar-item"],[":href",44,["link.href"]],["rel","noopener"],["target","_blank"]],[],[[4,45,["link.text"]]]]]],[1,[46,["ctx.owner.footerroutes"]],["route"],[[3,"link-to",[["classes","m-navbar-item"],[":href",12,["route.route"]]],[],[[4,13,["parent.route.text"]]]]]]]],[3,"div",[["class","m-navbar-end"]],[],[[3,"div",[["class","m-navbar-item"]],[],[[2,"\\n                version "],[4,47,["ctx.version"]]]],[0,[[[3,"div",[["class","m-navbar-item has-dropdown has-dropdown-up"],[":class",[[["is-active"],[49,["ctx.licenseOpen"]]]]]],[],[[3,"a",[["class","m-navbar-link"],[":class",[[["mu-c-danger"],[50,["ctx.licenseOk"]]]]],["@click",51,[]]],[],[[3,"span",[],[],[[4,52,["ctx.owner.license.licensee"]],[2," "]]],[3,"widget-icon",[[":glyph",53,["ctx.licenseOk"]]],[],[]]]],[3,"div",[["class","m-navbar-dropdown is-right l-license"]],[],[[3,"p",[],[],[[2,"\\n                    Licensee: "],[3,"strong",[],[],[[4,52,["ctx.owner.license.licensee"]]]]]],[3,"p",[],[],[[2,"\\n                    Type: "],[3,"strong",[],[],[[4,54,["ctx.owner.license.type"]]]]]],[3,"p",[],[],[[0,[[[2,"\\n                      Expired:\\n                      "],[3,"strong",[["class","mu-c-danger"]],[],[[4,56,["ctx.format_date","ctx.owner.license.expires"]]]]],[[2,"\\n                      Expires: "],[3,"strong",[],[],[[4,56,["ctx.format_date","ctx.owner.license.expires"]]]]]],[[4,55,["ctx.licenseExpired"]],[4,null,[]]]]]],[3,"p",[],[],[[0,[[[2,"\\n                      Hostnames:\\n                      "],[3,"strong",[["class","mu-c-danger"]],[],[[1,[58,["ctx.owner.license.hostnames"]],["name"],[[4,59,["name"]],[2," "]]]]]],[[2,"\\n                      Hostnames:\\n                      "],[3,"strong",[],[],[[1,[58,["ctx.owner.license.hostnames"]],["name"],[[4,59,["name"]],[2," "]]]]]]],[[4,57,["ctx.licenseBadhost"]],[4,null,[]]]]]],[0,[[[3,"p",[],[],[[2,"\\n                    Details: "],[3,"span",[["::html",60,["ctx.owner.license.details"]]],[],[]]]]]],[[4,60,["ctx.owner.license.details"]]]]]]]]]],[[4,48,["ctx.owner.license"]]]]]]]]]]]]]],[[4,0,["ctx.insecure"]],[4,null,[]]]]]',[function(){return this.ctx.insecure},function(){return this.ctx.marvLogo},function(){return this.ctx.navbarOpen},function(t){this.ctx.navbarOpen=!this.ctx.navbarOpen},function(){return this.ctx.collectionsOpen},function(t){this.ctx.collectionsOpen=!this.ctx.collectionsOpen},function(){return this.ctx.activeCollection},function(){return this.ctx.model.collections&&this.ctx.model.collections.length},function(){return this.ctx.model.collections},function(){return"collection/"+this.item.name},function(){return this.parent.item.name},function(){return this.ctx.owner.headerlinks},function(){return this.route.route},function(){return this.parent.route.text},function(){return this.ctx.acl.admin},function(t){this.ctx.user?this.ctx.setSessionid(null):this.ctx.openSignin()},function(){return this.ctx.user},function(){return this.ctx.owner.ajaxError},function(){return"User "+this.ctx.user+" is not permitted to enter this site"},function(t){this.ctx.signin(t)},function(){return this.ctx.signinOpen},function(){return t=>this.ctx.signinOpen=t},function(){return"marv"===this.ctx.realm},function(t){this.ctx.realm="marv"},function(){return this.ctx.model.realms},function(){return this.ctx.realm===this.r},function(t){this.ctx.realm=this.r},function(){return this.r},function(){return this.ctx.username},function(){return t=>this.ctx.username=t},function(){return this.ctx.password_error},function(){return this.ctx.password},function(){return t=>this.ctx.password=t},function(){return this.ctx.realm},function(){return t=>this.ctx.authEndpoint(t)},function(){return t=>this.ctx.authComplete(t)},function(t){this.ctx.signinOpen=!1},function(){return this.ctx.apiError},function(){return t=>this.ctx.apiError=t},function(){return this.ctx.apiError.status},function(){return this.ctx.apiError.error},function(t){this.ctx.apiError=!1},function(){return this.ctx.ternarisLogo},function(){return this.ctx.owner.footerlinks},function(){return this.link.href},function(){return this.link.text},function(){return this.ctx.owner.footerroutes},function(){return this.ctx.version},function(){return this.ctx.owner.license},function(){return this.ctx.licenseOpen},function(){return!this.ctx.licenseOk},function(t){this.ctx.licenseOpen=!this.ctx.licenseOpen},function(){return this.ctx.owner.license.licensee},function(){return this.ctx.licenseOk?"shield":"warning"},function(){return this.ctx.owner.license.type},function(){return this.ctx.licenseExpired},function(){return this.ctx.format_date(this.ctx.owner.license.expires)},function(){return this.ctx.licenseBadhost},function(){return this.ctx.owner.license.hostnames},function(){return this.name},function(){return this.ctx.owner.license.details}]],this.ternarisLogo="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNi4xNjUgMC45OSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTS4yNi45NzJoLjIyN1YuMjA4aC4yNnYtLjE5SDB2LjE5aC4yNnpNLjg1My45NzJoLjYydi0uMTloLS4zOTFWLjU3OGguMzIxdi0uMTloLS4zMjF2LS4xOGguMzc1di0uMTlILjg1M3pNMS42Mi45NzJoLjIyOVYuNjM3aC4xMTFsLjE3Ni4zMzVoLjI1NUwyLjE4LjU5NGMuMDk4LS4wNDcuMTY0LS4xMzYuMTY0LS4yNzYgMC0uMjMtLjE3LS4zLS4zNzMtLjNoLS4zNXptLjIyOS0uNTE2Vi4xOThoLjEwNGMuMTA4IDAgLjE2Ny4wMy4xNjcuMTIgMCAuMDkxLS4wNTkuMTM4LS4xNjcuMTM4ek0yLjQ4Ni45NzJoLjIxN3YtLjMyYzAtLjExNS0uMDE3LS4yNDctLjAyOS0uMzUzaC4wMDZjLjAzLjA3NS4wNi4xNTEuMDkyLjIxNmwuMjM2LjQ1N2guMjM1Vi4wMThoLS4yMTZ2LjMyYzAgLjExNC4wMTguMjUuMDMuMzUzSDMuMDVhMi4yNjYgMi4yNjYgMCAwIDAtLjA5NC0uMjE2TDIuNzIyLjAxOGgtLjIzNnpNMy42NTYuNDk0Yy4wMjUtLjA5NC4wNS0uMjA3LjA3NC0uMzA2aC4wMDVjLjAyNS4xLjA1LjIxMi4wNzUuMzA2bC4wMi4wODJoLS4xOTR6bS0uMzUzLjQ3OGguMjMzbC4wNTYtLjIyaC4yODNsLjA1Ni4yMmguMjRMMy44NzMuMDE4aC0uMjcyek00LjIzLjk3MmguMjI4Vi42MzdoLjExMmwuMTc2LjMzNUg1TDQuNzg4LjU5NGMuMDk4LS4wNDcuMTY0LS4xMzYuMTY0LS4yNzYgMC0uMjMtLjE3LS4zLS4zNzItLjNoLS4zNXptLjIyOC0uNTE2Vi4xOThoLjEwNGMuMTA5IDAgLjE2Ny4wMy4xNjcuMTIgMCAuMDkxLS4wNTguMTM4LS4xNjcuMTM4ek01LjA5Ni45NzJoLjIyOVYuMDE4aC0uMjN6TTUuOC45OWMuMjMxIDAgLjM2NS0uMTQuMzY1LS4zIDAtLjEzMy0uMDctLjIxMi0uMTktLjI1OUw1Ljg1Ny4zODNDNS43Ny4zNDkgNS43MS4zMyA1LjcxLjI3NGMwLS4wNS4wNDYtLjA3Ny4xMTYtLjA3N2EuMzQuMzQgMCAwIDEgLjE5LjA3bC4xMi0uMTQ4QS40NTguNDU4IDAgMCAwIDUuODI3IDBjLS4yMDIgMC0uMzQ2LjEzLS4zNDYuMjg5IDAgLjEzOC4wOTIuMjIxLjE5NC4yNjFsLjEyMS4wNTNjLjA4NC4wMzQuMTM1LjA1MS4xMzUuMTA3IDAgLjA1MS0uMDQuMDgzLS4xMjYuMDgzYS4zODEuMzgxIDAgMCAxLS4yNC0uMDlsLS4xMi4xNDhjLjEuMDk1LjIyNy4xMzkuMzU2LjEzOXoiLz4KPC9zdmc+Cg==",this.marvLogo="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMC40OTkgMC4yMTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0wIC4xMDRoLjAyNXYtLjAzQy4wMjUuMDYyLjAyMi4wNDMuMDIuMDMybC4wMS4wMjguMDEyLjAzNWguMDE1TC4wNy4wNi4wOC4wMzNhLjQyOC40MjggMCAwIDAtLjAwMy4wNHYuMDMxaC4wMjVWMGgtLjAzTC4wNTguMDQzLjA1LjA2LjA0NS4wNDMuMDMgMEgwek0uMTUxLjA1My4xNTguMDJILjE2bC4wMDguMDMzLjAwMS4wMDhILjE1em0tLjA0LjA1MWguMDI4TC4xNDQuMDgyaC4wM2wuMDA1LjAyMmguMDI5TC4xNzYgMEguMTQzek0uMjE4LjEwNGguMDI3Vi4wNjloLjAxbC4wMTkuMDM1aC4wM0wuMjgyLjA2NEMuMjkyLjA1OC4yOTkuMDQ4LjI5OS4wMzQuMjk5LjAwOC4yNzkgMCAuMjU3IDBoLS4wNHpNLjI0NS4wNDdWLjAyMmguMDFjLjAxIDAgLjAxNy4wMDMuMDE3LjAxMiAwIC4wMDktLjAwNi4wMTMtLjAxNy4wMTN6TS4zMzIuMTA0aC4wMzNMLjM5NyAwSC4zNjlMLjM1Ny4wNDUuMzUuMDc4Qy4zNDUuMDY4LjM0My4wNTYuMzQuMDQ1TC4zMzEgMEguMzAyeiIvPgo8cGF0aCBmaWxsPSIjZmZmIiBkPSJNMCAuMjEzaC4wMVYuMThoLjAxNGwuMDIuMDMzaC4wMUwuMDM1LjE4Qy4wNDYuMTc2LjA1My4xNy4wNTMuMTU3LjA1Mi4xNDEuMDQxLjEzNS4wMjUuMTM1SDB6bS4wMS0uMDR2LS4wM2guMDEzYy4wMTIgMCAuMDIuMDA0LjAyLjAxNFMuMDM0LjE3Mi4wMjIuMTcyek0uMDk2LjIxNUMuMTE2LjIxNS4xMy4xOTkuMTMuMTc0Uy4xMTYuMTM0LjA5Ni4xMzRjLS4wMiAwLS4wMzMuMDE1LS4wMzMuMDRzLjAxNC4wNC4wMzMuMDR6bTAtLjAwOUMuMDgyLjIwNi4wNzMuMTkzLjA3My4xNzRjMC0uMDIuMDEtLjAzMi4wMjMtLjAzMkMuMTEuMTQyLjEyLjE1NC4xMi4xNzRTLjExLjIwNi4wOTYuMjA2ek0uMTQ2LjIxM2guMDI1Qy4xOS4yMTMuMjAxLjIwNi4yMDEuMTkuMjAxLjE4LjE5NC4xNzMuMTg1LjE3Mi4xOTIuMTY4LjE5Ny4xNjEuMTk3LjE1My4xOTcuMTQuMTg1LjEzNC4xNjkuMTM0SC4xNDZ6bS4wMS0uMDQ1Vi4xNDNoLjAxMmMuMDEyIDAgLjAxOS4wMDMuMDE5LjAxMiAwIC4wMDgtLjAwNi4wMTMtLjAyLjAxM3ptMCAuMDM3di0uMDNILjE3Qy4xODQuMTc2LjE5LjE4LjE5LjE5LjE5MS4yLjE4My4yMDUuMTcuMjA1ek0uMjQ1LjIxNWMuMDIgMCAuMDMzLS4wMTYuMDMzLS4wNDFTLjI2NC4xMzQuMjQ1LjEzNEMuMjI1LjEzMy4yMS4xNDguMjEuMTczcy4wMTQuMDQuMDM0LjA0em0wLS4wMDlDLjIzLjIwNi4yMjIuMTkzLjIyMi4xNzRjMC0uMDIuMDA5LS4wMzIuMDIzLS4wMzJzLjAyMy4wMTIuMDIzLjAzMi0uMDEuMDMyLS4wMjMuMDMyek0uMzA4LjIxM2guMDF2LS4wN2guMDI0Vi4xMzVILjI4NHYuMDA4aC4wMjR6TS4zNTUuMjEzaC4wMVYuMTM1aC0uMDF6TS40MTUuMjE1QS4wMy4wMyAwIDAgMCAuNDQuMjA0TC40MzQuMTk4YS4wMjMuMDIzIDAgMCAxLS4wMTkuMDA4Qy40MDEuMjA2LjM5MS4xOTQuMzkxLjE3NFMuNDAxLjE0Mi40MTYuMTQyYy4wMDcgMCAuMDEyLjAwMy4wMTYuMDA3TC40MzcuMTQzYS4wMy4wMyAwIDAgMC0uMDIxLS4wMUMuMzk2LjEzMy4zOC4xNS4zOC4xNzRjMCAuMDI2LjAxNC4wNC4wMzQuMDR6TS40NzIuMjE1Yy4wMTYgMCAuMDI3LS4wMS4wMjctLjAyM0MuNDk5LjE4MS40OTIuMTc1LjQ4Mi4xNzJMLjQ3Mi4xNjZDLjQ2NC4xNjQuNDU3LjE2LjQ1Ny4xNTRjMC0uMDA3LjAwNi0uMDEyLjAxNS0uMDEyQy40OC4xNDIuNDg2LjE0NS40OS4xNUwuNDk2LjE0M2EuMDMzLjAzMyAwIDAgMC0uMDIzLS4wMWMtLjAxNSAwLS4wMjUuMDEtLjAyNS4wMjEgMCAuMDEyLjAwOS4wMTcuMDE2LjAyTC40NzUuMThjLjAwOC4wMDMuMDEzLjAwNS4wMTMuMDEzUy40ODIuMjA2LjQ3Mi4yMDZBLjAzMS4wMzEgMCAwIDEgLjQ1LjE5NkwuNDQ0LjIwNGEuMDM3LjAzNyAwIDAgMCAuMDI4LjAxMnoiLz4KPC9zdmc+Cg==",this.timezones=r("model",(function(){return[{name:"localtime",value:void 0}]})),this.distances=r((function(){return[{name:"kilometers",value:"km"},{name:"meters",value:"m"},{name:"miles",value:"mi"},{name:"nautical miles",value:"nmi"}]})),this.speeds=r((function(){return[{name:"kilometers per hour",value:"km/h"},{name:"feet per second",value:"ft/s"},{name:"knots",value:"knots"},{name:"mach",value:"mach"},{name:"meters per second",value:"m/s"},{name:"miles per hour",value:"mi/h"}]})),this.accelerations=r((function(){return[{name:"meters per square second",value:"m/s"},{name:"feet per square second",value:"ft/s"},{name:"standard gravity",value:"g"}]})),this.timezoneSelected=r("timezones",{get(){const t=localStorage.getItem("marv-displayTimezone");return this.timezones.find((e=>e.name===t))||this.timezones[0]}}),this.distanceSelected=r("distances",{get(){const t=localStorage.getItem("marv-displayDistance");return this.distances.find((e=>e.name===t))||this.distances[0]}}),this.speedSelected=r("speeds",{get(){const t=localStorage.getItem("marv-displaySpeed");return this.speeds.find((e=>e.name===t))||this.speeds[0]}}),this.accelerationSelected=r("accelerations",{get(){const t=localStorage.getItem("marv-displayAcceleration");return this.accelerations.find((e=>e.name===t))||this.accelerations[0]}}),this.displayTimezone=r("timezoneSelected",(function(){return this.timezoneSelected.value})),this.displayDistance=r("distanceSelected",(function(){return this.distanceSelected.value})),this.displaySpeed=r("speedSelected",(function(){return this.speedSelected.value})),this.displayAcceleration=r("accelerationSelected",(function(){return this.accelerationSelected.value})),this.owner=r("owner",(function(){return this.getOwner()})),this.collectionsOpen=r("owner.router.currentLocation",(()=>!1)),this.hostname=r((function(){return location.hostname})),this.isLocalhost=r((function(){const{hostname:t}=this;return"localhost"===t||/^127\./.test(t)})),this.insecure=r((function(){return"http:"===location.protocol&&!this.isLocalhost})),this.sessionid=r("owner.sw",(function(){const t=JSON.parse(localStorage.session||"{}");var e;return 1===t.version?(null===(e=this.owner.sw)||void 0===e||e.postMessage({action:"setSession",session:t}),t.id):(localStorage.session=JSON.stringify({version:1,id:null}),null)})),this.user=r("sessionid",(function(){return this.sessionid?JSON.parse(atob(this.sessionid.split(".")[1])).sub:null})),this.username="",this.password="",this.password_error=r("username","password",(()=>"")),this.model=r("user",(async function(){return this.user,await this.api({url:"meta"})})),this.acl=r("model",(function(){const t={};return this.model.acl&&this.model.acl.forEach((e=>t[e.replace("-","_")]=!0)),t})),this.apiEndpoint=`${document.querySelector("base").href}marv/api/`,this.version=r((function(){return this.getOwner().version})),this.releases=[],this.realm="marv",this.licenseExpired=r("owner.license",(function(){const{expires:t}=this.owner.license;return new rt(t)<Date.now()})),this.licenseBadhost=r("owner.license",(function(){const{hostnames:t}=this.owner.license;return!(t.includes(this.hostname)||this.isLocalhost)})),this.licenseOk=r("licenseExpired","licenseBadhost",(function(){return!this.licenseExpired&&!this.licenseBadhost})),this.format_date=r("owner.formatters.version",(function(){return this.owner.formatters["format-date"]}))}openSignin(){this.signinOpen=!0,this.getOwner().addAfterRender((()=>{const t=this.getElement().querySelector("input[placeholder=username]");t&&t.focus()}))}async signin(t){t.preventDefault();const e={url:"auth",method:"POST",data:{username:this.username,password:this.password}};try{const t=await this.api(e);this.setSessionid(t.access_token),this.username="",this.password="",this.signinOpen=!1}catch(t){let e;e=t.status>=600?"check your network connection":t.status>=500?"server side error, try again later":"check your username and password",this.password_error=`Could not sign in: ${e}`}this.getOwner().asyncEvent((()=>{}))()}setSessionid(t){var e;const s=JSON.parse(localStorage.session||"{}");s.id=t,localStorage.session=JSON.stringify(s),this.sessionid=t,null===(e=this.owner.sw)||void 0===e||e.postMessage({action:"setSession",session:s})}async api(t,e){const s=t.url;t.url=`${this.apiEndpoint}${t.url}`,this.sessionid&&(t.headers=Object.assign({Authorization:`Bearer ${this.sessionid}`},t.headers)),this.loading=!0;try{const e=await this.getOwner().ajax(t);return this.loading=!1,this.error=e.error,e}catch(n){if(401===n.status){if(this.setSessionid(null),t.headers&&t.headers.Authorization)return delete t.headers.Authorization,t.url=s,this.api(t)}else this.error="The frontend is unable to communicate with the server.";throw e&&(this.apiError=n),n}}comment(t){return this.api({url:"comment",method:"POST",data:t},!0)}tag(t){return this.api({url:"tag",method:"POST",data:t},!0)}getFilelist(t){return this.api({url:"file-list",method:"POST",data:t},!0)}delete(t){return this.api({url:"dataset",method:"DELETE",data:t},!0)}authComplete(t){this.setSessionid(t),this.username="",this.password="",this.signinOpen=!1}authEndpoint(t){const e={url:"oauth2",method:"POST",data:t};return this.api(e)}},Ft.components["button-confirm"]=class extends b{constructor(){super(),this.template=['[[0,[[[3,"a",[[":class",[[[1,["ctx.classes"]]],[[2,["ctx.buttonclasses"]]]]],["@click",3,[]]],[],[[3,"m-slot",[],[],[]]]]],[[3,"button",[[":class",[[[1,["ctx.classes"]]],[[2,["ctx.buttonclasses"]]]]],[":disabled",4,["ctx.disabled"]],["@click",3,[]]],[],[[3,"m-slot",[],[],[]]]]]],[[4,0,["ctx.mode"]],[4,null,[]]]],[3,"widget-modal",[[":open",5,["ctx.modalOpen"]],["classes","is-normal"],[":setopen",6,[]],[":title",7,["ctx.title"]]],["modal"],[[3,"div",[["into","body"]],[],[[4,8,["ctx.text"]]]],[3,"div",[["into","footer"],["class","m-buttons mu-d-flex-grow-1 mu-justify-content-end"]],[],[[3,"button",[[":class",[[[1,["ctx.classes"]]]]],["@click",9,[]]],[],[[2,"Cancel"]]],[3,"button",[[":class",[[[1,["ctx.classes"]]],[[10,["ctx.actionbuttonclasses"]]]]],["@click",11,[]]],[],[[4,12,["ctx.confirmtext"]]]]]]]]]',[function(){return"link"===this.ctx.mode},function(){return this.ctx.classes},function(){return this.ctx.buttonclasses},function(t){this.ctx.check()},function(){return this.ctx.disabled},function(){return this.ctx.modalOpen},function(){return t=>this.ctx.modalOpen=t},function(){return this.ctx.title},function(){return this.ctx.text},function(t){this.ctx.modalOpen=!1},function(){return this.ctx.actionbuttonclasses},function(t){this.ctx.execute()},function(){return this.ctx.confirmtext??"Confirm"}]],this.modalOpen=!1}check(){this.modalOpen=!0}execute(){this.action(),this.modalOpen=!1}},Ft.initializers.ce=async function(){const{widgets:t,formats:e}=window.marv_extensions||{};this.helpers={};for(let[e,[s,n]]of Object.entries(t||{}))this.components[`widget-${e}`]=class extends b{constructor(){super(),this.template=`<div class="widget-${e}"></div>`}didInsertElement(){this.state=s(this.getElement(),JSON.parse(JSON.stringify(this.model)))}willRemoveElement(){n(this.state)}};this.__app__=this.lookup("application-route"),this.formatters=g.create({"print-relatime":t=>new rt(t).fromNow(),"format-timedelta":t=>{if(null===t)return"";const e=(t=t/1e3>>0)/3600>>0,s=(t%=3600)/60>>0;return t%=60,e?`${e}h ${String(s).padStart(2,"0")}m ${String(t).padStart(2,"0")}s`:s?`${s}m ${String(t).padStart(2,"0")}s`:`${t}s`},"format-date":(t,e)=>t?new rt(t).format(e||"YYYY-MM-DD"):"","format-datetime":(t,e)=>t?new rt(t).format(e||"YYYY-MM-DD HH:mm:ss"):"","format-localestring":(t,e)=>t.toLocaleString(navigator.language,{style:e,currency:"EUR"}),"format-icon":t=>t?new xt(`<span class="glyphicon glyphicon-${t.icon} ${t.classes}" title="${t.title}"></span>`):"","format-link":t=>{const e=(t=t||{}).external?" target=_blank":"",s=t.href,n=t.title;return new xt(`<a href="${s}" ${e}>${n}</a>`)},"format-pill":t=>new xt(`<span class="m-tag">${t}</span>`),"format-filesize":t=>{if(0===t)return"0.00 B";const e=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,e)).toFixed(2)+" "+" KMGTP".charAt(e)+"B"},"format-float":(t,e)=>{if(null===t)return"";e="number"==typeof e?e:2;const s=Math.pow(10,e);return(t*s>>0)/s},"format-int":t=>null===t?"":t,"format-string":t=>null===t?"":t,"format-route":t=>{(t=t||{}).route=t.route||"";const e=window.location.search;return new xt(`<a href="${window.location.pathname}${e||""}#/${t.route.replace(".","/")}/${t.id}">${t.title}</a>`)},"format-distance":t=>{if(null===t)return"";const e=this.__app__.displayDistance;return"km"===e?t/=1e3:"mi"===e?t/=1609.344:"nmi"===e&&(t/=1852),new Intl.NumberFormat(navigator.language,{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)+` ${e}`},"format-speed":t=>{if(null===t)return"";const e=this.__app__.displaySpeed;return"ft/s"===e?t/=.3048:"km/h"===e?t*=3.6:"knots"===e?t*=1.9438444924406046:"mach"===e?t/=343:"mi/h"===e&&(t*=2.236936292054402),new Intl.NumberFormat(navigator.language,{minimumFractionDigits:0,maximumFractionDigits:0}).format(t)+` ${e}`},"format-acceleration":t=>{if(null===t)return"";const e=this.__app__.displayAcceleration;return"ft/s"===e?t/=.3048:"g"===e&&(t/=9.80665),new Intl.NumberFormat(navigator.language,{minimumFractionDigits:0,maximumFractionDigits:0}).format(t)+` ${e}`},version:r("router.currentQuery","__app__.displayDistance","__app__.displaySpeed","__app__.displayAcceleration",(function(){return Date.now()})),__app__:this.__app__});for(let[t,s]of Object.entries(e||{}))this.helpers[`format-${t}`]=t=>s(...JSON.parse(JSON.stringify(t)));if("serviceWorker"in navigator){const{serviceWorker:t}=navigator,e=this;await async function(){try{e.sw=t.controller,e.sessionid,t.addEventListener("message",(function(s){if("getSession"===s.data.action){const t=JSON.parse(localStorage.session||"{}");e.sw.postMessage({action:"reply",reqid:s.data.reqid,payload:t})}e.sw=t.controller,e.sessionid})),t.addEventListener("controllerchange",(function(){e.sw=t.controller,e.sessionid}));const s=await(await t.register("sw.js")).update();s.installing&&await new Promise((t=>{s.installing.addEventListener("statechange",(function(){"activated"===this.state&&t()}))}))}catch(t){}}()}this.footerlinks=[{href:"https://gitlab.com/ternaris/marv-robotics",text:"Code"},{href:"https://gitlab.com/ternaris/marv-robotics/issues",text:"Issues"},{href:"docs/",text:"Documentation"}],this.listingActions=[]},Ft.components["collection-route"]=class extends M{constructor(){super(),this.template=['[[3,"widget-waiting",[["icon","list"],[":acl",0,["ctx.app.model.collections.length"]],[":user",1,["ctx.app.user"]],["e401","Sign in to access collections"],[":e403",2,["ctx.app.user","ctx.params.id"]],[":e404",3,["ctx.params.id"]]],[],[[3,"div",[["class","l-collection m-stack"]],[],[[3,"section",[],[],[[3,"h2",[["class","mu-d-flex mu-justify-content-between mu-align-items-center"]],[],[[4,4,["ctx.gsummary.title"]],[3,"button",[["type","button"],["class","m-button is-outlined"],[":class",[[["is-active"],[5,["ctx.filtersOpen"]]]]],["@click",6,[]]],[],[[4,7,["ctx.model.filters.title"]]]]]],[3,"div",[["class","l-bfilters m-card"]],[],[[0,[[[3,"widget-filter",[[":model",8,["ctx.model.filters.widget"]],[":setaction",9,[]],[":filter",10,["ctx.filter"]],[":debug",11,["ctx.debugfilters"]]],[],[]]]],[[4,5,["ctx.filtersOpen"]]]],[3,"div",[["class","m-card-body"]],[],[[3,"widget-keyval",[[":model",12,["ctx.gsummary.widget.data"]]],[],[]]]]]]]],[0,[[[3,"section",[],[],[[3,"h2",[],[],[[4,14,["ctx.model.listing.title"]]]],[3,"div",[["class","l-xfilters m-card"]],[],[[3,"div",[["class","m-card-body"]],[],[[1,[15,["ctx.xfilters"]],["filter"],[[0,[[[3,"div",[],[],[[3,"h6",[],[],[[4,17,["filter.title"]],[0,[[[3,"a",[["role","button"],["href","#"],["@click",19,[]]],[],[[2,"\\n                        reset\\n                      "]]]]],[[4,18,["filter.selected.length","filter.deselected.length"]]]]]],[3,"ul",[["class","l-xfilters-tags"]],[],[[1,[20,["filter.group.groups"]],["group"],[[3,"li",[],[],[[3,"span",[["class","m-tag"],[":class",[[["is-primary"],[21,["parent.filter.selected.includes","group.key"]]],[["is-danger"],[22,["parent.filter.deselected.includes","group.key"]]],[["l-notag"],[23,["group.key","parent.filter.selected.includes","group.key","parent.filter.deselected.includes","group.key"]]]]],["@click",24,[]]],[],[[3,"span",[["::text",25,["group.key","group.key","parent.filter.none"]]],[],[]],[3,"strong",[],[],[[2,""],[4,26,["group.value"]]]]]]]]]]]]]]],[[3,"widget-chart",[[":dim",27,["filter.dim"]],[":group",28,["filter.group"]],[":title",17,["filter.title"]],[":formatxticks",29,["filter.formatXticks"]],[":xvalues",30,["filter.xvalues"]]],[],[]]]],[[4,16,["filter.selected"]],[4,null,[]]]]]]]]]]]]]],[[4,13,["ctx.xfilters.length"]]]],[3,"section",[],[],[[0,[[[3,"h2",[],[],[[4,14,["ctx.model.listing.title"]]]]]],[[4,31,["ctx.xfilters.length"]]]],[3,"div",[["class","m-card"]],[],[[3,"div",[["class","m-card-body"]],[],[[3,"widget-keyval",[[":model",32,["ctx.lsummary.widget.data"]]],[],[]]]]]]]],[3,"section",[],[],[[3,"div",[["class","m-card"]],[],[[3,"div",[["class","m-card-body"]],[],[[3,"widget-table",[[":model",33,["ctx.listing"]],["selectableforce","true"],[":selectionchange",34,[]],[":nofilter",35,[]],["cacheid","marv-listingTable"],[":classes",[[["has-open-dd"],[36,["ctx.tagIsOpen"]]]]]],["selected"],[[3,"fieldset",[["class","mu-d-flex mu-flex-wrap mu-flex-wrap mu-flex-gap is-small"],[":disabled",37,["ctx.selectedIds.length"]]],[],[[0,[[[3,"widget-tag",[["classes","m-button"],[":disabled",39,["ctx.app.user"]],[":tags",40,["selected.params"]],[":alltags",41,["ctx.alltags"]],[":altaction",42,[]],[":changeaction",43,[]],[":openaction",44,[]]],[],[]]]],[[4,38,["ctx.acl.tag"]]]],[0,[[[3,"widget-project",[["classes","m-button"],[":disabled",39,["ctx.app.user"]],[":tags",40,["selected.params"]],[":alltags",46,["ctx.model.all_known.projects"]],[":altaction",42,[]],[":changeaction",47,[]]],[],[]]]],[[4,45,["ctx.acl.delete","ctx.model.all_known.projects"]]]],[0,[[[3,"m-dropdown",[],["dd"],[[3,"button",[["into","trigger"],["role","button"],["class","m-button m-dropdown-toggle"],["@click",49,[]]],[],[[2,"fetch file lists"]]],[3,"div",[["into","content"],["class","m-dropdown-item"]],[],[[0,[[[3,"div",[["class","m-buttons"]],[],[[3,"widget-clipboard",[["classes","m-button is-fullwidth"],[":model",51,["ctx.copyFilelist"]]],[],[]],[3,"widget-clipboard",[["classes","m-button is-fullwidth"],[":model",52,["ctx.copyUrllist"]]],[],[]]]]],[[3,"div",[],[],[[2,"\\n                          Fetching ...\\n                        "]]]]],[[4,50,["ctx.listFetched"]],[4,null,[]]]]]]]]]],[[4,48,["ctx.acl.download_raw"]]]],[0,[[[3,"m-dropdown",[],["dd"],[[3,"button",[["into","trigger"],["role","button"],["class","m-button m-dropdown-toggle"],["@click",54,[]]],[],[[2,"compare"]]],[3,"div",[["into","content"],["class","m-dropdown-item"]],[],[[0,[[[3,"a",[["@click",55,[]]],[],[[2,"\\n                          Sign in to compare\\n                        "]]]],[[3,"form",[["class","is-small"],["@submit",56,[]]],[],[[3,"div",[["class","m-field"]],[],[[3,"input-control",[["type","text"],["classes","m-input"],["placeholder","Parameter"],[":value",57,["ctx.compareParam"]],[":changeaction",58,[]]],[],[]]]],[3,"div",[["class","m-field m-buttons mu-justify-content-end"]],[],[[3,"button",[["type","button"],["class","m-button"],["@click",59,[]]],[],[[2,"\\n                              Cancel\\n                            "]]],[3,"button",[["type","submit"],["class","m-button is-primary is-outlined"]],[],[[2,"\\n                              Compare\\n                            "]]]]]]]]],[[4,39,["ctx.app.user"]],[4,null,[]]]]]]]]]],[[4,53,["ctx.model.compare","ctx.acl.compare"]]]],[0,[[[3,"button-confirm",[["classes","m-button is-outlined"],["actionbuttonclasses","is-danger"],["title","Discard selected datasets"],["text","Are you sure you want to mark all selected datasets for deletion?\\n                          If the corresponding files still exists on disk, they would be\\n                          re-added as new datasets during the next scan. The discarded\\n                          datasets would be deleted during the next cleanup and their tags and\\n                          comments would be IRREVOCABLY gone."],[":disabled",39,["ctx.app.user"]],[":action",61,[]],["confirmtext","Discard selected datasets"]],[],[[2,"discard"]]]]],[[4,60,["ctx.acl.delete"]]]],[1,[62,["ctx.app.__owner__.listingActions"]],["act"],[[3,"button",[["class","m-button"],["@click",63,[]]],[],[[4,64,["act.name"]]]]]]]]]]]]]]]]]]]]]',[function(){return this.ctx.app.model.collections.length},function(){return this.ctx.app.user},function(){return"User "+this.ctx.app.user+" is not permitted to access collection "+this.ctx.params.id},function(){return"Collection "+this.ctx.params.id+" does not exist"},function(){return this.ctx.gsummary.title},function(){return this.ctx.filtersOpen},function(t){this.ctx.filtersOpen=!this.ctx.filtersOpen},function(){return this.ctx.model.filters.title},function(){return this.ctx.model.filters.widget},function(){return t=>this.ctx.setFilter(t)},function(){return this.ctx.filter},function(){return this.ctx.debugfilters},function(){return this.ctx.gsummary.widget.data},function(){return this.ctx.xfilters.length},function(){return this.ctx.model.listing.title},function(){return this.ctx.xfilters},function(){return this.filter.selected},function(){return this.filter.title},function(){return this.filter.selected.length||this.filter.deselected.length},function(t){this.ctx.toggleCnt(this.filter,"",t)},function(){return this.filter.group.groups},function(){return this.parent.filter.selected.includes(this.group.key)},function(){return this.parent.filter.deselected.includes(this.group.key)},function(){return!this.group.key&&!this.parent.filter.selected.includes(this.group.key)&&!this.parent.filter.deselected.includes(this.group.key)},function(t){this.ctx.toggleCnt(this.parent.filter,this.group.key,t)},function(){return this.group.key?this.group.key:this.parent.filter.none},function(){return this.group.value},function(){return this.filter.dim},function(){return this.filter.group},function(){return this.filter.formatXticks},function(){return this.filter.xvalues},function(){return!this.ctx.xfilters.length},function(){return this.ctx.lsummary.widget.data},function(){return this.ctx.listing},function(){return t=>this.ctx.selectionChange(t)},function(){return!0},function(){return this.ctx.tagIsOpen},function(){return!this.ctx.selectedIds.length},function(){return this.ctx.acl.tag},function(){return!this.ctx.app.user},function(){return this.selected.params},function(){return this.ctx.alltags},function(){return()=>this.ctx.openSignin()},function(){return t=>this.ctx.execTag(t)},function(){return t=>this.ctx.tagIsOpen=t},function(){return this.ctx.acl.delete&&this.ctx.model.all_known.projects},function(){return this.ctx.model.all_known.projects},function(){return t=>this.ctx.execProject(t)},function(){return this.ctx.acl.download_raw},function(t){this.ctx.getFilelist(),this.dd.open()},function(){return this.ctx.listFetched},function(){return this.ctx.copyFilelist},function(){return this.ctx.copyUrllist},function(){return this.ctx.model.compare&&this.ctx.acl.compare},function(t){this.dd.open()},function(t){this.ctx.openSignin()},function(t){this.ctx.compare(t)},function(){return this.ctx.compareParam},function(){return t=>this.ctx.compareParam=t},function(t){this.dd.close()},function(){return this.ctx.acl.delete},function(){return()=>this.ctx.deleteDataset()},function(){return this.ctx.app.__owner__.listingActions},function(t){this.act.fn.call(this.ctx,t)},function(){return this.act.name}]],this.params={},this.debugfilters=r("__owner__.router.currentQuery.debugfilters",(function(){return"1"===this.getOwner().router.currentQuery.debugfilters})),this.filter=r("__owner__.router.currentQuery.filter",(function(){return this.getOwner().router.currentQuery.filter||null})),this.filtersOpen=r("filter",(function(){return!!this.filter})),this.alltags=r("model.all_known",(function(){return f.create(this.model.all_known.f_tags)})),this.resetNdx=r("app.displayTimezone",(function(){this.app.displayTimezone,this.prevXfilters=null})),this.attrIdx=r("model","resetNdx",(function(){this.resetNdx,this.selectedIds.splice(0,this.selectedIds.length);const t={};return this.model.listing.widget.data.columns.map((t=>t.id)).forEach(((e,s)=>t[e]=s)),t})),this.prevAttrIdx=null,this.prevNdx=null,this.ndx=r("attrIdx",(function(){const{attrIdx:t,prevAttrIdx:e,model:s}=this;let n=this.prevNdx;return e&&!Object.entries(t||{}).some((([t,s])=>e[t]!==s))||(n=gt.create(),this.allDim=n.dimension((()=>null)),this.allGroup=this.allDim.group()),this.prevNdx=n,this.prevAttrIdx=t,n.clear(),n.add(s.listing.widget.data.rows),n})),this.listing=r("ndx.allFilteredA",(function(){const{model:t,ndx:e}=this,s=g.create(t.listing.widget.data);return s.rows=e.allFilteredA,s}));const t={flat:(t,e)=>t.flat(e),idx:t=>this.attrIdx[t],len:t=>void 0!==t.length?t.length:t.size,max:t=>Math.max(...t),min:t=>Math.min(...t),map:(t,e,s)=>t.map((t=>void 0!==t[e]?t[e]:s)),set:t=>new Set(t),sum:t=>t.reduce(((t,e)=>t+e),0),trace:t=>(console.log("TRACE",t),t)};function e(s,n){if(Array.isArray(s)){let[i,...r]=s;return r=r.map((t=>e(t,n))),t[i].apply(this,r)}return"object"==typeof s?n:s}function s(t,s){const n={title:t.title,widget:{type:"keyval",data:{}}};return n.widget.data.items=t.items.map((t=>({title:t.title,formatter:t.formatter,list:t.islist,value:e(t.function,s)}))),n}this.gsummary=r("model.summary_config",(function(){return s(this.model.summary_config,this.model.listing.widget.data.rows.map((t=>t.values)))})),this.lsummary=r("model.summary_config","ndx.allFilteredA",(function(){return s(this.model.summary_config,this.ndx.allFilteredA.map((t=>t.values)))})),this.prevXfilters=null,this.xfilters=r("ndx","attrIdx",(function(){const t=this.attrIdx,e=this.getOwner().crxfilters||[];return e.some((e=>void 0===t[e.key]))?(this.prevXfilters=null,[]):this.prevXfilters?(this.prevXfilters.forEach((t=>{t.selected&&(t.selected.splice(0,t.selected.length),t.deselected.splice(0,t.deselected.length),t.dim.filter())})),this.prevXfilters):this.prevXfilters=e.map((e=>{const s=Object.assign(g.create({formatXticks:yt}),e),n=t[e.key],i=t=>t.values[n];if(e.dimFn)s.dim=this.ndx.dimension((t=>e.dimFn.call(this.app,i(t))));else if(e.dimHist){const n=e.dimHist;let r,o;if("linear"===n.axis){const s=Math.ceil(n.max/n.bins)*n.bins;r=i=>n.bins*i.values[t[e.key]]/s,o=t=>t*s/n.bins}else if("logarithmic"===n.axis){const s=Math.log(n.max);r=i=>n.bins*Math.log(i.values[t[e.key]])/s,o=t=>0|Math.exp(t*s/n.bins)}else n.bins=n.axis.length,r=t=>{let e=0;for(;e+1<n.axis.length&&i(t)>n.axis[e+1];)e++;return e},o=t=>n.axis[t];s.dim=this.ndx.dimension((t=>Math.min(n.bins-1,0|r(t)))),s.formatXticks=t=>e.formatXticks(o(t)),s.xvalues=Array.from({length:n.bins},((t,e)=>e))}else s.dim=this.ndx.dimension((t=>i(t))),s.negdim=this.ndx.dimension((t=>[i(t)])),s.selected=f.create(),s.deselected=f.create(),s.none="tags"===e.key?"untagged":"none";return s.group=s.dim.group(),s}))})),this.selectedIds=f.create(),this.listFetched=r("selectedIds.@each",(function(){return!1})),this.compareParam="",this.scrollEvent=()=>{this.state.scroll=document.scrollingElement.scrollTop},this.state=r((function(){const t=JSON.parse(localStorage.state||"{}");return 1!==t.version?{version:1}:t})),this.model=r("params","filter","app.user",(async function(){const t={url:`_collection/${this.params.id}`};this.filter&&(t.data={filter:atob(this.filter)}),window.removeEventListener("scroll",this.scrollEvent),document.title=`MARV > ${this.params.id}`;const e=await this.app.api(t);return this.app.activeCollection=this.params.id,this.getOwner().addAfterRender((()=>{var t;(document.scrollingElement.scrollTo({top:this.state.scroll,left:0,behavior:"auto"}),window.addEventListener("scroll",this.scrollEvent),this.app.lastDetailHash)&&(null===(t=document.querySelector(`[href="/${this.app.lastDetailHash}"]`))||void 0===t||t.focus(),this.app.lastDetailHash=null)})),e})),this.app=r((function(){return this.getOwner().lookup("application-route")})),this.acl=r("model",(function(){const t={};return this.model.acl&&this.model.acl.forEach((e=>t[e.replace("-","_")]=!0)),t}))}selectionChange(t){this.selectedIds=f.from(t,(t=>t.id))}getFilelist(){this.app.getFilelist(this.selectedIds).then((t=>{this.copyFilelist={data:t.paths.join("\n"),title:"file paths"},this.copyUrllist={data:t.urls.map((t=>`${this.app.apiEndpoint}${t}`)).join("\n"),title:"URLs"},this.listFetched=!0}))}openCompare(){this.compareOpen=!0,this.getOwner().addAfterRender((()=>{const t=this.getElement().querySelector(".widget-compare input");t&&t.focus()}))}compare(t){t.preventDefault(),this.compareOpen=!1,this.transitionTo({route:"compare",models:[{id:btoa(JSON.stringify({collection:this.params.id,ids:this.selectedIds,param:this.compareParam})),fake:!0}]})}setState(t,e){this.state[t]=e,localStorage.state=JSON.stringify(this.state)}openSignin(){this.app.openSignin()}setFilter(t){this.transitionTo({query:{filter:t}})}execTag(t){const e={};t.added.forEach((t=>e[t]=[])),this.selectedIds.forEach((s=>{const n=this.ndx.data.find((t=>t.id==s)).tags;t.added.filter((t=>!n.includes(t))).forEach((t=>e[t].push(s)))}));const s={};t.removed.forEach((t=>s[t]=this.selectedIds));const n={[this.params.id]:{add:e,remove:s}};this.app.tag(n).then((()=>this.reloadModel()))}execProject(t){const e=this.selectedIds,s=this.ndx.data,n={add:t.added.map((t=>({project:t,ids:e.filter((e=>!s.find((t=>t.id===e)).projects.includes(t)))}))),remove:t.removed.map((t=>({project:t,ids:e.filter((e=>s.find((t=>t.id===e)).projects.includes(t)))})))};this.app.api({url:"annotate/bulk/project",method:"POST",data:n}).then((()=>this.reloadModel()))}deleteDataset(){this.app.delete(this.selectedIds).then((()=>this.reloadModel()))}reloadModel(){this.params={id:this.params.id}}willRemoveElement(){window.removeEventListener("scroll",this.scrollEvent),window.removeEventListener("beforeunload",this.beforeunload)}didInsertElement(){this.beforeunload=()=>{this.setState("scroll",document.scrollingElement.scrollTop)},window.addEventListener("beforeunload",this.beforeunload)}toggleCnt(t,e,s){s.preventDefault(),""===e?(t.selected.splice(0,t.selected.length),t.deselected.splice(0,t.deselected.length)):t.selected.includes(e)?(t.selected.splice(t.selected.indexOf(e),1),t.deselected.push(e)):t.deselected.includes(e)?t.deselected.splice(t.deselected.indexOf(e),1):t.selected.push(e),t.dim.filterFunction((e=>!t.selected.length||t.selected.includes(e))),t.negdim.filterFunction((e=>!(t.deselected.includes(null)&&!e.length)&&e.every((e=>!t.deselected.includes(e)))))}},Ft.components["detail-route"]=wt,Ft.components["field-datetime"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control is-expanded has-icons-left"]],[],[[3,"m-dropdown",[["classes","is-focusable"]],["dd"],[[3,"div",[["into","trigger"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":disabled",1,["ctx.disabled"]],[":value",2,["ctx.displayDate"]],[":changeaction",3,[]]],[],[]],[3,"widget-icon",[["glyph","calendar"],["classes","is-left"]],[],[]]]],[3,"div",[["into","content"],["class","m-dropdown-item"]],[],[[3,"div",[["class","m-calendar"]],[],[[3,"div",[],[],[[3,"button",[["type","button"],["tabindex","-1"],["@click",4,[]]],[],[[3,"widget-icon",[["glyph","chevron-left"]],[],[]]]],[3,"time",[[":datetime",5,["ctx.displayMonthyear.iso"]]],[],[[4,6,["ctx.displayMonthyear.display"]]]],[3,"button",[["type","button"],["tabindex","-1"],["@click",7,[]]],[],[[3,"widget-icon",[["glyph","chevron-right"]],[],[]]]]]],[3,"div",[],[],[[1,[8,["ctx.weekdays"]],["weekday"],[[3,"div",[],[],[[4,9,["weekday"]]]]]]]],[3,"div",[],[],[[1,[10,["ctx.days"]],["day"],[[0,[[[3,"button",[["type","button"],["tabindex","-1"],[":class",[[["is-active"],[12,["day.isCurrent"]]]]],["@click",13,[]]],[],[[3,"time",[[":datetime",14,["day.iso"]]],[],[[4,15,["day.date"]]]]]]],[[3,"div",[],[],[]]]],[[4,11,["day.isMonth"]],[4,null,[]]]]]]]]]]]]]]]],[3,"div",[["class","m-control is-expanded has-icons-left"]],[],[[3,"m-dropdown",[],["dd"],[[3,"div",[["into","trigger"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":disabled",16,[]],[":value",17,["ctx.displayTime"]],[":changeaction",3,[]]],[],[]],[3,"widget-icon",[["glyph","clock"],["classes","is-left"]],[],[]]]],[3,"div",[["into","content"],["class","m-dropdown-item"]],[],[[3,"div",[["class","m-clock"]],[],[[3,"button",[["type","button"],["tabindex","-1"],["@click",18,[]]],[],[[2,""]]],[3,"div",[],[],[]],[3,"button",[["type","button"],["tabindex","-1"],["@click",19,[]]],[],[[2,""]]],[3,"div",[["class","mu-text-center"]],[],[[4,20,["ctx.hour"]]]],[3,"div",[["class","mu-text-center"]],[],[[2,":"]]],[3,"div",[["class","mu-text-center"]],[],[[4,21,["ctx.minute"]]]],[3,"button",[["type","button"],["tabindex","-1"],["@click",22,[]]],[],[[2,""]]],[3,"div",[],[],[]],[3,"button",[["type","button"],["tabindex","-1"],["@click",23,[]]],[],[[2,""]]]]]]]]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.disabled},function(){return this.ctx.displayDate},function(){return()=>{}},function(t){this.ctx.prev()},function(){return this.ctx.displayMonthyear.iso},function(){return this.ctx.displayMonthyear.display},function(t){this.ctx.next()},function(){return this.ctx.weekdays},function(){return this.weekday},function(){return this.ctx.days},function(){return this.day.isMonth},function(){return this.day.isCurrent},function(t){this.ctx.setDate(this.day.year,this.day.month,this.day.date)},function(){return this.day.iso},function(){return this.day.date},function(){return!0},function(){return this.ctx.displayTime},function(t){this.ctx.hourUp()},function(t){this.ctx.minuteUp()},function(){return this.ctx.hour},function(){return this.ctx.minute},function(t){this.ctx.hourDown()},function(t){this.ctx.minuteDown()}]],this.weekdays=[0,1,2,3,4,5,6].map((t=>{const e=new rt;return e.weekday=t,e.format("dd")})),this.val=r("value",(function(){return this.value?new rt(this.value):(new rt).startOf("date")})),this.currentMonth=r("value",(function(){return this.val.clone().startOf("month")})),this.displayMonthyear=r("currentMonth",(function(){return{display:this.currentMonth.format("MMM YYYY"),iso:this.currentMonth.format("YYYY-MM")}})),this.displayDate=r("val",(function(){return this.value?this.val.format("LL"):""})),this.displayTime=r("val",(function(){return this.val.format("LT")})),this.hour=r("val",(function(){return this.val.hour})),this.minute=r("val",(function(){return this.val.minute})),this.days=r("currentMonth","val",(function(){const t=this.val,e=this.currentMonth,s=t.year,n=t.month,i=t.date,r=e.month,o=e.clone().startOf("month").startOf("week"),c=e.clone().endOf("month").endOf("week");for(var a=f.create();o<c;)for(let t=0;t<7;t++)a.push(g.create({isCurrent:o.date===i&&o.month===n&&o.year===s,isMonth:o.month===r,year:o.year,month:o.month,date:o.date,iso:o.format("YYYY-MM-DD")})),o.add(1,"date");return a})),this.app=r((function(){return this.__owner__.lookup("application-route")}))}prev(){this.currentMonth=this.currentMonth.clone().add(-1,"month")}next(){this.currentMonth=this.currentMonth.clone().add(1,"month")}setDate(t,e,s){const n=this.val.clone();n.year=t,n.month=e,n.date=s,this.changeaction(n.format("YYYY-MM-DDTHH:mm:ssZZ",this.app.displayTimezone)),this.val=n}hourUp(){this.val=this.val.clone().add(1,"hour")}hourDown(){this.val=this.val.clone().add(-1,"hour")}minuteUp(){this.val=this.val.clone().add(1,"minute")}minuteDown(){this.val=this.val.clone().add(-1,"minute")}mChangeAction(t){this.changeaction(t||t)}},Ft.components["field-filesize"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control is-expanded"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",1,["ctx.value"]],[":changeaction",2,[]]],[],[]]]],[3,"div",[["class","m-control"]],[],[[3,"input",[[":class",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",3,["ctx.size"]],["disabled",""]],[],[]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.value},function(){return t=>this.ctx.mChangeAction(t)},function(){return this.ctx.size}]],this.mclasses=r("classes",(function(){return JSON.stringify(this.classes)})),this.size=r("value",(function(){const t=kt(this.value);return t?`${t} bytes`:""}))}mChangeAction(t){const e=kt(t);isNaN(e)?this.changeerroraction("Value must be a number and optional unit (e.g. MB)"):this.changeerroraction(null),this.changeaction(t)}},Ft.components["field-float"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control is-expanded"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",1,["ctx.value"]],[":changeaction",2,[]]],[],[]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.value},function(){return t=>this.ctx.mChangeAction(t)}]]}mChangeAction(t){isNaN(+t)?this.changeerroraction("Value must be a number"):this.changeerroraction(null),this.changeaction(t)}},Ft.components["field-int"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control is-expanded"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",1,["ctx.value"]],[":changeaction",2,[]]],[],[]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.value},function(){return t=>this.ctx.mChangeAction(t)}]]}mChangeAction(t){isNaN(+t)?this.changeerroraction("Value must be a number"):this.changeerroraction(null),this.changeaction(t)}},Ft.components["field-string"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control is-expanded"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",1,["ctx.value"]],[":changeaction",2,[]]],[],[]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.value},function(){return t=>this.ctx.mChangeAction(t)}]]}mChangeAction(t){this.changeaction(t||t)}},Ft.components["field-subset"]=class extends b{constructor(){super(),this.template=['[[3,"m-tagging",[[":tags",0,["ctx.value"]],[":classes",[[["is-expanded"],[1]],[[1,["ctx.classes"]]]]],[":suggestions",2,["ctx.constraints"]],["subset","true"],[":addaction",3,[]],[":removeaction",4,[]]],[],[]]]',[function(){return this.ctx.value},function(){return this.ctx.classes},function(){return this.ctx.constraints},function(){return t=>this.ctx.add(t)},function(){return t=>this.ctx.remove(t)}]]}add(t){this.value.push(t),this.changeaction(f.create(this.value))}remove(t){this.value.splice(this.value.indexOf(t),1),this.changeaction(f.create(this.value))}},Ft.components["field-timedelta"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control is-expanded"]],[],[[3,"input-control",[[":classes",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",1,["ctx.value"]],[":changeaction",2,[]]],[],[]]]],[3,"div",[["class","m-control"]],[],[[3,"input",[[":class",[[["m-input"],[1]],[[0,["ctx.classes"]]]]],[":value",3,["ctx.size"]],["disabled","true"]],[],[]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.value},function(){return t=>this.ctx.mChangeAction(t)},function(){return this.ctx.size}]],this.size=r("value",(function(){const t=Et(this.value);return t?`${t} seconds`:""}))}mChangeAction(t){const e=Et(t);isNaN(e)?this.changeerroraction("Value must be a number with optional modifiers (e.g. 1h 30m)"):this.changeerroraction(null),this.changeaction(t)}},Ft.components["glycine-geojson"]=class extends b{constructor(){super(),this.template=null,this.layerWorld=r("timerange","features",(function(){for(let t of this.features)if(t.timecode&&t.orientation){const e=this.timerange[1];let s=t.num-1;for(;t.timecode[s]>e&&s>0;)s--;const n=t.orientation.origins[s].concat([-.1]),i=t.orientation.rotations[s]/180*Math.PI,r=[n[0]+Math.cos(i),n[1]+Math.sin(i),n[2]],{width:o,height:c}=this.gl.canvas;let a=O();return a=F(a,z(Math.PI/2,o/c,1,1e6)),a=F(a,$(n,r,[0,0,1])),a=F(a,R(1,1,100)),a}return null})),this.features=r("gl",(function(){const t=this.gl,e=G(t,"I3ZlcnNpb24gMzAwIGVzCiBpbiB2ZWM0IGFfcG9zaXRpb247CiBpbiB2ZWMzIGFfbm9ybWFsOwogaW4gdmVjNCBhX2NvbG9yOwoKIHVuaWZvcm0gbWF0NCB1X21hdHJpeDsKIHVuaWZvcm0gdmVjMiB1X3NjYWxlOwogdW5pZm9ybSB2ZWM0IHVfY29sb3I7Cgogb3V0IHZlYzQgdl9jb2xvcjsKIG91dCBmbG9hdCBwb3M7Cgogdm9pZCBtYWluKCkgewogZ2xfUG9zaXRpb24gPSB2ZWM0KGFfbm9ybWFsLnh5ICogdV9zY2FsZSwgMCwgMCkgKyB1X21hdHJpeCAqIGFfcG9zaXRpb247CiBwb3MgPSBhX25vcm1hbC56OwogaWYgKHVfY29sb3IudyA9PSAwLikgewogdl9jb2xvciA9IGFfY29sb3I7CiB9IGVsc2Ugewogdl9jb2xvciA9IHVfY29sb3I7CiB9CiB9","I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiBmbG9hdCBwb3M7CiBpbiB2ZWM0IHZfY29sb3I7CiBvdXQgdmVjNCBvdXRDb2xvcjsKCiBmbG9hdCBsaW5zdGVwKGZsb2F0IGVkZ2UwLCBmbG9hdCBlZGdlMSwgZmxvYXQgdmFsdWUpIHsKIGZsb2F0IHQgPSBjbGFtcCgodmFsdWUgLSBlZGdlMCkgLyAoZWRnZTEgLSBlZGdlMCksIDAuLCAxLik7CiByZXR1cm4gdDsKIH0KCiB2b2lkIG1haW4oKSB7CiBmbG9hdCBhcG9zID0gYWJzKHBvcyk7CgogZmxvYXQgZnAgPSAwLjI7CiBhcG9zID0gMS4gLSBsaW5zdGVwKDEuLWZwLCAxLiwgYXBvcyk7Cgogb3V0Q29sb3IgPSB2ZWM0KHZfY29sb3IueHl6ICogYXBvcywgYXBvcyAqIHZfY29sb3IuYSk7CiB9"),s={program:e,posloc:t.getAttribLocation(e,"a_position"),norloc:t.getAttribLocation(e,"a_normal"),colloc:t.getAttribLocation(e,"a_color"),matloc:t.getUniformLocation(e,"u_matrix"),scaloc:t.getUniformLocation(e,"u_scale"),ucoloc:t.getUniformLocation(e,"u_color"),d(e,s,n,i,r){const{program:o,matloc:c,scaloc:a,ucoloc:l,vao:u,num:h,c0:d,ucoval:m,timecode:f,width:p}=this,[g,x]=d,y=(e[0]**2+e[1]**2+e[2]**2+e[3]**2)**.5,w=(e[4]**2+e[5]**2+e[6]**2+e[7]**2)**.5,v=(e[8]**2+e[9]**2+e[10]**2+e[11]**2)**.5;t.useProgram(o),t.bindVertexArray(u),(e=e.slice())[12]+=y*g,e[13]+=w*x,e[14]+=v*s,t.uniformMatrix4fv(c,!1,e),t.uniform2fv(a,[p/i,p/r]),t.uniform4fv(l,m);let b=h;b&&(t.disable(t.DEPTH_TEST),t.drawArrays(t.TRIANGLE_STRIP,0,b),t.enable(t.DEPTH_TEST))}};function n(e,n){let[i,r,o,c]=function(t){const e=t[0],s=new Float32Array(4*t.length),n=new Float32Array(6*t.length),i=new Uint32Array(2*t.length);let r=t[0],o=t[1],[c,a]=Lt(r,o)||[1,0];s.set([0,0,0,0],0),n.set([1*c,1*a,1,-1*c,-1*a,-1],0),i.set([0,0],0);for(let l=1,u=t.length-1;l<u;l++){r=t[l],o=t[l+1];const[u,h]=Lt(r,o)||[c,a],d=c*u+a*h,[m,f]=[c+u,a+h];[c,a]=[u,h];const p=(m**2+f**2)**.5,[g,x]=p&&d>-.8?[m/p,f/p]:[u,h];let y,w,v=g*u+x*h;Math.abs(d)>20.99?(v=1,[y,w]=[u,h]):[y,w]=[g/v,x/v],s.set([r[0]-e[0],r[1]-e[1],r[0]-e[0],r[1]-e[1]],4*l),n.set([y,w,1,-y,-w,-1],6*l),i.set([l,l],2*l)}r=t[t.length-1],o=t[t.length-2],[c,a]=Lt(o,r)||[c,a];const l=t.length-1;return s.set([r[0]-e[0],r[1]-e[1],r[0]-e[0],r[1]-e[1]],4*l),n.set([1*c,1*a,1,-1*c,-1*a,-1],6*l),i.set([l,l],2*l),[e,s,n,i]}(e);const a=t.createVertexArray(),l=t.createBuffer(),u=t.createBuffer();t.bindVertexArray(a),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.enableVertexAttribArray(s.posloc),t.vertexAttribPointer(s.posloc,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.enableVertexAttribArray(s.norloc),t.vertexAttribPointer(s.norloc,3,t.FLOAT,!1,0,0);const{colors:h,timestamps:d,width:m}=n;if(h.length){const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,function(t,e){const s=t.map((t=>t.map(((e,s)=>3===s?e:t[3]*e))));return Float32Array.from(Array.from(e,(t=>s[t])).flat())}(h,c),t.STATIC_DRAW),t.enableVertexAttribArray(s.colloc),t.vertexAttribPointer(s.colloc,4,t.FLOAT,!1,0,0)}const f=d?Array.from(c,(t=>d[t])):null,p=r.length/2;return Object.assign({vao:a,num:p,c0:i,width:m,timecode:f,vertexmap:c},s)}const i=G(t,"I3ZlcnNpb24gMzAwIGVzCiBpbiB2ZWM0IGFfcG9zaXRpb247CiBpbiB2ZWMzIGFfbm9ybWFsOwogaW4gdmVjNCBhX2NvbG9yOwoKIHVuaWZvcm0gbWF0NCB1X21hdHJpeDsKIHVuaWZvcm0gdmVjMiB1X29yaWdpbjsKIHVuaWZvcm0gdmVjNCB1X2NvbG9yOwoKIG91dCB2ZWMzIHZfbm9ybWFsOwogb3V0IHZlYzQgdl9jb2xvcjsKCiB2b2lkIG1haW4oKSB7CiBnbF9Qb3NpdGlvbiA9IHVfbWF0cml4ICogYV9wb3NpdGlvbjsKIGdsX1BvaW50U2l6ZSA9IDMuOwogdl9ub3JtYWwgPSBhX25vcm1hbDsKIGlmICh1X2NvbG9yLncgPT0gMC4pIHsKIHZfY29sb3IgPSBhX2NvbG9yOwogfSBlbHNlIHsKIHZfY29sb3IgPSB1X2NvbG9yOwogfQogfQ==","I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiB2ZWM0IHZfY29sb3I7CiBpbiB2ZWMzIHZfbm9ybWFsOwogb3V0IHZlYzQgb3V0Q29sb3I7CiB2b2lkIG1haW4oKSB7CiAvKgogdmVjMyBub3JtYWwgPSBub3JtYWxpemUodl9ub3JtYWwpOwogZmxvYXQgbGlnaHQgPSBkb3Qobm9ybWFsLCBub3JtYWxpemUodmVjMygtMS4sIC0xLiwgMSkpKTsKCiBvdXRDb2xvciA9IHZfY29sb3I7CiBpZiAoZG90KHZfbm9ybWFsLCB2ZWMzKDEuLCAxLiwgMS4pKSAhPSAwLikgewogb3V0Q29sb3IucmdiICo9IGxpZ2h0ICsgMC43OwogfQogKi8KIG91dENvbG9yID0gdl9jb2xvcjsKIH0="),r={program:i,posloc:t.getAttribLocation(i,"a_position"),norloc:t.getAttribLocation(i,"a_normal"),colloc:t.getAttribLocation(i,"a_color"),matloc:t.getUniformLocation(i,"u_matrix"),oriloc:t.getUniformLocation(i,"u_origin"),ucoloc:t.getUniformLocation(i,"u_color"),d(e,s,n,i,r){const{program:o,matloc:c,ucoloc:a,vao:l,num:u,c0:h,ucoval:d,transform:m,timecode:f}=this,[p,g]=h,x=F(F(e,T(p,g,s)),m);t.useProgram(o),t.bindVertexArray(l),t.uniformMatrix4fv(c,!1,x),t.uniform4fv(a,d);let y=u;y&&(t.depthFunc(t.LEQUAL),t.drawArrays(t.TRIANGLE_STRIP,0,y),t.depthFunc(t.LESS))}};const o=G(t,"I3ZlcnNpb24gMzAwIGVzCiBpbiBmbG9hdCBhX2luZGV4OwoKIHVuaWZvcm0gdmVjNCB1X3Bvc2l0aW9uOwogdW5pZm9ybSBmbG9hdCB1X2NvdW50OwogdW5pZm9ybSBtYXQ0IHVfbWF0cml4OwogdW5pZm9ybSB2ZWMyIHVfc2NhbGU7CiB1bmlmb3JtIHZlYzQgdV9jb2xvcjsKCiBvdXQgdmVjNCB2X2NvbG9yOwogb3V0IGZsb2F0IHBvczsKCiB2ZWMyIHJvdChmbG9hdCBhbmdsZSkKIHsKIGZsb2F0IHMgPSBzaW4oYW5nbGUpOwogZmxvYXQgYyA9IGNvcyhhbmdsZSk7CiByZXR1cm4gdmVjMihjLCBzKTsKIH0KCiB2b2lkIG1haW4oKSB7CiBpZiAoYV9pbmRleCA9PSAwLikgewogZ2xfUG9zaXRpb24gPSB1X21hdHJpeCAqIHVfcG9zaXRpb247CiBwb3MgPSAwLjsKIH0gZWxzZSB7CiBnbF9Qb3NpdGlvbiA9IHZlYzQocm90KChhX2luZGV4IC0gMS4pIC8gdV9jb3VudCkgKiB1X3NjYWxlLCAwLCAwKSArIHVfbWF0cml4ICogdV9wb3NpdGlvbjsKIHBvcyA9IDEuOwogfQogdl9jb2xvciA9IHVfY29sb3I7CiB9","I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiBmbG9hdCBwb3M7CiBpbiB2ZWM0IHZfY29sb3I7CiBvdXQgdmVjNCBvdXRDb2xvcjsKCiBmbG9hdCBsaW5zdGVwKGZsb2F0IGVkZ2UwLCBmbG9hdCBlZGdlMSwgZmxvYXQgdmFsdWUpIHsKIGZsb2F0IHQgPSBjbGFtcCgodmFsdWUgLSBlZGdlMCkgLyAoZWRnZTEgLSBlZGdlMCksIDAuLCAxLik7CiByZXR1cm4gdDsKIH0KCiB2b2lkIG1haW4oKSB7CiBmbG9hdCBhcG9zID0gYWJzKHBvcyk7CgogZmxvYXQgZnAgPSAwLjE7CiBhcG9zID0gMS4gLSBsaW5zdGVwKDEuLWZwLCAxLiwgYXBvcyk7Cgogb3V0Q29sb3IgPSB2ZWM0KHZfY29sb3IueHl6ICogYXBvcywgYXBvcyk7CiB9"),c={program:o,idxloc:t.getAttribLocation(o,"a_index"),cntloc:t.getUniformLocation(o,"u_count"),posloc:t.getUniformLocation(o,"u_position"),matloc:t.getUniformLocation(o,"u_matrix"),scaloc:t.getUniformLocation(o,"u_scale"),ucoloc:t.getUniformLocation(o,"u_color"),d(e,s,n,i,r){const{program:o,cntloc:c,posloc:a,matloc:l,scaloc:u,ucoloc:h,vao:d,num:m,geometry:f,count:p,radius:g,ucoval:x}=this;t.useProgram(o),t.bindVertexArray(d);const y=V(e,[...f.coordinates,0,1]);t.uniform4fv(a,y),t.uniform1f(c,p/(2*Math.PI)),e=O(),t.uniformMatrix4fv(l,!1,e),t.uniform2fv(u,[2*g/i,2*g/r]),t.uniform4fv(h,x),t.disable(t.DEPTH_TEST),t.drawArrays(t.TRIANGLE_FAN,0,m),t.enable(t.DEPTH_TEST)}};function a(e,s){const n=t.createVertexArray(),i=t.createBuffer();t.bindVertexArray(n),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,Float32Array.from({length:18},((t,e)=>e)),t.STATIC_DRAW),t.enableVertexAttribArray(c.idxloc),t.vertexAttribPointer(c.idxloc,1,t.FLOAT,!1,0,0);return Object.assign({vao:n,num:18,count:16,radius:s,geometry:e},c)}return this.model.geojson.features.map((e=>{const{geometry:s,properties:i}=e;let o,{type:c,coordinates:l}=s;if("LineString"===c)o=n(l,i);else if("Polygon"===c)o=function(e,s){let n,i=e[0].slice(0,-1),o=i[0];const c=new Float32Array(2*i.length);i.forEach(((t,e)=>c.set([t[0]-o[0],t[1]-o[1]],2*e)));const a=t.createVertexArray(),l=t.createBuffer(),u=t.createBuffer();return t.bindVertexArray(a),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,c,t.STATIC_DRAW),t.enableVertexAttribArray(r.posloc),t.vertexAttribPointer(r.posloc,2,t.FLOAT,!1,0,0),s.colors&&(t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,Uint8Array.from(s.colors.reduce(((t,e)=>t.concat([e[0],e[1],e[2],e[3]||255])),[])),t.STATIC_DRAW),t.enableVertexAttribArray(r.colloc),t.vertexAttribPointer(r.colloc,4,t.UNSIGNED_BYTE,!0,0,0)),n=c.length/2,Object.assign({vao:a,num:n,c0:o},r)}(l,i);else if("Circle"===c)o=a(s,s.radius);else{if("Point"!==c)throw new Error(`GeoJSON type ${c} not supported yet`);o=a(s,4)}const u=Float32Array.from(i.color.length?i.color:[1,1,1,1]);i.colors&&i.colors.length?o.ucoval=[0,0,0,0]:o.ucoval=u.map(((t,e)=>3===e?t:u[3]*t));const h=Float32Array.from(i.fillcolor.length?i.fillcolor:u.map(((t,e)=>3===e?.8*t:t)));i.fillcolors&&i.fillcolors.length?o.ufcval=[0,0,0,0]:o.ufcval=h.map(((t,e)=>3===e?t:h[3]*t));const{timestamps:d,rotations:m,markervertices:f}=i;return[o]})).reduce(((t,e)=>t.concat(e)),[])}))}didInsertElement(){this.add(this)}willRemoveElement(){this.remove(this)}glRender(){this.model.hidden||this.features.forEach(((t,e)=>{t.d(this.world,this.index/16-.999+e/65536,this.timerange,this.width,this.height)}))}},Ft.components["glycine-surface"]=U,Ft.components["glycine-tyler"]=class extends b{constructor(){super(),this.template=null,this.t=8,this.pixelSize=[-1,-1],this.scale=r("t","z","model.tile",(function(){const{t:t,z:e,model:{tile:{zoom:[s,n]}}}=this;return Math.min(n,Math.max(s,e-t))})),this.tileSize=r("pixelSize",(function(){const{t:t,pixelSize:[e,s]}=this;return[(e>>t)+(e%(1<<t)>0)+1,(s>>t)+(s%(1<<t)>0)+1]})),this.tileOffset=r("scale","pos","tileSize",(function(){const{scale:t,pos:[e,s],tileSize:[n,i]}=this;return[e*2**t-(n-1)/2|0,(1-s)*2**t-(i-1)/2|0]})),this.urls=r("model.tile.url",(function(){const t=this.model.tile.url;let e=[];return/\[abc\]/.test(t)?(e.push(t.replace("[abc]","a")),e.push(t.replace("[abc]","b")),e.push(t.replace("[abc]","c"))):e.push(t),e})),this.tileStore=r("gl",(function(){return f.create()})),this.tiles=r("gl","urls","z","tileOffset","tileSize",(function(){const{scale:t,gl:e,tileOffset:[s,n],tileSize:[i,r],tileStore:o,urls:c}=this,a=o.slice(),l=[];for(let e=0;e<r;e++)for(let r=0;r<i;r++){const o=c[(e*i+r)%c.length].replace("{z}",t).replace("{x}",s+r).replace("{y}",n+e),u=o.split("/").slice(-3).join("/"),h=a.find((t=>t.key===u));if(h)a.splice(a.indexOf(h),1),l.push(h);else{const t={texture:null,url:o,key:u,loaded:!1};l.push(t)}}return l.filter((t=>!t.texture)).forEach((t=>{if(a.length){const e=a.pop();t.texture=e.texture,e.texture=null}else t.texture=function(t){const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),e}(e);e.bindTexture(e.TEXTURE_2D,t.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([.8,.8,.8,1]));const s=new Image;s.addEventListener("load",this.getOwner().asyncEvent((()=>{t.texture&&this.tileStore.includes(t)&&(e.bindTexture(e.TEXTURE_2D,t.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),t.loaded=!0)}))),s.crossOrigin="",s.src=t.url})),a.forEach((t=>{e.deleteTexture(t.texture),t.texture=null})),o.splice.call(o,0,o.length,...l),o.map((t=>t.texture))})),this.dirty=r("tiles","tileStore.@each.loaded",(function(){return!0})),this.glo=r("gl",(function(){const{gl:t}=this,e=G(t,"I3ZlcnNpb24gMzAwIGVzCiBpbiB2ZWM0IGFfcG9zaXRpb247CiBpbiB2ZWMyIGFfdGV4Y29vcmQ7CgogdW5pZm9ybSBtYXQ0IHVfbWF0cml4OwoKIG91dCB2ZWMyIHZfdGV4Y29vcmQ7Cgogdm9pZCBtYWluKCkgewogZ2xfUG9zaXRpb24gPSB1X21hdHJpeCAqIGFfcG9zaXRpb247CiB2X3RleGNvb3JkID0gdmVjMihhX3Bvc2l0aW9uLngsIDEuLWFfcG9zaXRpb24ueSk7CiB9","I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiB2ZWMyIHZfdGV4Y29vcmQ7CiB1bmlmb3JtIHNhbXBsZXIyRCB1X3RleHR1cmU7CiBvdXQgdmVjNCBvdXRDb2xvcjsKCiB2b2lkIG1haW4oKSB7CiBvdXRDb2xvciA9IHRleHR1cmUodV90ZXh0dXJlLCB2X3RleGNvb3JkKTsKIH0="),s=t.getAttribLocation(e,"a_position");this.matloc=t.getUniformLocation(e,"u_matrix"),this.texloc=t.getUniformLocation(e,"u_texture");const n=t.createVertexArray();t.bindVertexArray(n);const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,At,t.STATIC_DRAW),{program:e,vao:n}}))}didInsertElement(){this.add(this)}willRemoveElement(){this.remove(this)}glRender(){if(this.model.hidden)return;const{gl:t}=this,{width:e,height:s}=t.canvas;e===this.pixelSize[0]&&s===this.pixelSize[1]||(this.pixelSize=[e,s]);const{glo:{program:n,vao:i},scale:r,world:o,tileOffset:[c,a],tileSize:[l,u],tiles:h,matloc:d}=this,m=2**-r,f=F(o,R(m,m,1));t.useProgram(n),t.bindVertexArray(i);for(let e=0,s=c,n=1/m-(a+1);e<l;e+=1,s+=1,n+=u)for(let i=0;i<u;i+=1,n-=1)t.uniformMatrix4fv(d,!1,F(f,T(s,n,-.9999))),t.bindTexture(t.TEXTURE_2D,h[e+i*l]),t.drawArrays(t.TRIANGLE_STRIP,0,4)}},Ft.components["index-route"]=class extends M{constructor(){super(),this.template=['[[0,[[[4,1,["ctx.obs"]]],[[3,"div",[["class","m-hero"]],[],[[3,"div",[["class","m-hero-body"]],[],[[3,"div",[["class","mu-text-center"]],[],[[3,"widget-icon",[["glyph","list"]],[],[]]]],[0,[[[3,"div",[["class","mu-text-center"]],[],[[2,"\\n              User "],[4,2,["ctx.app.user"]],[2," has no access to any collection\\n            "]]]],[[3,"div",[["class","mu-text-center"]],[],[[2,"Sign in to see your collections"]]]]],[[4,2,["ctx.app.user"]],[4,null,[]]]]]]]]]],[[4,0,["ctx.app.model.collections.length"]],[4,null,[]]]]]',[function(){return this.ctx.app.model.collections.length},function(){return this.ctx.obs},function(){return this.ctx.app.user}]],this.app=r((function(){return this.getOwner().lookup("application-route")})),this.obs=r("app.model",(function(){this.didEnter()}))}didEnter(){var t;if(null!==(t=this.app.model.collections)&&void 0!==t&&t.length){const{name:t}=this.app.model.collections[0];this.transitionTo({route:"collection",dynamics:{id:t}})}}},Ft.components["input-checkbox"]=class extends b{constructor(){super(),this.template=['[[3,"input",[["type","checkbox"],[":class",[[[0,["ctx.classes"]]]]],[":disabled",1,["ctx.disabled","ctx.disabled","ctx.undefined"]],[":required",2,["ctx.required"]],[":checked",3,["ctx.mValue"]],["@change",4,[]]],[],[]]]',[function(){return this.ctx.classes},function(){return this.ctx.disabled?this.ctx.disabled:this.ctx.undefined},function(){return this.ctx.required},function(){return this.ctx.mValue},function(t){this.ctx.change()}]],this.mValue=r("value",(function(){return this.getElement().checked=this.value,this.value}))}change(){const t=this.getElement().checked;this.changeaction(t)}},Ft.components["input-control"]=class extends b{constructor(){super(),this.template=['[[3,"input",[[":type",0,["ctx.type"]],[":class",[[[1,["ctx.classes"]]]]],[":min",2,["ctx.min"]],[":max",3,["ctx.max"]],[":step",4,["ctx.step"]],[":disabled",5,["ctx.disabled","ctx.undefined"]],[":name",6,["ctx.name"]],[":placeholder",7,["ctx.placeholder"]],[":required",8,["ctx.required"]],[":value",9,["ctx.mValue"]],["@change",10,[]],["@keyup",10,[]],["@input",10,[]],["@mousemove",11,[]],["@mouseleave",11,[]],["@mousedown",12,[]]],[],[]]]',[function(){return this.ctx.type},function(){return this.ctx.classes},function(){return this.ctx.min},function(){return this.ctx.max},function(){return this.ctx.step},function(){return this.ctx.disabled?"disabled":this.ctx.undefined},function(){return this.ctx.name},function(){return this.ctx.placeholder},function(){return this.ctx.required},function(){return this.ctx.mValue},function(t){this.ctx.change()},function(t){this.ctx.mousemove(t)},function(t){this.ctx.mousedown()}]],this.type="text",this.mclasses=r("classes",(function(){return JSON.stringify(this.classes)})),this.mValue=r("value",(function(){const t=this.getElement();return t.value===this.value||this.blocked||(t.value=this.value),this.value}))}change(){const t=this.getElement().value;this.changeaction(t)}mousedown(){const t=()=>{this.blocked=!1,document.removeEventListener("mouseup",t)};this.blocked=!0,document.addEventListener("mouseup",t)}mousemove(t){if(this.overaction)if("mousemove"===t.type){const{left:e}=t.target.getClientRects()[0],s=Math.max(0,(t.clientX-e-8)/(t.target.clientWidth-18));this.overaction(Math.floor(this.min+s*(this.max-this.min)))}else this.overaction(null)}},Ft.components["input-radio"]=class extends b{constructor(){super(),this.template=['[[1,[0,["ctx.choices"]],["choice","index"],[[3,"label",[["class","m-radio"]],[],[[3,"input",[["type","radio"],[":name",1,["ctx.name","ctx.name","ctx.oid"]],[":disabled",2,["ctx.disabled","ctx.undefined"]],[":checked",3,["choice.value","ctx.mValue"]],[":value",4,["choice.value"]],["@change",5,[]]],[],[]],[2," "],[4,6,["choice.title"]]]]]]]',[function(){return this.ctx.choices},function(){return this.ctx.name?this.ctx.name:this.ctx.oid},function(){return this.ctx.disabled?"disabled":this.ctx.undefined},function(){return this.choice.value===this.ctx.mValue},function(){return this.choice.value},function(t){this.ctx.change(t)},function(){return this.choice.title}]],this.mValue=r("value",(function(){const t=this.getElement().querySelector(`input[value="${this.value}"]`);return t&&(t.checked=!0),this.value})),this.oid=r((()=>this.__oid__))}change(t){this.changeaction(t.target.value)}},Ft.components["input-textarea"]=class extends b{constructor(){super(),this.template=['[[3,"textarea",[[":class",[[[0,["ctx.classes"]]]]],[":disabled",1,["ctx.disabled","ctx.undefined"]],[":value",2,["ctx.mValue"]],[":rows",3,["ctx.rows"]],[":cols",4,["ctx.cols"]],[":placeholder",5,["ctx.placeholder"]],["@change",6,[]],["@keyup",6,[]]],[],[[2,"      "]]]]',[function(){return this.ctx.classes},function(){return this.ctx.disabled?"disabled":this.ctx.undefined},function(){return this.ctx.mValue},function(){return this.ctx.rows},function(){return this.ctx.cols},function(){return this.ctx.placeholder},function(t){this.ctx.change()}]],this.mValue=r("value",(function(){return this.getElement().value=this.value,this.value}))}change(){const t=this.getElement().value;this.changeaction(t)}},Ft.components["m-dropdown"]=class extends b{constructor(){super(),this.template=['[[3,"span",[["class","m-dropdown"],[":class",[[["is-active"],[0,["ctx.state"]]],[[1,["ctx.classes"]]]]]],[],[[3,"div",[["class","m-dropdown-trigger"]],[],[[3,"m-slot",[["name","trigger"],[":open",2,[]]],[],[]]]],[3,"div",[["class","m-dropdown-menu"]],[],[[3,"span",[["class","m-dropdown-backdrop"],["@click",3,[]]],[],[]],[3,"div",[["class","m-dropdown-content"]],[],[[3,"m-slot",[["name","content"],[":close",4,[]]],[],[]]]]]]]]]',[function(){return this.ctx.state},function(){return this.ctx.classes},function(){return()=>this.ctx.open()},function(t){this.ctx.close()},function(){return()=>this.ctx.close()}]],this.state=!1}open(){var t;this.state=!0,null===(t=this.openaction)||void 0===t||t.call(this,!0)}close(){var t;this.state=!1,null===(t=this.openaction)||void 0===t||t.call(this,!1),this.getElement().querySelector(".m-dropdown-trigger").firstElementChild.focus()}willRemoveElement(){var t;null===(t=this.openaction)||void 0===t||t.call(this,!1)}},Ft.components["m-hover"]=class extends b{constructor(){super(),this.template=['[[3,"span",[["class","m-hover"],[":class",[[["m-hover-hovering"],[0,["ctx.hovering"]]]]],["@mouseenter",1,[]],["@mouseleave",2,[]]],[],[[3,"m-slot",[[":hovering",0,["ctx.hovering"]]],[],[]]]]]',[function(){return this.ctx.hovering},function(t){this.ctx.hovering=!0},function(t){t.relatedTarget&&(this.ctx.hovering=!1)}]]}},Ft.components["m-hscroll"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-hscroll"],["@mousedown",0,[]]],[],[[3,"m-slot",[],[],[]]]]]',[function(t){this.ctx.scroll(t)}]],this.wheelEvent=t=>{if(t.deltaX){this.getElement().firstElementChild.scrollLeft+=t.deltaX,this.updateHscroll(),t.preventDefault(),t.stopPropagation()}}}scroll(t){if(0!==t.button)return;let e=t.clientX;const s=this.getOwner().asyncEvent((t=>{const s=t.clientX-e;e=t.clientX;this.getElement().firstElementChild.scrollLeft-=s,this.updateHscroll()})),n=this.getOwner().asyncEvent((()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",n)}));document.addEventListener("mousemove",s),document.addEventListener("mouseup",n)}updateHscroll(){const t=this.getElement(),e=t.firstElementChild,s=e.scrollLeft;if(t.classList.remove("scrolling"),t.classList.remove("left"),t.classList.remove("right"),e.scrollWidth!==e.offsetWidth){t.classList.add("scrolling");const n=e.scrollWidth-e.offsetWidth;0!==e.scrollLeft&&t.classList.add("left"),e.scrollLeft!==n&&t.classList.add("right"),e.scrollLeft=s}}didInsertElement(){this.getOwner().addAfterRender((()=>{this.updateHscroll()}));this.getElement().addEventListener("wheel",this.wheelEvent)}willRemoveElement(){this.getElement().removeEventListener("wheel",this.wheelEvent)}},Ft.components["m-multirange"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-multirange"],["role","group"],[":aria-labelledby",0,[]],[":style",1,["ctx.style"]]],[],[[3,"div",[[":id",0,[]]],[],[[4,2,["ctx.label"]]]],[3,"input",[["type","range"],[":id",3,[]],[":min",4,["ctx.min"]],[":max",5,["ctx.max"]],[":value",6,["ctx.v0Value"]],["@input",7,[]]],[],[]],[3,"output",[[":for",3,[]],["style","--c: var(--v0)"],[":data-text",8,["ctx.v0text"]]],[],[]],[3,"input",[["type","range"],[":id",9,[]],[":min",4,["ctx.min"]],[":max",5,["ctx.max"]],[":value",10,["ctx.v1Value"]],["@input",7,[]]],[],[]],[3,"output",[[":for",9,[]],["style","--c: var(--v1)"],[":data-text",11,["ctx.v1text"]]],[],[]]]]]',[function(){return"#{oid}-label"},function(){return this.ctx.style},function(){return this.ctx.label},function(){return"#{oid}v0"},function(){return this.ctx.min},function(){return this.ctx.max},function(){return this.ctx.v0Value},function(t){this.ctx.change(t)},function(){return this.ctx.v0text},function(){return"#{oid}v1"},function(){return this.ctx.v1Value},function(){return this.ctx.v1text}]],this.oid=r("__oid__",(function(){return this.__oid__})),this.v0Value=r("v0",(function(){const t=this.v0,e=this.getElement().querySelectorAll("input")[0];return e&&e.value!==t&&(e.value=t),t})),this.v1Value=r("v1",(function(){const t=this.v1,e=this.getElement().querySelectorAll("input")[1];return e&&e.value!==t&&(e.value=t),t})),this.style=r("v0Value","v1Value","min","max",(function(){return`--v0: ${this.v0Value}; --v1: ${this.v1Value}; --min: ${this.min}; --max: ${this.max}`}))}change(t){const{id:e,value:s}=t.target;this[`changeaction${e.slice(-2)}`](s)}},Ft.components["m-select"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-select"],[":class",[[["is-disabled"],[0,["ctx.disabled"]]],[["is-multiple"],[1,["ctx.multiple"]]],[[2,["ctx.classes"]]]]]],[],[[3,"select",[[":disabled",0,["ctx.disabled"]],[":multiple",1,["ctx.multiple"]],["@change",3,[]]],[],[[1,[4,["ctx.mOptions"]],["item"],[[3,"option",[[":value",5,["item.value"]],[":selected",6,["item.value","ctx.mSelected"]],["::text",7,["item.name"]]],[],[]]]]]],[0,[[[3,"widget-icon",[["glyph","arrow-down"]],[],[]]]],[[4,8,["ctx.multiple"]]]]]]]',[function(){return this.ctx.disabled},function(){return this.ctx.multiple},function(){return this.ctx.classes},function(t){this.ctx.change()},function(){return this.ctx.mOptions},function(){return this.item.value},function(){return this.item.value===this.ctx.mSelected},function(){return this.item.name},function(){return!this.ctx.multiple}]],this.namekey="",this.valuekey="__index__",this.mOptions=r("options",(function(){return this.options.map(((t,e)=>({name:this.namekey?t[this.namekey]:t,value:"__index__"===this.valuekey?e:t[this.valuekey]})))})),this.mSelected=r("options","selected",(function(){const t=this.options,e=this.selected,s=t.indexOf(e),n=this.getElement().querySelector(`option:nth-child(${s+1})`);if(n&&(n.selected=!0),~s)return"__index__"===this.valuekey?s:e[this.valuekey]}))}change(){const t=this.getElement().firstElementChild.selectedIndex;this.changeaction(this.options[t])}},Ft.components["m-tagging"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","m-control m-tagging"],[":class",[[[0,["ctx.classes"]]]]],["@click",1,[]],["@keydown",2,[]]],[],[[3,"div",[["class","m-dropdown is-focusable"]],[],[[3,"div",[["class","m-dropdown-trigger m-input"]],[],[[1,[3,["ctx.tags"]],["tag"],[[3,"span",[["class","m-tag"]],[],[[4,4,["tag"]],[2,"\\n            "],[0,[[[3,"button",[["type","button"],["class","m-delete"],["@click",6,[]]],[],[]]]],[[4,5,["ctx.disabled"]]]]]]]],[3,"input-control",[[":value",7,["ctx.search"]],[":disabled",8,["ctx.disabled"]],[":placeholder",9,["ctx.placeholder"]],[":changeaction",10,[]]],[],[]]]],[3,"div",[["class","m-dropdown-menu"]],[],[[3,"span",[["class","m-dropdown-backdrop"]],[],[]],[3,"div",[["class","m-dropdown-content"]],[],[[0,[[[1,[12,["ctx.results"]],["result"],[[3,"a",[["href","#"],["tabindex","-1"],["class","m-dropdown-item"],[":class",[[["is-active"],[13,["result.active"]]]]],["@click",14,[]],["@mouseenter",15,[]]],[],[[4,16,["result.tag"]]]]]]],[[3,"div",[["class","m-dropdown-item"]],[],[[2,"\\n                No results match your query\\n              "]]]]],[[4,11,["ctx.results.length"]],[4,17,["ctx.suggestions.length"]]]]]]]]]]]]]',[function(){return this.ctx.classes},function(t){this.ctx.click()},function(t){this.ctx.keydown(t)},function(){return this.ctx.tags},function(){return this.tag},function(){return!this.ctx.disabled},function(t){this.ctx.remove(this.tag,t)},function(){return this.ctx.search},function(){return this.ctx.disabled},function(){return this.ctx.placeholder},function(){return t=>this.ctx.inputChangeAction(t)},function(){return this.ctx.results.length},function(){return this.ctx.results},function(){return this.result.active},function(t){this.ctx.add(this.result,t)},function(t){this.ctx.highlight(t)},function(){return this.result.tag},function(){return this.ctx.suggestions.length}]],this.tags=null,this.suggestions=null,this.search="",this.focused=!1,this.disabled=r("subset","suggestions.@each",(function(){return this.subset&&!this.suggestions.length})),this.placeholder=r("subset","suggestions.@each",(function(){return this.subset&&!this.suggestions.length?"There are no items":void 0})),this.results=r("search","tags.@each","suggestions.@each",(function(){const t=this.search,e=this.subset;if(!t&&!e)return f.create();const s=this.tags,n=new RegExp(t,"i");return f.create(this.suggestions.filter((t=>!~s.indexOf(t))).filter((t=>n.test(t))).map((t=>g.create({tag:t,active:!1}))))})),this.active="active"}click(){this.getElement().querySelector("input").focus()}add(t,e){this.addaction(t.tag),this.getElement().querySelector("input").focus(),this.search="",e.stopPropagation(),e.preventDefault()}remove(t,e){this.removeaction(t),this.getElement().querySelector("input").focus(),e.stopPropagation(),e.preventDefault()}highlight(t){const e=this.results;if(!e.length)return;const s=e.filter((t=>!0===t.active))[0];if(e.forEach((t=>t.active=!1)),"number"==typeof t){let n=e.indexOf(s);n=(n+e.length+t)%e.length,e[n].active=!0}else t.active=!0}keydown(t){const e=t;if(38===e.keyCode)this.highlight(-1),e.stopPropagation(),e.preventDefault();else if(40===e.keyCode)this.highlight(1),e.stopPropagation(),e.preventDefault();else if(13===e.keyCode||9===e.keyCode){const t=this.results,s=this.search.trim();this.search="";const n=t.filter((t=>!0===t.active))[0];if(n)this.addaction(n.tag),e.stopPropagation(),e.preventDefault();else if(s.length)this.subset&&!t.filter((t=>t.tag===s))[0]||this.addAction(s),e.stopPropagation(),e.preventDefault();else if(9===e.keyCode)return}else if(8===e.keyCode){if(this.search.length)return;this.tags.length&&this.remove(this.tags[this.tags.length-1],e)}}inputChangeAction(t){this.search=t}},Ft.components["notfound-route"]=class extends M{constructor(){super(),this.template=['[[3,"div",[["class","m-message is-danger"]],[],[[3,"div",[["class","m-message-header"]],[],[[2,"\\n          Error\\n        "]]],[3,"div",[["class","m-message-body"]],[],[[2,"\\n          This is not a valid marv route.\\n        "]]]]],[3,"link-to",[["href","/"]],[],[[2,"Go to overview"]]]]',[]]}},Ft.components["widget-clipboard"]=class extends b{constructor(){super(),this.template=['[[3,"button",[[":class",[[[0,["ctx.classes"]]]]],["@click",1,[]]],[],[[3,"span",[],[],[[2,"Copy "],[4,2,["ctx.model.title"]],[2," to clipboard"]]],[3,"widget-icon",[["glyph","clipboard"]],[],[]]]]]',[function(){return this.ctx.classes},function(t){this.ctx.copy()},function(){return this.ctx.model.title}]]}copy(){const t=this.getOwner().rootNode.__doc__.createElement("textarea");t.value=this.model.data,this.getElement().appendChild(t),t.select(),this.getOwner().rootNode.__doc__.execCommand("copy"),t.remove()}},Ft.components["widget-comment"]=class extends b{constructor(){super(),this.template=['[[3,"m-dropdown",[[":classes",0,["ctx.menuclass"]]],["dd"],[[3,"button",[["into","trigger"],["role","button"],["class","m-button m-dropdown-toggle"],[":disabled",1,["ctx.fulldisabled"]],["@click",2,[]]],[],[[2,"comment"]]],[3,"div",[["into","content"],["class","m-dropdown-item"]],[],[[0,[[[3,"a",[["@click",4,[]]],[],[[2,"\\n            Sign in to comment\\n          "]]]],[[3,"div",[],[],[[3,"form",[["class","is-small"],["@submit",5,[]]],[],[[3,"div",[["class","m-field"]],[],[[3,"input-textarea",[["classes","m-textarea"],["rows","10"],["placeholder","Comment"],[":value",6,["ctx.comment"]],[":changeaction",7,[]]],[],[]]]],[3,"div",[["class","m-field m-buttons mu-justify-content-end"]],[],[[3,"button",[["type","button"],["class","m-button"],["@click",8,[]]],[],[[2,"Cancel"]]],[3,"button",[["type","submit"],["class","m-button is-primary is-outlined"],[":disabled",9,["ctx.comment"]]],[],[[2,"Comment"]]]]]]]]]]],[[4,3,["ctx.disabled"]],[4,null,[]]]]]]]]]',[function(){return this.ctx.menuclass},function(){return this.ctx.fulldisabled},function(t){this.ctx.open(this.dd)},function(){return this.ctx.disabled},function(t){this.ctx.altaction()},function(t){this.ctx.save(t)},function(){return this.ctx.comment},function(){return t=>this.ctx.comment=t},function(t){this.dd.close()},function(){return!this.ctx.comment}]],this.comment=""}open(t){this.comment="",t.open()}save(t){t.preventDefault(),this.comment&&(this.changeaction(this.comment),this.comment="")}},Ft.components["widget-dropdown"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-dropdown"]],[],[[3,"m-select",[["classes","is-fullwidth"],[":options",0,["ctx.options"]],[":selected",1,["ctx.selected"]],[":changeaction",2,[]]],[],[]],[3,"div",[["class","widget-container"]],[],[[1,[3,["ctx.widgets"]],["widget"],[[0,[[[3,"widget-loader",[[":model",5,["widget"]]],[],[]]]],[[4,4,["widget","ctx.currentWidget"]]]]]]]]]]]',[function(){return this.ctx.options},function(){return this.ctx.selected},function(){return t=>this.ctx.selected=t},function(){return this.ctx.widgets},function(){return this.widget===this.ctx.currentWidget},function(){return this.widget}]],this.options=r("model.widgets.@each",(function(){return this.model?this.model.widgets.map((t=>t.title)):[]})),this.widgets=r("model.widgets.@each",(function(){return this.model?this.model.widgets.map((t=>Object.assign({},t,{title:void 0}))):[]})),this.selected=r("options",(function(){return this.options[0]})),this.currentWidget=r("selected",(function(){const{options:t,selected:e}=this;return this.widgets[t.indexOf(e)]}))}},Ft.components["widget-filter"]=class extends b{constructor(){super(),this.template=['[[3,"form",[["class","m-card-body is-small"],["@submit",0,[]]],[],[[3,"div",[["class","m-field is-horizontal"]],[],[[3,"div",[["class","m-field-label"]],[],[[3,"label",[["class","m-label"]],[],[[2,"Add new filter"]]]]],[3,"div",[["class","m-field-body"]],[],[[3,"div",[["class","m-buttons"]],[],[[1,[1,["ctx.fields"]],["field"],[[3,"button",[["type","button"],["class","m-button"],["@click",2,[]],[":disabled",3,["field.active"]],[":title",4,["field.title"]]],[],[[4,4,["field.title"]]]]]]]]]]]],[1,[1,["ctx.fields"]],["field"],[[0,[[[3,"div",[["class","m-field is-horizontal"],[":class",[[["is-danger"],[5,["field.entry.error"]]]]]],[],[[3,"div",[["class","m-field-label"]],[],[[3,"label",[["class","m-label"]],[],[[4,4,["field.title"]]]]]],[3,"div",[["class","m-field-body"]],[],[[3,"div",[["class","m-field"]],[],[[3,"div",[["class","m-field has-addons"]],[],[[0,[[[3,"div",[["class","m-control"]],[],[[3,"m-select",[[":options",7,["field.operators"]],[":selected",8,["field.entry.op"]],[":changeaction",9,[]],[":disabled",10,["field.operators.length"]]],[],[]]]]]],[[4,6,["field.operators.length"]]]],[3,"m-x",[[":component",11,["field.value_type"]],[":classes",[]],[":value",12,["field.entry.val"]],[":constraints",13,["field.constraints"]],[":changeaction",14,[]],[":changeerroraction",15,[]]],[],[]],[3,"div",[["class","m-control"]],[],[[3,"button",[["class","m-button is-outlined"],["type","button"],["@click",16,[]]],[],[[3,"widget-icon",[["glyph","x"]],[],[]]]]]]]],[0,[[[3,"div",[["class","m-help"]],[],[[4,5,["field.entry.error"]]]]]],[[4,5,["field.entry.error"]]]]]]]]]]]],[[4,3,["field.active"]]]]]],[0,[[[3,"h4",[],[],[[2,"Filter Debug"]]],[3,"pre",[],[],[[4,18,["ctx.filterJSON"]]]],[3,"pre",[],[],[[4,19,["ctx.filterBase"]]]]]],[[4,17,["ctx.debug"]]]],[3,"div",[["class","m-field is-horizontal"]],[],[[3,"div",[["class","m-field-label"]],[],[]],[3,"div",[["class","m-field-body is-horizontal"]],[],[[3,"div",[["class","m-buttons"]],[],[[3,"button",[["type","button"],["class","m-button"],[":disabled",20,["ctx.filterBase"]],["@click",21,[]]],[],[[2,"\\n                reset filters\\n              "]]],[3,"button",[["type","submit"],["class","m-button is-primary is-outlined"],[":disabled",22,["ctx.filterStr","ctx.filterBase"]]],[],[[2,"\\n                apply filter\\n              "]]]]]]]]]]]]',[function(t){this.ctx.applyFilter(t)},function(){return this.ctx.fields},function(t){this.ctx.add(this.field)},function(){return this.field.active},function(){return this.field.title},function(){return this.field.entry.error},function(){return this.field.operators.length>1},function(){return this.field.operators},function(){return this.field.entry.op},function(){return t=>this.field.entry.op=t},function(){return this.field.operators.length<2},function(){return"field-"+this.field.value_type},function(){return this.field.entry.val},function(){return this.field.constraints},function(){return t=>this.field.entry.val=t},function(){return t=>this.field.entry.error=t},function(t){this.ctx.remove(this.field)},function(){return this.ctx.debug},function(){return this.ctx.filterJSON},function(){return this.ctx.filterBase},function(){return""===this.ctx.filterBase},function(t){this.ctx.resetFilters(t)},function(){return this.ctx.filterStr===this.ctx.filterBase}]],this.filterStr=r("filter",(function(){return void 0!==this.filter?this.filter:""})),this.filterObj=r((function(){const t={};if(this.filter){const e=JSON.parse(atob(this.filter));for(let[s,n]of Object.entries(e))t[s]=g.create(n)}return g.create(t)})),this.filterJSON=r("model",(function(){!function(s,n,i){const r=s[e][n];if(i.length!==r.keys.length||i.some((t=>!r.keys.includes(t)))){const o={target:s,property:n,wdesc:r};r.keys.length&&l(s,o,h(r.keys),`${s[t]}:${n}`),i.length&&a(s,o,h(i),`${s[t]}:${n}`),s[e][n].keys=i,s[e][n].cached=!1}}(this,"filterJSON",this.model.filters.reduce(((t,e)=>t.concat([`filterObj.${e.key}.op`,`filterObj.${e.key}.val`])),["model"]));const s={};for(let[t,e]of Object.entries(this.filterObj)){const{op:n,val:i}=e;i.length&&(s[t]={op:n,val:i})}return JSON.stringify(s,0,1)})),this.filterBase=r("filterJSON",(function(){return"{}"!==this.filterJSON?btoa(this.filterJSON):""})),this.fields=r("model","filterObj",(function(){const t=this.filterObj;return this.model.filters.map(((e,s)=>{const n=t[e.key]||(t[e.key]=g.create({}));return n.op=n.op||e.operators[0],n.val=n.val||("subset"===e.value_type?f.create():""),n.error=null,g.create({key:e.key,title:e.title,operators:e.operators,value_type:e.value_type,constraints:f.create(e.constraints),active:0===s||!!n.val.length,entry:n})}))}))}add(t){t.active=!0}remove(t){t.active=!1,t.entry.val=t.entry.val.slice(0,0)}applyFilter(t){this.setaction(this.filterBase),t.preventDefault()}resetFilters(t){Object.values(this.filterObj).forEach((t=>t.val=t.val.slice(0,0))),this.applyFilter(t)}},Ft.components["widget-gallery"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-gallery"]],[],[[3,"div",[["class","m-reel"]],[],[[1,[0,["ctx.model.images"]],["image","i"],[[3,"img",[[":src",1,["image.src"]],[":alt",2,["image.alt"]],["@click",3,[]]],[],[]]]]]]]]]',[function(){return this.ctx.model.images},function(){return this.image.src},function(){return this.image.alt},function(t){this.ctx.setIndex(this.i)}]],this.index=0,this.image=r("index",(function(){return this.model.images[this.index]})),this.active="active"}setIndex(t){"-1"===t?this.index>0&&this.index--:"+1"===t?this.index<this.model.images.length-1&&this.index++:this.index=t}},Ft.components["widget-icon"]=class extends b{constructor(){super(),this.template=['[[3,"span",[["class","m-icon"],[":class",[[[0,["ctx.classes"]]]]],[":title",1,["ctx.title"]]],[],[[4,2,["ctx.svg"]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.title},function(){return this.ctx.svg}]],this.svg=r("glyph",(function(){const{glyph:t}=this;St[t]||(St[t]=(async()=>{const t=await fetch(`app/styles/icons/${this.glyph}.svg`),e=await t.text();if(!/^<svg/.test(e))return null;return(new DOMParser).parseFromString(e,"application/xml")})()),St[t].then((t=>{const e=this.getElements()[0];e&&(Array.from(e.querySelectorAll("svg")).forEach((t=>t.remove())),e.appendChild(e.ownerDocument.importNode(t.documentElement,!0)))}))}))}},Ft.components["widget-image"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-image"]],[],[[3,"img",[[":class",[[[0,["ctx.classes"]]]]],[":src",1,["ctx.model.src"]],[":alt",2,["ctx.model.alt"]],[":width",3,["ctx.model.width"]]],[],[]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.model.src},function(){return this.ctx.model.alt},function(){return this.ctx.model.width}]],this.classes="img-responsive widget-img"}},Ft.components["widget-keyval"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-keyval"]],[],[[3,"ul",[],[],[[1,[0,["ctx.model.items"]],["row","index"],[[3,"li",[],[],[[3,"div",[],[],[[0,[[[1,[2,["row.value"]],["val"],[[4,3,["ctx.format","parent.row.formatter","val"]]]]],[[4,4,["ctx.format","row.formatter","row.value"]]]],[[4,1,["row.list"]],[4,null,[]]]]]],[3,"div",[],[],[[4,5,["row.title"]]]]]]]]]]]]]',[function(){return this.ctx.model.items},function(){return this.row.list},function(){return this.row.value},function(){return this.ctx.format(this.parent.row.formatter,this.val)},function(){return this.ctx.format(this.row.formatter,this.row.value)},function(){return this.row.title}]],this.formatters=r((function(){return this.getOwner().formatters})),this.format=r("formatters.version",(function(){const{formatters:t}=this;return(e,s)=>t[`format-${e}`](s)}))}},Ft.components["widget-link"]=class extends b{constructor(){super(),this.template=['[[3,"a",[[":class",[[[0,["ctx.classes"]]]]],[":href",1,["ctx.model.href"]],[":download",2,["ctx.model.download"]]],[],[[4,3,["ctx.model.title"]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.model.href},function(){return this.ctx.model.download},function(){return this.ctx.model.title}]]}},Ft.components["widget-loader"]=class extends b{constructor(){super(),this.template=['[[0,[[[0,[[[3,"h5",[],[],[[4,2,["ctx.model.title"]]]],[3,"m-x",[[":component",3,["ctx.model.type"]],[":model",4,["ctx.data"]]],[],[]]],[[3,"div",[["class","m-loader"]],[],[[3,"div",[],[],[]],[3,"div",[],[],[]],[3,"div",[],[],[]],[3,"div",[],[],[]]]]]],[[4,1,["ctx.data.then"]],[4,null,[]]]]],[[2,"\\n        Widget "],[3,"strong",[],[],[[4,5,["ctx.model.type"]]]],[2," not available\\n      "]]],[[4,0,["ctx.proto"]],[4,null,[]]]]]',[function(){return this.ctx.proto},function(){return this.ctx.data&&!this.ctx.data.then},function(){return this.ctx.model.title},function(){return"widget-"+this.ctx.model.type},function(){return this.ctx.data},function(){return this.ctx.model.type}]],this.route=r((function(){return this.getOwner().lookup("detail-route")})),this.proto=r("model.type",(function(){return this.getOwner().components[`widget-${this.model.type}`]})),this.data=r("model",(async function(){let{data:t}=this.model;if(jt.test(t)){const e=`dataset/${this.route.params.id}/${t.replace(jt,"")}`;t=await this.getOwner().lookup("application-route").api({url:e},!0),this.model.data=t}return t}))}},Ft.components["widget-map"]=Dt,Ft.components["widget-modal"]=class extends b{constructor(){super(),this.template=['[[0,[[[3,"div",[["class","m-modal is-active"],[":class",[[[1,["ctx.classes"]]]]],["@keydown",2,[]],["@keyup",3,[]]],[],[[3,"div",[["class","m-modal-background"],["@click",4,[]]],[],[]],[3,"div",[["class","m-modal-card"]],[],[[3,"header",[["class","m-modal-card-head"]],[],[[3,"p",[["class","m-modal-card-title"]],[],[[4,5,["ctx.title"]]]],[3,"button",[["class","m-delete"],["type","button"],["aria-label","close"],["@click",6,[]]],[],[]]]],[3,"section",[["class","m-modal-card-body"]],[],[[3,"m-slot",[["name","body"],["params","body"]],[],[]]]],[3,"footer",[["class","m-modal-card-foot"]],[],[[3,"m-slot",[["name","footer"],["params","footer"]],[],[]]]]]]]]]],[[4,0,["ctx.scroll","ctx.open"]]]]]',[function(){return this.ctx.scroll||this.ctx.open},function(){return this.ctx.classes},function(t){this.ctx.keydown(t)},function(t){this.ctx.keyup(t)},function(t){t.target===t.currentTarget&&this.ctx.close(t)},function(){return this.ctx.title},function(t){this.ctx.close()}]],this.scroll=r("open",(function(){this.open?(document.body.parentElement.classList.add("is-clipped"),this.getOwner().addAfterRender((()=>{this.focusable()[1].focus()}))):document.body.parentElement.classList.remove("is-clipped")}))}focusable(){return[...this.getElement().querySelectorAll('a, button, input, textarea, select, details,[tabindex]:not([tabindex="-1"]')].filter((t=>!t.hasAttribute("disabled")))}close(){this.setopen(!1)}keydown(t){if("Tab"===t.key){const e=this.focusable();t.target===e[e.length-1]&&(e[0].focus(),t.stopPropagation())}}keyup(t){"Escape"===t.key&&(this.close(),t.stopPropagation())}},Ft.components["widget-mpld3"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-mpld3"]],[],[]]]',[]]}async didInsertElement(){const t=window.btoa(this.__oid__).replace(/=*$/,"");this.getElement().id=t;const{width:e,height:s}=this.model;window.requestAnimationFrame((async()=>{this.model.width=Math.min(this.getElement().offsetWidth,e),this.model.height=this.model.width/e*s,this.figure=await zt.draw_figure(t,this.model),this.figure.plugins[1].activate()}))}},Ft.components["widget-plotly"]=Rt,Ft.components["widget-pre"]=class extends b{constructor(){super(),this.template=['[[3,"pre",[[":class",[[[0,["ctx.classes"]]]]]],[],[[4,1,["ctx.model.text"]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.model.text}]]}},Ft.components["widget-table"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-table m-stack"],[":class",[[[0,["ctx.classes"]]]]]],[],[[3,"div",[["class","m-table-container"]],[],[[3,"div",[["class","mu-d-flex mu-align-items-center"]],[],[[3,"div",[["class","mu-d-flex-grow-1 mu-d-flex mu-align-items-center mu-flex-gap"]],[],[[0,[[[0,[[[3,"label",[],[],[[3,"input-checkbox",[[":value",3,["ctx.allChecked"]],[":changeaction",4,[]]],[],[]],[2,"\\n                    All ("],[4,5,["ctx.selectedRows.length"]],[2," rows selected)\\n                  "]]]]],[[4,2,["ctx.selectable"]]]],[3,"div",[],[],[[3,"m-slot",[[":params",6,["ctx.selectedRows"]]],[],[]]]]]],[[4,1,["ctx.paginated.length"]]]]]]]],[3,"table",[["class","m-table is-hoverable is-fullwidth"]],[],[[3,"thead",[],[],[[3,"tr",[],[],[[0,[[[3,"th",[],[],[]]]],[[4,2,["ctx.selectable"]]]],[1,[7,["ctx.columns"]],["col","index"],[[3,"th",[[":class",[[["mu-text-right"],[8,["col.align"]]]]],["@click",9,[]]],[],[[4,10,["col.title"]],[0,[[[3,"widget-icon",[[":glyph",12,["ctx.descending"]]],[],[]]],[]],[[4,11,["index","ctx.sort"]],[4,null,[]]]]]]]]]]]],[3,"tbody",[],[],[[1,[13,["ctx.zip","ctx.paginated","ctx.checkboxes"]],["row","index"],[[3,"tr",[],[],[[0,[[[3,"td",[],[],[[3,"input-checkbox",[[":value",14,["row.1"]],[":changeaction",15,[]]],[],[]]]]]],[[4,2,["ctx.selectable"]]]],[1,[16,["ctx.zip","ctx.columns","row.0.values"]],["col"],[[3,"td",[[":class",[[["mu-text-right"],[17,["col.0.align"]]]]]],[],[[0,[[[1,[19,["col.1"]],["val"],[[3,"span",[["::html",20,["ctx.format","parent.col.0.formatter","val"]]],[],[]]]]],[[3,"span",[["::html",21,["ctx.format","col.0.formatter","col.1"]]],[],[]]]],[[4,18,["col.0.list"]],[4,null,[]]]]]]]]]]]]]]]]]],[0,[[[3,"nav",[["class","m-pagination"],["role","navigation"],["aria-label","pagination"]],[],[[3,"ul",[["class","m-pagination-list"]],[],[[3,"li",[],[],[[3,"a",[["class","m-pagination-link"],[":disabled",23,["ctx.pager.prev.disabled"]],["aria-label","Previous"],["@click",24,[]]],[],[[3,"span",[["aria-hidden","true"]],[],[[2,""]]]]]]],[1,[25,["ctx.pager.pages"]],["page"],[[3,"li",[],[],[[3,"a",[[":class",[[["is-current"],[26,["page.active"]]],[["m-pagination-link"],[27,["page.disabled"]]],[["m-pagination-ellipsis"],[28,["page.disabled"]]]]],[":aria-label",29,["page.num"]],[":aria-current",30,["page.active"]],["@click",31,[]],["::text",32,["page.num"]]],[],[]]]]]],[3,"li",[],[],[[3,"a",[["class","m-pagination-link"],[":disabled",33,["ctx.pager.next.disabled"]],["aria-label","Next"],["@click",34,[]]],[],[[3,"span",[["aria-hidden","true"]],[],[[2,""]]]]]]]]]]]]],[[4,22,["ctx.numPages"]]]]]]]',[function(){return this.ctx.classes},function(){return this.ctx.paginated.length},function(){return this.ctx.selectable},function(){return this.ctx.allChecked},function(){return()=>this.ctx.toggleAll()},function(){return this.ctx.selectedRows.length},function(){return this.ctx.selectedRows},function(){return this.ctx.columns},function(){return"right"===this.col.align},function(t){this.ctx.sortby(this.index)},function(){return this.col.title},function(){return this.index===this.ctx.sort},function(){return this.ctx.descending?"sort-descending":"sort-ascending"},function(){return this.ctx.zip(this.ctx.paginated,this.ctx.checkboxes)},function(){return this.row[1]},function(){return()=>this.ctx.toggleItem(this.index)},function(){return this.ctx.zip(this.ctx.columns,this.row[0].values)},function(){return"right"===this.col[0].align},function(){return this.col[0].list},function(){return this.col[1]},function(){return this.ctx.format(this.parent.col[0].formatter,this.val)},function(){return this.ctx.format(this.col[0].formatter,this.col[1])},function(){return this.ctx.numPages>1},function(){return this.ctx.pager.prev.disabled},function(t){this.ctx.prevPage(t)},function(){return this.ctx.pager.pages},function(){return this.page.active},function(){return!this.page.disabled},function(){return this.page.disabled},function(){return"Goto page "+this.page.num},function(){return!!this.page.active&&"page"},function(t){this.ctx.setpage(this.page.num,t)},function(){return this.page.num},function(){return this.ctx.pager.next.disabled},function(t){this.ctx.nextPage(t)}]],this.selectable=r("selectableforce","model.actions",(function(){return this.selectableforce||!(!this.model.actions||!this.model.actions.length)})),this.columns=r("model",(function(){const t=JSON.parse(localStorage.getItem(this.cacheid)||'{"visibility":{}}');return f.from(this.model.columns,(e=>Object.assign(new g,e,{formatter:e.formatter,visible:!1!==t.visibility[e.title],query:""})))})),this.indices=r("model",(function(){return Uint32Array.from({length:this.model.rows.length},((t,e)=>e))})),this.selected=r("model",(function(){return new Int8Array(this.model.rows.length)})),this.allChecked=!1,this.selectedRows=new f,this.cachedSortParams=r("cacheid",(function(){return{sort:null,descending:null}})),this.sort=r("cacheid","model.sortcolumn",(function(){const{sort:t}=this.cachedSortParams;return null!==t?t:this.model.sortcolumn})),this.descending=r("cacheid","model.sortorder",(function(){const{descending:t}=this.cachedSortParams;return null!==t?t:"descending"===this.model.sortorder})),this.cache=r("model",(function(){return this.model.__cache||(this.model.__cache={}),this.model.__cache})),this.omodel=r("model",(function(){const t=g.create(this.model);return t.actions||(t.actions=[]),t})),this.sortedidxs=r("sort","descending","model.rows",(function(){const{model:{rows:t},sort:e,descending:s,cache:n,indices:i}=this;if(null===e||!t.length)return new Uint32Array;const r=`sort${e}`;if(!(r in n)){let s;if(this.model.columns[e].sortkey){const t=this.model.columns[e].sortkey;s=e=>null!==e?e[t]:""}else s=this.model.columns[e].list?t=>null!==t?t.length:"":t=>null!==t?t:"";const o=t.map((t=>s(t.values[e]))),c=i.slice();D(c,((t,e)=>{if((t=o[t])===(e=o[e]))return 0;const s=typeof t,n=typeof e;return s!==n?s>n?1:-1:t>e?1:-1})),n[r]=c}return s?n[r].slice().reverse():n[r]})),this.pagesizes=[50,100],this.pagesize=50,this.filteredidxs=r("sortedidxs","model.rows","filtersOpen","columns.@each.query",(function(){const{model:{rows:t},sortedidxs:e}=this;let s;return s=e,s})),this.page=r("filteredidxs",(function(){return 0})),this.pageidxs=r("filteredidxs","page","pagesize","columns",(function(){const{page:t,pagesize:e,filteredidxs:s}=this;return-1===e?s:s.subarray(t*e,(t+1)*e)})),this.checkboxes=r("pageidxs",(function(){const{selected:t}=this;return f.from(this.pageidxs,(e=>t[e]))})),this.numPages=r("filteredidxs","pagesize",(function(){return this.pagesize?Math.ceil(this.filteredidxs.length/this.pagesize):1})),this.paginated=r("pageidxs",(function(){const{pageidxs:t}=this;return Array.from(t,(t=>this.model.rows[t]))})),this.pagersize=7,this.pager=r("page","pagesize","filteredidxs",(function(){if(this.filteredidxs.length<this.pagesize)return[];const t={prev:{disabled:0===this.page,page:this.page-1},next:{disabled:this.page===this.numPages-1,page:this.page+1},pages:[]};for(let e=0,s=this.numPages;e<s;e++)t.pages.push({num:e+1,active:e===this.page});if(t.pages.length>this.pagersize){const e={num:"",disabled:!0},s=this.pagersize-1,n=s>>1,i=(s>>1)+(1&s);this.page<=n?t.pages.splice(s-1,t.pages.length-s,e):this.page>=t.pages.length-1-i?t.pages.splice(1,t.pages.length-s,e):(t.pages.splice(this.page+i-1,t.pages.length-1-(this.page+i-1),e),t.pages.splice(1,this.page-(n-1),e))}return t})),this.formatters=r((function(){return this.getOwner().formatters})),this.format=r("formatters.version",(function(){const{formatters:t}=this;return t.version,(e,s)=>t[`format-${e}`](s)})),this.empty=""}toggleItem(t){const e=this.pageidxs[t];this.checkboxes[t]=!this.checkboxes[t],this.selected[e]=!this.selected[e],this.allChecked=!this.selected.some((t=>!t));const s=this.model.rows[e];this.selected[e]?this.selectedRows.push(s):this.selectedRows.splice(this.selectedRows.indexOf(s),1),this.selectionchange&&this.selectionchange(this.selectedRows)}toggleAll(){this.allChecked?(this.checkboxes.fill(0),this.selected.fill(0)):(this.checkboxes.fill(1),this.selected.fill(1)),this.allChecked=!this.selected.some((t=>!t)),this.allChecked?this.selectedRows=f.from(this.model.rows):this.selectedRows=new f,this.selectionchange&&this.selectionchange(this.selectedRows)}prevPage(t){t.preventDefault(),this.page>0&&this.page--}nextPage(t){t.preventDefault(),this.page<this.numPages-1&&this.page++}setpage(t,e){e.preventDefault(),this.page=t-1}sortby(t){this.sort===t?this.descending=!this.descending:(this.descending=!1,this.sort=t)}zip(t,e){return Array.from(t,((t,s)=>[t,e[s]]))}},Ft.components["widget-tag"]=class extends b{constructor(){super(),this.template=['[[3,"m-dropdown",[[":openaction",0,["ctx.openaction"]],[":classes",1,["ctx.menuclass"]]],["dd"],[[3,"button",[["into","trigger"],["role","button"],["class","m-button m-dropdown-toggle"],[":class",[[[2,["ctx.classes"]]]]],[":disabled",3,["ctx.fulldisabled"]],["@click",4,[]]],[],[[2,"tag"]]],[3,"div",[["into","content"],["class","m-dropdown-item"],["@keydown",5,[]],["@keyup",6,[]]],[],[[0,[[[3,"a",[["@click",8,[]]],[],[[2,"\\n            Sign in to tag\\n          "]]]],[[3,"form",[["class","is-small"],["@submit",9,[]]],[],[[3,"div",[["class","m-field"]],[],[[3,"input-control",[["type","text"],["classes","m-input"],["placeholder","Label"],[":value",10,["ctx.search"]],[":changeaction",11,[]]],[],[]]]],[3,"div",[["class","m-field"]],[],[[1,[12,["ctx.results"]],["tag"],[[3,"button",[["type","button"],["class","m-button is-text is-fullwidth mu-justify-content-start"],["@click",13,[]],[":title",14,["tag.hint"]]],[],[[3,"widget-icon",[[":glyph",15,["tag.state"]]],[],[]],[3,"span",[],[],[[4,16,["tag.name"]]]]]]]]]],[3,"div",[["class","m-field m-buttons mu-justify-content-end"]],[],[[3,"button",[["type","button"],["class","m-button"],["@click",17,[]]],[],[[2,"Cancel"]]],[3,"button",[["type","submit"],["class","m-button is-primary is-outlined"],[":disabled",18,["ctx.changed"]]],[],[[2,"\\n                Save tags\\n              "]]]]]]]]],[[4,7,["ctx.disabled"]],[4,null,[]]]]]]]]]',[function(){return this.ctx.openaction},function(){return this.ctx.menuclass},function(){return this.ctx.classes},function(){return this.ctx.fulldisabled},function(t){this.ctx.open(this.dd)},function(t){this.ctx.keydown(t)},function(t){this.ctx.keyup(t)},function(){return this.ctx.disabled},function(t){this.ctx.altaction()},function(t){this.ctx.save(t)},function(){return this.ctx.search},function(){return t=>this.ctx.search=t},function(){return this.ctx.results},function(t){this.ctx.toggle(this.tag)},function(){return this.tag.hint},function(){return this.tag.state??"plus"},function(){return this.tag.name},function(t){this.dd.close()},function(){return!this.ctx.changed}]],this.tags=null,this.alltags=null,this.search="",this.changed=!1,this.malltags=[],this.realtags=[],this.mtags=r("realtags",(function(){return f.create(this.realtags)})),this.vtags=r("mtags.@each","malltags.@each",(function(){return f.create(this.realtags.map((t=>g.create({name:t,state:~this.mtags.indexOf(t)?"task":"task-no"}))).concat(this.malltags.filter((t=>!~this.realtags.indexOf(t))).map((t=>g.create({name:t,state:~this.mtags.indexOf(t)?"task":"task-no"})))))})),this.results=r("search","vtags.@each",(function(){const t=this.search,e=new RegExp(t,"i"),s=f.create(this.vtags.filter((t=>e.test(t.name))));return t&&!s.filter((e=>e.name===t)).length&&s.push(g.create({name:`create "${t}"`,action:"create",label:this.search})),s.sort(((t,e)=>t.name<e.name?-1:1))}))}focusable(){return[...this.getElement().querySelectorAll('a, button, input, textarea, select, details,[tabindex]:not([tabindex="-1"]')].filter((t=>!t.hasAttribute("disabled")))}open(t){if(this.search="",this.changed=!1,this.malltags=f.create(this.alltags),this.tags.length)if("string"==typeof this.tags[0])this.realtags=f.create(this.tags);else{let t=this.tags[0].tags.slice();this.tags.forEach((e=>{t=t.filter((t=>~e.tags.indexOf(t)))})),this.realtags=f.create(t)}else this.realtags=f.create();t.open(),this.getOwner().addAfterRender((()=>{this.focusable()[1].focus()}))}toggle(t){"create"===t.action?(this.mtags.push(this.search),~this.malltags.indexOf(this.search)||this.malltags.push(this.search),this.search=""):~this.mtags.indexOf(t.name)?this.mtags.splice(this.mtags.indexOf(t.name),1):this.mtags.push(t.name),this.changed=!0,this.getOwner().addAfterRender((()=>{this.focusable()[1].focus()}))}keydown(t){const e=t;if(13===e.keyCode&&"INPUT"===e.target.tagName)this.search&&(~this.malltags.indexOf(this.search)?~this.mtags.indexOf(this.search)?this.mtags.splice(this.mtags.indexOf(this.search),1):this.mtags.push(this.search):(this.malltags.push(this.search),this.mtags.push(this.search)),this.search=""),this.changed=!0,e.stopPropagation(),e.preventDefault();else if("Tab"===t.key){const e=this.focusable();t.target===e[e.length-1]&&(e[0].focus(),t.stopPropagation())}}keyup(t){if("Escape"===t.key){const e=this.getElement().querySelectorAll('button[type="button"]');e[e.length-1].click(),t.stopPropagation()}}save(t){t.preventDefault(),this.changed||this.toggle({action:"create"});const e=this.mtags.filter((t=>!~this.realtags.indexOf(t))),s=this.realtags.filter((t=>!~this.mtags.indexOf(t)));this.changeaction({added:e,removed:s})}},Ft.components["widget-video"]=class extends b{constructor(){super(),this.template=['[[3,"div",[["class","widget-video widget-gl"]],[],[[3,"div",[["tabindex","-1"],["@keyup",0,[]]],[],[[3,"video",[["@click",1,[]],["@timeupdate",2,[]],["@mousemove",3,[]],[":controls",4,["ctx.controls"]],[":src",5,["ctx.model.src"]]],[],[]],[3,"div",[["class","widget-gl-controls"],[":class",[[["is-shown"],[6,["ctx.showControls"]]],[["is-autohide"],[7,["ctx.burgerOpen"]]]]],["@animationend",8,[]]],[],[[0,[[[3,"form",[],[],[[3,"div",[],[],[[3,"strong",[],[],[[2,"Status"]]],[3,"table",[["class","mu-w-100"]],[],[[3,"tbody",[],[],[[3,"tr",[],[],[[3,"td",[],[],[[2,"Playback time"]]],[3,"td",[["::text",10,["ctx.playbackTime"]]],[],[]]]],[3,"tr",[],[],[[3,"td",[],[],[[2,"Playback rate"]]],[3,"td",[["::text",11,["ctx.playbackRate"]]],[],[]]]]]]]]]],[3,"hr",[],[],[]],[3,"div",[],[],[[3,"strong",[],[],[[2,"Shortcuts"]]],[3,"table",[["class","mu-w-100"]],[],[[3,"tbody",[],[],[[1,[12,["ctx.shortcuts"]],["item"],[[3,"tr",[],[],[[3,"td",[],[],[[3,"kbd",[["::text",13,["item.key"]]],[],[]]]],[3,"td",[],[],[[4,14,["item.desc"]]]]]]]]]]]]]]]]]],[[4,9,["ctx.burgerOpen"]]]],[3,"div",[],[],[[3,"button",[["class","m-button"],["@click",15,[]]],[],[[3,"widget-icon",[["glyph","menu"]],[],[]]]]]]]]]]]]]',[function(t){this.ctx.up(t)},function(t){this.ctx.toggle(t)},function(t){this.ctx.timeupdate(t)},function(t){this.ctx.mousemove(t)},function(){return this.ctx.controls},function(){return this.ctx.model.src},function(){return this.ctx.showControls},function(){return!this.ctx.burgerOpen},function(t){this.ctx.showControls=!1},function(){return this.ctx.burgerOpen},function(){return this.ctx.playbackTime},function(){return this.ctx.playbackRate},function(){return this.ctx.shortcuts},function(){return this.item.key},function(){return this.item.desc},function(t){this.ctx.burgerOpen=!this.ctx.burgerOpen}]],this.controls=!0,this.showControls=!0,this.playbackRate=1,this.playbackTime="unknown",this.shortcuts=[{key:"m",desc:"Toggle menu"},{key:"k",desc:"Toggle playback"},{key:"f",desc:"Toggle fullscreen"},{key:"j",desc:"Go 10s back"},{key:"l",desc:"Go 10s forward"},{key:">",desc:"Speed up playback"},{key:"<",desc:"Slow down playback"}],this.timeupdate=r((function(){if("requestVideoFrameCallback"in HTMLVideoElement.prototype)return()=>{};const t=this.getElement().querySelector("video");return()=>{this.playbackTime=t.currentTime}})),this.vfc=r((function(){if(!("requestVideoFrameCallback"in HTMLVideoElement.prototype))return null;const t=this.getElement().querySelector("video");return(e,s)=>{this.playbackTime=s.mediaTime,t.requestVideoFrameCallback(this.vfc)}}))}mousemove(){const t=this.getElement().querySelector(".widget-gl-controls");document.getAnimations().forEach((e=>{e.effect.target===t&&(e.currentTime=0)})),this.showControls=!0}toggle(t){t.preventDefault();const e=this.getElement().querySelector("video");e.paused?e.play():e.pause()}up(t){const e=this.getElement(),s=e.querySelector("video");let n=0;"KeyM"==t.code?(this.burgerOpen=!this.burgerOpen,this.burgerOpen&&(this.showControls=!0)):"KeyJ"==t.code?n=-10:"KeyL"==t.code?n=10:"KeyK"==t.code?this.toggle(t):"KeyF"==t.code?document.fullscreenElement===e?document.exitFullscreen():e.requestFullscreen():">"==t.key?(s.playbackRate+=1,this.playbackRate=s.playbackRate):"<"==t.key&&(s.playbackRate>=1&&(s.playbackRate-=1),this.playbackRate=s.playbackRate),n&&(s.currentTime+=n)}didInsertElement(){if(this.vfc){this.getElement().querySelector("video").requestVideoFrameCallback(this.vfc)}}willRemoveElement(){if(this.vfc){this.getElement().querySelector("video").cancelVideoFrameCallback(this.vfc)}}},Ft.components["widget-waiting"]=class extends b{constructor(){super(),this.template=['[[0,[[[3,"div",[["class","m-hero"]],[],[[3,"div",[["class","m-hero-body"]],[],[[3,"div",[["class","mu-text-center"]],[],[[3,"widget-icon",[[":glyph",1,["ctx.icon"]]],[],[]]]],[3,"div",[["class","mu-text-center"]],[],[[4,0,["ctx.error"]]]]]]]]],[[3,"div",[["class","m-hero"]],[],[[3,"div",[["class","m-hero-body"]],[],[[3,"div",[["class","mu-text-center"]],[],[[3,"widget-icon",[[":glyph",1,["ctx.icon"]]],[],[]]]],[3,"div",[["class","m-loader"]],[],[[3,"div",[],[],[]],[3,"div",[],[],[]],[3,"div",[],[],[]],[3,"div",[],[],[]]]]]]]]],[[3,"m-slot",[],[],[]]]],[[4,0,["ctx.error"]],[4,2,["ctx.isPromise"]],[4,null,[]]]]]',[function(){return this.ctx.error},function(){return this.ctx.icon},function(){return this.ctx.isPromise}]],this.model=r("scope.parent.ctx.model",(function(){return this.scope.parent.ctx.model})),this.error=r("acl","model.error",(function(){if(!this.acl){return this[`e${this.user?403:401}`]}if(this.model&&this.model.error){const t=this.model.error.status;return this[`e${t}`]?this[`e${t}`]:JSON.stringify(this.model&&this.model.error)}})),this.isPromise=r("model",(function(){return this.model instanceof Promise}))}},Ft.routes=[{name:"index",path:""},{name:"collection",path:"/collection/:id",queryParams:{filter:{refreshModel:!0},debugfilters:{}}},{name:"detail",path:"/detail/:id"},{name:"compare",path:"/compare/:id"},{name:"admin",path:"/admin"},{name:"notfound",path:"*wildcard"},{name:"redeem",path:"/redeem/:id"},{name:"reset",path:"/reset/:id"}];if(/code=/.test(location.search)){const t=/code=([^&]*)/.exec(decodeURIComponent(location.search))[1];window.opener&&(window.opener.postMessage(t,location.origin),window.close())}const Bt=g.create({pdf:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.4.456/pdf.min.js",worker:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.4.456/pdf.worker.min.js",PDFJS:r((function(){return new Promise(((t,e)=>{document.head.append(Object.assign(document.createElement("script"),{type:"text/javascript",src:this.pdf,onload(){const e=window["pdfjs-dist/build/pdf"];e.GlobalWorkerOptions.workerSrc=Bt.worker,t(e)},onerror(){e(`Error loading ${this.src}`)}}))}))}))}); //jxdigpbTtupwZWdO0y5t5prlzxBFN2NArGjTne5Sb6T38jU2+fMKalcICqlCruT3EGSFy5bZO7fV/uvXC1Df1oEj7WOneE/NAMQ1jXWR0YoWnLPtGDZ0Atn1fkzoKuwA1rsNkd6MtfJXvlH0weCY3dmLAfc3rBDQCJ331Qy06svDBfKaPaEdsXJ2XlnEJ11F45mSSYEyjmi2w+k39sGxE2wlYWqAyFOtLqdBQGs9gchVlq+YHyjWztd8JJ+hVyzMZSRXzn8QmtXnled4wegI7CoWTu8B+iJdm+7cINn9hrCWsvBbZz60WCdBFGZJUqSOl703bl4LBcxuMvadLKIxOUJ33o/fnQAA