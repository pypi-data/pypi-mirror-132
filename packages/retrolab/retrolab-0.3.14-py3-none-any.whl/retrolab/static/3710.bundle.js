(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[3710],{23710:(e,t,o)=>{"use strict";o.r(t),o.d(t,{CodeMirrorEditor:()=>w,CodeMirrorEditorFactory:()=>P,CodeMirrorMimeTypeService:()=>E,EditorSyntaxStatus:()=>D,ICodeMirror:()=>j,Mode:()=>S,editorServices:()=>R});var i=o(93245),n=o(42489),s=o(87289),r=o(24318),a=o(76943),l=o(78429),d=o(39462),c=o(12291),h=o(41981),u=o.n(h),m=(o(52500),o(25927),o(32253),o(78736),o(64208),o(98699),o(62702),o(16287),o(80662),o(38057),o(49115),o(4274),o(99103),o(81041),o(95169),o(60191),o(20677),o(31700),o(59561),o(35519),o(53528),o(16963),o(94236)),g=o(11182),p=o(28306),f=o(38828),y=o(7695),_=o(12519);const C="prosemirror-binding",b=e=>{const t=document.createElement("span");t.setAttribute("style","user-select: none;");const o=document.createElement("span");o.insertBefore(document.createTextNode(""),null);const i=document.createElement("span");return i.setAttribute("class","y-line-selection"),i.setAttribute("style",`display: inline-block; position: absolute; left: 4px; right: 4px; top: 0; bottom: 0; background-color: ${e}70`),t.insertBefore(i,null),t.insertBefore(o,null),t};class v{constructor(e,t,o=null,{yUndoManager:i=null}={}){const n=e.doc,s=t.getDoc();if(this.doc=n,this.type=e,this.cm=t,this.cmDoc=s,this.awareness=o||null,this.yUndoManager=i,this._onStackItemAdded=({stackItem:t,changedParentTypes:o})=>{o.has(e)&&this._beforeChangeSelection&&t.meta.set(this,this._beforeChangeSelection)},this._onStackItemPopped=({stackItem:e})=>{const o=e.meta.get(this);if(o){const e=p.createAbsolutePositionFromRelativePosition(o.anchor,n).index,i=p.createAbsolutePositionFromRelativePosition(o.head,n).index;t.setSelection(t.posFromIndex(e),t.posFromIndex(i)),this._beforeChange()}},i){i.trackedOrigins.add(this);const e=e=>{e.endOperation(),i.undo(),e.startOperation()},o=e=>{e.endOperation(),i.redo(),e.startOperation()};t.addKeyMap({"Ctrl-Z":e,"Shift-Ctrl-Z":o,"Ctrl-Y":o,"Cmd-Z":e,"Shift-Cmd-Z":o,"Cmd-Y":o}),i.on("stack-item-added",this._onStackItemAdded),i.on("stack-item-popped",this._onStackItemPopped)}this._mux=(0,m.M)(),s.setValue(e.toString()),this._typeObserver=e=>((e,t)=>{e._mux((()=>{const o=e.cmDoc,i=o.getEditor();let n=i.indexFromPos(i.getCursor("anchor")),s=i.indexFromPos(i.getCursor("head"));const r=s<n;if(r){const e=s;s=n,n=e}const a=()=>{const e=t.delta;let i=0;for(let r=0;r<t.delta.length;r++){const t=e[r];if(t.retain)i+=t.retain;else if(t.insert){(i<n||n<s&&i===n)&&(n+=t.insert.length),i<s&&(s+=t.insert.length);const e=o.posFromIndex(i);o.replaceRange(t.insert,e,e,C),i+=t.insert.length}else if(t.delete){i<n&&(n=g.Fp(n-t.delete,i)),i<s&&(s=g.Fp(s-t.delete,i));const e=o.posFromIndex(i),r=o.posFromIndex(i+t.delete);o.replaceRange("",e,r,C)}}};if(i?i.operation(a):a(),r){const e=s;s=n,n=e}i.setSelection(i.posFromIndex(n),i.posFromIndex(s),{scroll:!1})}))})(this,e),this._targetObserver=(e,t)=>{e.getDoc()===s&&((e,t)=>{e._mux((()=>{e.doc.transact((()=>{if(t.length>1){const t=_.UC(e.type.toString(),e.cmDoc.getValue());e.type.delete(t.index,t.remove),e.type.insert(t.index,t.insert)}else{const o=t[0],i=e.cmDoc.indexFromPos(o.from),n=o.removed.map((e=>e.length)).reduce(g.IH)+o.removed.length-1;n>0&&e.type.delete(i,n),o.text.length>0&&e.type.insert(i,o.text.join("\n"))}}),e)}))})(this,t)},this._cursors=new Map,this._changedCursors=new Set,this._debounceCursorEvent=y.Ot(10),this._awarenessListener=i=>{if(t.getDoc()!==s)return;const r=e=>{e!==n.clientID&&this._changedCursors.add(e)};i.added.forEach(r),i.removed.forEach(r),i.updated.forEach(r),this._changedCursors.size>0&&this._debounceCursorEvent((()=>{this._changedCursors.forEach((i=>{((e,t,o,i,n,s)=>{const r=s.getStates().get(n),a=i.get(n);if(void 0!==a&&(a.caret&&a.caret.clear(),a.sel.forEach((e=>e.clear())),i.delete(n)),void 0===r)return;const l=r.user||{};null==l.color&&(l.color="#ffa500"),null==l.name&&(l.name=`User: ${n}`);const d=r.cursor;if(null==d||null==d.anchor||null==d.head)return;const c=p.createAbsolutePositionFromRelativePosition(JSON.parse(d.anchor),e),h=p.createAbsolutePositionFromRelativePosition(JSON.parse(d.head),e);if(null!==c&&null!==h&&c.type===o&&h.type===o){const e=t.posFromIndex(h.index),o=t.posFromIndex(c.index);let s,m;h.index<c.index?(s=e,m=o):(s=o,m=e);const g=((e,t)=>{const o=document.createElement("span");o.classList.add("remote-caret"),o.setAttribute("style",`border-color: ${t}`);const i=document.createElement("div");return i.setAttribute("style",`background-color: ${t}`),i.insertBefore(document.createTextNode(e),null),o.insertBefore(i,null),setTimeout((()=>{o.classList.add("hide-name")}),2e3),o})(l.name,l.color);a&&f.UV(r.cursor.anchor,a.awCursor.anchor)&&f.UV(r.cursor.head,a.awCursor.head)&&g.classList.add("hide-name");const p=[];if(h.index!==c.index){for(s.line!==m.line&&0!==s.ch&&(p.push(t.markText(s,new(u().Pos)(s.line+1,0),{css:`background-color: ${l.color}70;`,inclusiveRight:!1,inclusiveLeft:!1})),s=new(u().Pos)(s.line+1,0));s.line!==m.line;)p.push(t.setBookmark(new(u().Pos)(s.line,0),{widget:b(l.color)})),s=new(u().Pos)(s.line+1,0);p.push(t.markText(s,m,{css:`background-color: ${l.color}70;`,inclusiveRight:!1,inclusiveLeft:!1}))}const y=p.length>0&&m===e&&0===e.ch?null:t.setBookmark(e,{widget:g,insertLeft:!0});i.set(n,{caret:y,sel:p,awCursor:d})}})(n,t,e,this._cursors,i,o)})),this._changedCursors.clear()}))},this._cursorListener=()=>{t.getDoc()===s&&setTimeout((()=>{((e,t,o,i)=>{const n=i.getLocalState();if(!t.hasFocus()||null==n||!t.display.wrapper.ownerDocument.hasFocus())return;const s=p.createRelativePositionFromTypeIndex(o,t.indexFromPos(t.getCursor("anchor"))),r=p.createRelativePositionFromTypeIndex(o,t.indexFromPos(t.getCursor("head")));let a=null,l=null;null!=n.cursor&&(a=p.createRelativePositionFromJSON(JSON.parse(n.cursor.anchor)),l=p.createRelativePositionFromJSON(JSON.parse(n.cursor.head))),null!=n.cursor&&p.compareRelativePositions(a,s)&&p.compareRelativePositions(l,r)||i.setLocalStateField("cursor",{anchor:JSON.stringify(s),head:JSON.stringify(r)})})(0,t,e,o)}),0)},this._blurListeer=()=>o.setLocalStateField("cursor",null),e.observe(this._typeObserver),t.on("changes",this._targetObserver),this._beforeChangeSelection=null,this._beforeChange=()=>{this._mux((()=>{const o=p.createRelativePositionFromTypeIndex(e,t.indexFromPos(t.getCursor("anchor"))),i=p.createRelativePositionFromTypeIndex(e,t.indexFromPos(t.getCursor("head")));this._beforeChangeSelection={anchor:o,head:i}}))},t.on("beforeChange",this._beforeChange),o&&(t.on("swapDoc",this._blurListeer),o.on("change",this._awarenessListener),t.on("cursorActivity",this._cursorListener),t.on("blur",this._blurListeer),t.on("focus",this._cursorListener))}destroy(){this.type.unobserve(this._typeObserver),this.cm.off("swapDoc",this._blurListeer),this.cm.off("changes",this._targetObserver),this.cm.off("beforeChange",this._beforeChange),this.cm.off("cursorActivity",this._cursorListener),this.cm.off("focus",this._cursorListener),this.cm.off("blur",this._blurListeer),this.awareness&&this.awareness.off("change",this._awarenessListener),this.yUndoManager&&(this.yUndoManager.off("stack-item-added",this._onStackItemAdded),this.yUndoManager.off("stack-item-popped",this._onStackItemPopped),this.yUndoManager.trackedOrigins.delete(this)),this.type=null,this.cm=null,this.cmDoc=null}}var S,x,M=o(78919);o(18851),o(17790),o(61447),o(24952),o(45703),o(14113),o(24458),o(1992),o(26821),o(78493),o(35320),u().defineMode("ipython",((e,t)=>{const o={};for(const e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);return o.name="python",o.singleOperators=new RegExp("^[\\+\\-\\*/%&|@\\^~<>!\\?]"),o.identifiers=new RegExp("^[_A-Za-z¡-￿][_A-Za-z0-9¡-￿]*"),u().getMode(e,o)}),"python"),u().defineMIME("text/x-ipython","ipython"),u().modeInfo.push({ext:[],mime:"text/x-ipython",mode:"ipython",name:"ipython"}),o(61429),o(42629),o(64188),u().defineMode("ipythongfm",((e,t)=>{const o=u().getMode(e,{name:"gfm",tokenTypeOverrides:{list3:"string-2"}}),i=u().getMode(e,{name:"stex",inMathMode:!0});return u().multiplexingMode(o,{open:"<code>",close:"</code>",mode:o,parseDelimiters:!0},{open:"<pre>",close:"</pre>",mode:o,parseDelimiters:!0},{open:"```",close:"```",mode:o,parseDelimiters:!0},{open:"`",close:"`",mode:o,parseDelimiters:!0},{open:"$$",close:"$$",mode:i,delimStyle:"delimit"},{open:"$",close:"$",mode:i,delimStyle:"delimit"},{open:"\\(",close:"\\)",mode:i,delimStyle:"delimit"},{open:"\\[",close:"\\]",mode:i,delimStyle:"delimit"})}),"gfm"),u().defineMIME("text/x-ipythongfm","ipythongfm"),u().modeInfo.push({ext:[],mime:"text/x-ipythongfm",mode:"ipythongfm",name:"ipythongfm"}),function(e){const t=[{loader:async e=>u().modes.hasOwnProperty(e.mode),rank:0},{loader:function(e){return new Promise(((t,i)=>{Promise.all([o.e(1058),o.e(7364)]).then((function(){var i=[o(27364)(`./${e.mode}/${e.mode}.js`)];(function(){t(!0)}).apply(null,i)})).catch(o.oe)}))},rank:99}];function i(e){var t;const o="string"==typeof e?e:e.mode||e.name,i="string"!=typeof e?e.mime:o,r="string"!=typeof e&&null!==(t=e.ext)&&void 0!==t?t:[];return u().findModeByName(o||"")||u().findModeByMIME(i||"")||n(r)||u().findModeByMIME(s.IEditorMimeTypeService.defaultMimeType)||u().findModeByMIME("text/plain")}function n(e){if("string"==typeof e)return u().findModeByExtension(e);for(let t=0;t<e.length;t++){const o=u().findModeByExtension(e[t]);if(o)return o}return null}e.getModeInfo=function(){return u().modeInfo},e.run=function(e,t,o){u().runMode(e,t,o)},e.ensure=async function(e){const o=i(e);for(const e of t)if(await e.loader(o))return o;return null},e.addSpecLoader=function(e,o){const i={loader:e,rank:o},n=r.ArrayExt.upperBound(t,i,x.itemCmp);r.ArrayExt.insert(t,n,i)},e.findBest=i,e.findByMIME=function(e){return u().findModeByMIME(e)},e.findByName=function(e){return u().findModeByName(e)},e.findByFileName=function(e){const t=M.PathExt.basename(e);return u().findModeByFileName(t)},e.findByExtension=n}(S||(S={})),function(e){e.itemCmp=function(e,t){return e.rank-t.rank}}(x||(x={}));const O="jp-mod-readOnly";class w{constructor(e){this.edgeRequested=new c.Signal(this),this.selectionMarkers={},this._keydownHandlers=new Array,this._changeGuard=!1,this._uuid="",this._needsRefresh=!1,this._isDisposed=!1,this._lastChange=null;const t=this.host=e.host;this.translator=e.translator||i.nullTranslator,this._trans=this.translator.load("jupyterlab"),t.classList.add("jp-CodeMirrorEditor"),t.classList.add("jp-Editor"),t.addEventListener("focus",this,!0),t.addEventListener("blur",this,!0),t.addEventListener("scroll",this,!0),this._uuid=e.uuid||a.UUID.uuid4();const o=e.selectionStyle||{};this._selectionStyle=Object.assign(Object.assign({},s.CodeEditor.defaultSelectionStyle),o);const n=this._model=e.model,l=e.config||{},h=this._config=Object.assign(Object.assign({},w.defaultConfig),l),m=this._editor=k.createEditor(t,h);this._initializeEditorBinding(),this.model.sharedModelSwitched.connect(this._initializeEditorBinding,this),m.getDoc(),this._onMimeTypeChanged(),this._onCursorActivity(),this._poll=new d.Poll({factory:async()=>{this._checkSync()},frequency:{interval:3e3,backoff:!1},standby:()=>!this._lastChange||"when-hidden"}),n.mimeTypeChanged.connect(this._onMimeTypeChanged,this),n.selections.changed.connect(this._onSelectionsChanged,this),u().on(m,"keydown",((e,t)=>{-1===r.ArrayExt.findFirstIndex(this._keydownHandlers,(e=>!0===e(this,t)&&(t.preventDefault(),!0)))&&this.onKeydown(t)})),u().on(m,"cursorActivity",(()=>this._onCursorActivity())),u().on(m.getDoc(),"change",((e,t)=>{"setValue"===t.origin&&this.hasFocus()&&this.refresh(),this._lastChange=t})),m.on("paste",((e,t)=>{var o;null===(o=this._config.handlePaste)||void 0===o||o||(t.codemirrorIgnore=!0)})),m.getWrapperElement().addEventListener("paste",(()=>{this.hasFocus()&&this.refresh()}))}_initializeEditorBinding(){var e;null===(e=this._yeditorBinding)||void 0===e||e.destroy();const t=this.model.sharedModel,o=t.undoManager?{yUndoManager:t.undoManager}:{},i=t.awareness;this._yeditorBinding=new v(t.ysource,this.editor,i,o)}get uuid(){return this._uuid}set uuid(e){this._uuid=e}get selectionStyle(){return this._selectionStyle}set selectionStyle(e){this._selectionStyle=e}get editor(){return this._editor}get doc(){return this._editor.getDoc()}get lineCount(){return this.doc.lineCount()}get model(){return this._model}get lineHeight(){return this._editor.defaultTextHeight()}get charWidth(){return this._editor.defaultCharWidth()}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.host.removeEventListener("focus",this,!0),this.host.removeEventListener("blur",this,!0),this.host.removeEventListener("scroll",this,!0),this._yeditorBinding&&this._yeditorBinding.destroy(),this._keydownHandlers.length=0,this._poll.dispose(),c.Signal.clearData(this))}getOption(e){return this._config[e]}setOption(e,t){this._config[e]!==t&&(this._config[e]=t,k.setOption(this.editor,e,t,this._config))}setOptions(e){const t=this._editor;t.startOperation();for(let o in e)t.operation((()=>{this.setOption(o,e[o])}));t.endOperation()}getLine(e){return this.doc.getLine(e)}getOffsetAt(e){return this.doc.indexFromPos({ch:e.column,line:e.line})}getPositionAt(e){const{ch:t,line:o}=this.doc.posFromIndex(e);return{line:o,column:t}}undo(){this.model.sharedModel.undo()}redo(){this.model.sharedModel.redo()}clearHistory(){var e,t;null===(t=null===(e=this._yeditorBinding)||void 0===e?void 0:e.yUndoManager)||void 0===t||t.clear()}focus(){this._editor.focus()}hasFocus(){return this._editor.getWrapperElement().contains(document.activeElement)}blur(){this._editor.getInputField().blur()}refresh(){this._editor.refresh(),this._needsRefresh=!1}resizeToFit(){this.hasFocus()?this.refresh():this._needsRefresh=!0,this._clearHover()}addOverlay(e,t){this._editor.addOverlay(e,t)}removeOverlay(e){this._editor.removeOverlay(e)}getSearchCursor(e,t,o){return this._editor.getDoc().getSearchCursor(e,t,o)}getCursor(e){return this._editor.getDoc().getCursor(e)}get state(){return this._editor.state}operation(e){return this._editor.operation(e)}firstLine(){return this._editor.getDoc().firstLine()}lastLine(){return this._editor.getDoc().lastLine()}scrollIntoView(e,t){this._editor.scrollIntoView(e,t)}scrollIntoViewCentered(e){var t,o;const i=this._editor.charCoords(e,"local").top,n=this._editor.getWrapperElement().offsetHeight;null===(o=(t=this.host).scrollIntoView)||void 0===o||o.call(t,{behavior:"auto",block:"center",inline:"center"}),this._editor.scrollTo(null,i-n/2)}cursorCoords(e,t){return this._editor.cursorCoords(e,t)}getRange(e,t,o){return this._editor.getDoc().getRange(e,t,o)}addKeydownHandler(e){return this._keydownHandlers.push(e),new l.DisposableDelegate((()=>{r.ArrayExt.removeAllWhere(this._keydownHandlers,(t=>t===e))}))}setSize(e){e?this._editor.setSize(e.width,e.height):this._editor.setSize(null,null),this._needsRefresh=!1}revealPosition(e){const t=this._toCodeMirrorPosition(e);this._editor.scrollIntoView(t)}revealSelection(e){const t={from:this._toCodeMirrorPosition(e.start),to:this._toCodeMirrorPosition(e.end)};this._editor.scrollIntoView(t)}getCoordinateForPosition(e){const t=this._toCodeMirrorPosition(e);return this.editor.charCoords(t,"page")}getPositionForCoordinate(e){return this._toPosition(this.editor.coordsChar(e))||null}getCursorPosition(){const e=this.doc.getCursor();return this._toPosition(e)}setCursorPosition(e,t){const o=this._toCodeMirrorPosition(e);this.doc.setCursor(o,void 0,t),this.editor.hasFocus()||this.model.selections.set(this.uuid,this.getSelections())}getSelection(){return this.getSelections()[0]}setSelection(e){this.setSelections([e])}getSelections(){const e=this.doc.listSelections();if(e.length>0)return e.map((e=>this._toSelection(e)));const t=this.doc.getCursor();return[this._toSelection({anchor:t,head:t})]}setSelections(e){const t=this._toCodeMirrorSelections(e);this.doc.setSelections(t,0)}replaceSelection(e){this.doc.replaceSelection(e)}getTokens(){let e=[];for(let t=0;t<this.lineCount;++t){const o=this.editor.getLineTokens(t).map((e=>({offset:this.getOffsetAt({column:e.start,line:t}),value:e.string,type:e.type||""})));e=e.concat(o)}return e}getTokenForPosition(e){var t;const o=this._toCodeMirrorPosition(e),i=this.editor.getTokenAt(o);return{offset:this.getOffsetAt({column:i.start,line:o.line}),value:i.string,type:null!==(t=i.type)&&void 0!==t?t:void 0}}newIndentedLine(){this.execCommand("newlineAndIndent")}execCommand(e){this._editor.execCommand(e)}onKeydown(e){const t=this.getCursorPosition(),{line:o,column:i}=t;if(0===o&&0===i&&38===e.keyCode)return e.shiftKey||this.edgeRequested.emit("top"),!1;if(0===o&&38===e.keyCode)return e.shiftKey||this.edgeRequested.emit("topLine"),!1;const n=this.lineCount-1,s=this.getLine(n).length;return o===n&&i===s&&40===e.keyCode&&(e.shiftKey||this.edgeRequested.emit("bottom"),!1)}_toCodeMirrorSelections(e){if(e.length>0)return e.map((e=>this._toCodeMirrorSelection(e)));const t={line:0,ch:0};return[{anchor:t,head:t}]}_onMimeTypeChanged(){const e=this._model.mimeType,t=this._editor.getOption("extraKeys")||{};"text/plain"!==e&&"text/x-ipythongfm"!==e?t.Backspace="delSpaceToPrevTabStop":delete t.Backspace,this.setOption("extraKeys",t),S.ensure(e).then((e=>{var t;this.setOption("mode",null!==(t=null==e?void 0:e.mime)&&void 0!==t?t:"null")}))}_onSelectionsChanged(e,t){const o=t.key;o!==this.uuid&&(this._cleanSelections(o),"remove"!==t.type&&t.newValue&&this._markSelections(o,t.newValue))}_cleanSelections(e){const t=this.selectionMarkers[e];t&&t.forEach((e=>{e.clear()})),delete this.selectionMarkers[e]}_markSelections(e,t){const o=[];let i;e===this._hoverId&&this._clearHover(),this._model.modelDB.collaborators&&(i=this._model.modelDB.collaborators.get(e)),t.forEach((e=>{if(a.JSONExt.deepEqual(e.start,e.end)){if(i){const t=this._getCaret(i);o.push(this.doc.setBookmark(this._toCodeMirrorPosition(e.end),{widget:t}))}}else{const t=e.start.line<e.end.line||e.start.line===e.end.line&&e.start.column<=e.end.column,n=this._toCodeMirrorPosition(t?e.start:e.end),s=this._toCodeMirrorPosition(t?e.end:e.start);let r;r=i?this._toTextMarkerOptions(Object.assign(Object.assign({},e.style),{color:i.color})):this._toTextMarkerOptions(e.style),o.push(this.doc.markText(n,s,r))}})),this.selectionMarkers[e]=o}_onCursorActivity(){if(this._editor.hasFocus()){const e=this.getSelections();this.model.selections.set(this.uuid,e)}}_toSelection(e){return{uuid:this.uuid,start:this._toPosition(e.anchor),end:this._toPosition(e.head),style:this.selectionStyle}}_toTextMarkerOptions(e){const t=`background-color: rgba( ${parseInt(e.color.slice(1,3),16)}, ${parseInt(e.color.slice(3,5),16)}, ${parseInt(e.color.slice(5,7),16)}, 0.15)`;return{className:e.className,title:e.displayName,css:t}}_toCodeMirrorSelection(e){return{anchor:this._toCodeMirrorPosition(e.start),head:this._toCodeMirrorPosition(e.end)}}_toPosition(e){return{line:e.line,column:e.ch}}_toCodeMirrorPosition(e){return{line:e.line,ch:e.column}}_onValueChanged(e,t){if(this._changeGuard)return;this._changeGuard=!0;const o=this.doc;switch(t.type){case"insert":{const e=o.posFromIndex(t.start);o.replaceRange(t.value,e,e,"+input");break}case"remove":{const e=o.posFromIndex(t.start),i=o.posFromIndex(t.end);o.replaceRange("",e,i,"+input");break}case"set":o.setValue(t.value)}this._changeGuard=!1}_beforeDocChanged(e,t){if(this._changeGuard)return;this._changeGuard=!0;const o=this._model.value,i=e.indexFromPos(t.from),n=e.indexFromPos(t.to),s=t.text.join("\n");n!==i&&o.remove(i,n),s&&o.insert(i,s),this._changeGuard=!1}handleEvent(e){switch(e.type){case"focus":this._evtFocus(e);break;case"blur":this._evtBlur(e);break;case"scroll":this._evtScroll()}}_evtFocus(e){this._needsRefresh&&this.refresh(),this.host.classList.add("jp-mod-focused"),this._onCursorActivity()}_evtBlur(e){this.host.classList.remove("jp-mod-focused")}_evtScroll(){this._clearHover()}_clearHover(){this._caretHover&&(window.clearTimeout(this._hoverTimeout),document.body.removeChild(this._caretHover),this._caretHover=null)}_getCaret(e){const t=e?e.displayName:"Anonymous",o=e?e.color:this._selectionStyle.color,i=document.createElement("span");return i.className="jp-CollaboratorCursor",i.style.borderBottomColor=o,i.onmouseenter=()=>{this._clearHover(),this._hoverId=e.sessionId;const n=i.getBoundingClientRect(),s=document.createElement("div");s.className="jp-CollaboratorCursor-hover",s.style.left=String(n.left)+"px",s.style.top=String(n.bottom)+"px",s.textContent=t,s.style.backgroundColor=o,s.onmouseenter=()=>{window.clearTimeout(this._hoverTimeout)},s.onmouseleave=()=>{this._hoverTimeout=window.setTimeout((()=>{this._clearHover()}),1e3)},this._caretHover=s,document.body.appendChild(s)},i.onmouseleave=()=>{this._hoverTimeout=window.setTimeout((()=>{this._clearHover()}),1e3)},i}_checkSync(){const e=this._lastChange;if(!e)return;this._lastChange=null;const t=this._editor,o=t.getDoc();o.getValue()!==this._model.value.text&&((0,n.showDialog)({title:this._trans.__("Code Editor out of Sync"),body:this._trans.__("Please open your browser JavaScript console for bug report instructions")}),console.warn('If you are able and willing to publicly share the text or code in your editor, you can help us debug the "Code Editor out of Sync" message by pasting the following to the public issue at https://github.com/jupyterlab/jupyterlab/issues/2951. Please note that the data below includes the text/code in your editor.'),console.warn(JSON.stringify({model:this._model.value.text,view:o.getValue(),selections:this.getSelections(),cursor:this.getCursorPosition(),lineSep:t.getOption("lineSeparator"),mode:t.getOption("mode"),change:e})))}}var k;!function(e){e.defaultConfig=Object.assign(Object.assign({},s.CodeEditor.defaultConfig),{mode:"null",theme:"jupyter",smartIndent:!0,electricChars:!0,keyMap:"default",extraKeys:null,gutters:[],fixedGutter:!0,showCursorWhenSelecting:!1,coverGutterNextToScrollbar:!1,dragDrop:!0,lineSeparator:null,scrollbarStyle:"native",lineWiseCopyCut:!0,scrollPastEnd:!1,styleActiveLine:!1,styleSelectedText:!0,selectionPointer:!1,rulers:[],foldGutter:!1,handlePaste:!0}),e.addCommand=function(e,t){u().commands[e]=t}}(w||(w={})),function(e){function t(e,t){return e.line===t.line&&e.ch===t.ch}function o(e){const t={"CodeMirror-linenumbers":"lineNumbers","CodeMirror-foldgutter":"codeFolding"};return Object.keys(t).filter((o=>e[t[o]]))}e.createEditor=function(e,t){const{autoClosingBrackets:o,fontFamily:i,fontSize:n,insertSpaces:s,lineHeight:r,lineWrap:a,wordWrapColumn:l,tabSize:d,readOnly:c}=t,h=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o}(t,["autoClosingBrackets","fontFamily","fontSize","insertSpaces","lineHeight","lineWrap","wordWrapColumn","tabSize","readOnly"]),m=Object.assign({autoCloseBrackets:!!o&&{},indentUnit:d,indentWithTabs:!s,lineWrapping:"off"!==a,readOnly:c},h);return u()((t=>{i&&(t.style.fontFamily=i),n&&(t.style.fontSize=n+"px"),r&&(t.style.lineHeight=r.toString()),c&&t.classList.add(O),"wordWrapColumn"===a&&(t.querySelector(".CodeMirror-lines").style.width=`${l}ch`),"bounded"===a&&(t.querySelector(".CodeMirror-lines").style.maxWidth=`${l}ch`),e.appendChild(t)}),m)},e.indentMoreOrinsertTab=function(e){const o=e.getDoc(),i=o.getCursor("from");if(!t(i,o.getCursor("to")))return void u().commands.indentMore(e);const n=o.getLine(i.line).slice(0,i.ch);/^\s*$/.test(n)?u().commands.indentMore(e):e.getOption("indentWithTabs")?u().commands.insertTab(e):u().commands.insertSoftTab(e)},e.delSpaceToPrevTabStop=function(e){var o;const i=e.getDoc(),n=null!==(o=e.getOption("indentUnit"))&&void 0!==o?o:2,s=i.listSelections();for(let o=s.length-1;o>=0;o--){const r=s[o].head,a=s[o].anchor;if(t(r,a))if(null!==i.getLine(r.line).substring(0,r.ch).match(/^\ +$/)){const e=(Math.ceil(r.ch/n)-1)*n,t=u().Pos(r.line,e);i.replaceRange("",t,r)}else{const t=e.findPosH(r,-1,"char",!1);i.replaceRange("",t,r)}else i.replaceRange("",a,r)}},e.posEq=t,e.setOption=function(e,t,i,n){const s=e.getWrapperElement();switch(t){case"cursorBlinkRate":e.setOption(t,i);break;case"lineWrap":{const t="off"!==i,o=s.querySelector(".CodeMirror-lines"),r="bounded"===i?`${n.wordWrapColumn}ch`:null,a="wordWrapColumn"===i?`${n.wordWrapColumn}ch`:null;o.style.setProperty("max-width",r),o.style.setProperty("width",a),e.setOption("lineWrapping",t);break}case"wordWrapColumn":{const{lineWrap:e}=n;if("wordWrapColumn"===e||"bounded"===e){const t="wordWrapColumn"===e?"width":"maxWidth";s.querySelector(".CodeMirror-lines").style[t]=`${i}ch`}break}case"tabSize":e.setOption("indentUnit",i);break;case"insertSpaces":e.setOption("indentWithTabs",!i);break;case"autoClosingBrackets":e.setOption("autoCloseBrackets",i);break;case"rulers":{const t=i;e.setOption("rulers",t.map((e=>({column:e,className:"jp-CodeMirror-ruler"}))));break}case"readOnly":s.classList.toggle(O,i),e.setOption(t,i);break;case"fontFamily":s.style.fontFamily=i;break;case"fontSize":s.style.setProperty("font-size",i?i+"px":null);break;case"lineHeight":s.style.lineHeight=i?i.toString():null;break;case"gutters":e.setOption(t,o(n));break;case"lineNumbers":e.setOption(t,i),e.setOption("gutters",o(n));break;case"codeFolding":e.setOption("foldGutter",i),e.setOption("gutters",o(n));break;case"showTrailingSpace":default:e.setOption(t,i)}}}(k||(k={})),w.addCommand("delSpaceToPrevTabStop",k.delSpaceToPrevTabStop),w.addCommand("indentMoreOrinsertTab",k.indentMoreOrinsertTab);class P{constructor(e={},t){this.newInlineEditor=e=>(e.host.dataset.type="inline",new w(Object.assign(Object.assign({},e),{config:Object.assign(Object.assign({},this.inlineCodeMirrorConfig),e.config||{}),translator:this.translator}))),this.newDocumentEditor=e=>(e.host.dataset.type="document",new w(Object.assign(Object.assign({},e),{config:Object.assign(Object.assign({},this.documentCodeMirrorConfig),e.config||{}),translator:this.translator}))),this.translator=t||i.nullTranslator,this.inlineCodeMirrorConfig=Object.assign(Object.assign(Object.assign({},w.defaultConfig),{extraKeys:{"Cmd-Right":"goLineRight",End:"goLineRight","Cmd-Left":"goLineLeft",Tab:"indentMoreOrinsertTab","Shift-Tab":"indentLess","Cmd-/":e=>e.toggleComment({indent:!0}),"Ctrl-/":e=>e.toggleComment({indent:!0}),"Ctrl-G":"find","Cmd-G":"find"}}),e),this.documentCodeMirrorConfig=Object.assign(Object.assign(Object.assign({},w.defaultConfig),{extraKeys:{Tab:"indentMoreOrinsertTab","Shift-Tab":"indentLess","Cmd-/":e=>e.toggleComment({indent:!0}),"Ctrl-/":e=>e.toggleComment({indent:!0}),"Shift-Enter":()=>{}},lineNumbers:!0,scrollPastEnd:!0}),e)}}class E{getMimeTypeByLanguage(e){const t=e.file_extension||"";return S.findBest(e.codemirror_mode||{mimetype:e.mimetype,name:e.name,ext:[t.split(".").slice(-1)[0]]}).mime}getMimeTypeByFilePath(e){const t=M.PathExt.extname(e);return".ipy"===t?"text/x-python":".md"===t?"text/x-ipythongfm":(S.findByFileName(e)||S.findBest("")).mime}}var T=o(41654),I=o(36735),F=o(72245),L=o.n(F);function B(e){return L().createElement(T.TextItem,{source:e.mode,onClick:e.handleClick})}class D extends n.VDomRenderer{constructor(e){super(new D.Model),this._handleClick=()=>{const e=new I.Menu({commands:this._commands});this._popup&&this._popup.dispose(),S.getModeInfo().sort(((e,t)=>{const o=e.name||"",i=t.name||"";return o.localeCompare(i)})).forEach((t=>{if(0===t.mode.indexOf("brainf"))return;const o={insertSpaces:!0,name:t.name};e.addItem({command:"codemirror:change-mode",args:o})})),this._popup=(0,T.showPopup)({body:e,anchor:this,align:"left"})},this._popup=null,this._commands=e.commands,this.translator=e.translator||i.nullTranslator;const t=this.translator.load("jupyterlab");this.addClass(T.interactiveItem),this.title.caption=t.__("Change text editor syntax highlighting")}render(){return this.model?L().createElement(B,{mode:this.model.mode,handleClick:this._handleClick}):null}}!function(e){class t extends n.VDomModel{constructor(){super(...arguments),this._onMIMETypeChange=(e,t)=>{const o=this._mode,i=S.findByMIME(t.newValue);this._mode=i.name||i.mode,this._triggerChange(o,this._mode)},this._mode="",this._editor=null}get mode(){return this._mode}get editor(){return this._editor}set editor(e){const t=this._editor;null!==t&&t.model.mimeTypeChanged.disconnect(this._onMIMETypeChange);const o=this._mode;if(this._editor=e,null===this._editor)this._mode="";else{const e=S.findByMIME(this._editor.model.mimeType);this._mode=e.name||e.mode,this._editor.model.mimeTypeChanged.connect(this._onMIMETypeChange)}this._triggerChange(o,this._mode)}_triggerChange(e,t){e!==t&&this.stateChanged.emit(void 0)}}e.Model=t}(D||(D={}));const j=new a.Token("@jupyterlab/codemirror:ICodeMirror"),R={factoryService:new P,mimeTypeService:new E}}}]);