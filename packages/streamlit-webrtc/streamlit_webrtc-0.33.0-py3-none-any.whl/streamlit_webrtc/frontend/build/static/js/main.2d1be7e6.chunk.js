(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(37),o=n.n(a),c=n(45),d=n(90),s=n(184),u=n(86),l=n.n(u),f=n(4),v=function(e){var t=Object(c.useRenderData)().theme,n=JSON.stringify(t),i=r.a.useMemo((function(){var e=JSON.parse(n);if(null!=e){var t=l.a.scale([e.textColor,e.backgroundColor]).mode("lab");return Object(d.a)({palette:{primary:{main:e.primaryColor},background:{default:e.backgroundColor,paper:e.secondaryBackgroundColor},text:{primary:e.textColor,secondary:t(.1).hex(),disabled:t(.5).hex()}},typography:{fontFamily:e.font}})}}),[n]);return null==i?Object(f.jsx)(f.Fragment,{children:e.children}):Object(f.jsx)(s.a,{theme:i,children:e.children})},b=n(177),O=n(9),j=n(183),m=n(182),p=n(179),h=n(20),g=n(27),S=n(187),E=n(181),y=n(178),A=n(185),R=n(10),I=n(75),x=Object(R.a)(A.a)((function(e){return{padding:e.theme.spacing(2)}})),C=Object(R.a)(S.a)((function(e){return{maxWidth:"80vw",margin:e.theme.spacing(1),minWidth:120,display:"flex"}})),D=Object(R.a)(S.a)((function(e){var t=e.theme;return{margin:t.spacing(2),marginBottom:t.spacing(1),minWidth:120,display:"flex"}})),w=function(e){var t=e.open,n=e.anchorEl,r=e.videoEnabled,a=e.audioEnabled,o=e.value,c=e.devicesMap,d=e.onSubmit,s=Object(i.useState)(null),u=Object(O.a)(s,2),l=u[0],v=u[1],b=Object(i.useState)(null),j=Object(O.a)(b,2),p=j[0],h=j[1];Object(i.useEffect)((function(){v(c.video.find((function(e){var t;return e.deviceId===(null===(t=o.video)||void 0===t?void 0:t.deviceId)}))||null),h(c.audio.find((function(e){var t;return e.deviceId===(null===(t=o.audio)||void 0===t?void 0:t.deviceId)}))||null)}),[c,o]);var S=Object(i.useCallback)((function(e){e.preventDefault(),d(r?l:null,a?p:null)}),[d,r,a,l,p]),A=Object(i.useRef)(),R=Object(i.useCallback)((function(e){e?setTimeout((function(){var t=document.getElementsByTagName("body")[0];A.current=t.style.height;var n=window.getComputedStyle(e),i=new WebKitCSSMatrix(n.transform).m42+e.getBoundingClientRect().height;i>document.body.scrollHeight&&(t.style.height="".concat(i,"px"),g.Streamlit.setFrameHeight())}),0):setTimeout((function(){var e=document.getElementsByTagName("body")[0];null!=A.current&&(e.style.height=A.current),g.Streamlit.setFrameHeight()}),0)}),[]);return Object(f.jsx)(y.a,{ref:R,open:t,anchorEl:n,placement:"left-end",children:Object(f.jsx)(x,{children:Object(f.jsxs)("form",{onSubmit:S,children:[r&&Object(f.jsxs)(C,{children:[Object(f.jsx)(E.a,{id:"video-input-select",children:"Video input"}),Object(f.jsx)(I.a,{labelId:"video-input-select",devices:c.video,value:l,onChange:v})]}),a&&Object(f.jsxs)(C,{children:[Object(f.jsx)(E.a,{id:"audio-input-select",children:"Audio input"}),Object(f.jsx)(I.a,{labelId:"audio-input-select",devices:c.audio,value:p,onChange:h})]}),Object(f.jsx)(D,{children:Object(f.jsx)(m.a,{type:"submit",variant:"contained",color:"primary",children:"OK"})})]})})})},N=function(e){var t=e.videoEnabled,n=e.audioEnabled,a=e.value,o=e.onSelect,c=Object(i.useState)(!1),d=Object(O.a)(c,2),s=d[0],u=d[1],l=r.a.useState(null),v=Object(O.a)(l,2),b=v[0],p=v[1],g=Object(i.useState)(),S=Object(O.a)(g,2),E=S[0],y=S[1],A=Object(i.useState)(!1),R=Object(O.a)(A,2),I=R[0],x=R[1],C=Object(i.useCallback)((function(e){var t,n;if(p(e.currentTarget),"function"!==typeof(null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.enumerateDevices))return y(void 0),void x(!0);navigator.mediaDevices.enumerateDevices().then((function(e){var t,n=[],i=[],r=Object(h.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;"videoinput"===a.kind?n.push(a):"audioinput"===a.kind&&i.push(a)}}catch(o){r.e(o)}finally{r.f()}y({video:n,audio:i}),u(!0)}))}),[]),D=Object(i.useCallback)((function(){return u(!1)}),[]),N=Object(i.useCallback)((function(e,t){y(void 0),u(!1),o(e,t)}),[o]);return Object(f.jsxs)(j.a,{children:[I&&Object(f.jsx)("p",{children:"Unavailable"}),E&&Object(f.jsx)(w,{open:s,anchorEl:b,videoEnabled:t,audioEnabled:n,value:a,devicesMap:E,onSubmit:N}),Object(f.jsx)(m.a,{color:"inherit",onClick:s?D:C,children:"Select device"})]})},P=r.a.memo(N),T=n(13),L=function(e){Object(i.useEffect)((function(){g.Streamlit.setFrameHeight()}));var t=e.stream.getVideoTracks().length>0,n=Object(i.useCallback)((function(t){t&&(t.srcObject=e.stream)}),[e.stream]),r=Object(i.useCallback)((function(){return g.Streamlit.setFrameHeight()}),[]);if(t){var a,o,c,d,s,u,l,v,b,O,j,m,p,h,S,E,y={hidden:null===(a=e.userDefinedVideoAttrs)||void 0===a?void 0:a.hidden,style:null===(o=e.userDefinedVideoAttrs)||void 0===o?void 0:o.style,autoPlay:null===(c=e.userDefinedVideoAttrs)||void 0===c?void 0:c.autoPlay,controls:null===(d=e.userDefinedVideoAttrs)||void 0===d?void 0:d.controls,controlsList:null===(s=e.userDefinedVideoAttrs)||void 0===s?void 0:s.controlsList,crossOrigin:null===(u=e.userDefinedVideoAttrs)||void 0===u?void 0:u.crossOrigin,loop:null===(l=e.userDefinedVideoAttrs)||void 0===l?void 0:l.loop,mediaGroup:null===(v=e.userDefinedVideoAttrs)||void 0===v?void 0:v.mediaGroup,muted:null===(b=e.userDefinedVideoAttrs)||void 0===b?void 0:b.muted,playsInline:null===(O=e.userDefinedVideoAttrs)||void 0===O?void 0:O.playsInline,preload:null===(j=e.userDefinedVideoAttrs)||void 0===j?void 0:j.preload,height:null===(m=e.userDefinedVideoAttrs)||void 0===m?void 0:m.height,poster:null===(p=e.userDefinedVideoAttrs)||void 0===p?void 0:p.poster,width:null===(h=e.userDefinedVideoAttrs)||void 0===h?void 0:h.width,disablePictureInPicture:null===(S=e.userDefinedVideoAttrs)||void 0===S?void 0:S.disablePictureInPicture,disableRemotePlayback:null===(E=e.userDefinedVideoAttrs)||void 0===E?void 0:E.disableRemotePlayback};return Object(f.jsx)("video",Object(T.a)(Object(T.a)({},y),{},{ref:n,onCanPlay:r}))}var A,R,I,x,C,D,w,N,P,L,k,G={hidden:null===(A=e.userDefinedAudioAttrs)||void 0===A?void 0:A.hidden,style:null===(R=e.userDefinedAudioAttrs)||void 0===R?void 0:R.style,autoPlay:null===(I=e.userDefinedAudioAttrs)||void 0===I?void 0:I.autoPlay,controls:null===(x=e.userDefinedAudioAttrs)||void 0===x?void 0:x.controls,controlsList:null===(C=e.userDefinedAudioAttrs)||void 0===C?void 0:C.controlsList,crossOrigin:null===(D=e.userDefinedAudioAttrs)||void 0===D?void 0:D.crossOrigin,loop:null===(w=e.userDefinedAudioAttrs)||void 0===w?void 0:w.loop,mediaGroup:null===(N=e.userDefinedAudioAttrs)||void 0===N?void 0:N.mediaGroup,muted:null===(P=e.userDefinedAudioAttrs)||void 0===P?void 0:P.muted,playsInline:null===(L=e.userDefinedAudioAttrs)||void 0===L?void 0:L.playsInline,preload:null===(k=e.userDefinedAudioAttrs)||void 0===k?void 0:k.preload};return Object(f.jsx)("audio",Object(T.a)({ref:n},G))},k=r.a.memo(L),G=n(186),V=n(89),_=n.n(V),Y=Object(R.a)(A.a)((function(e){return{padding:e.theme.spacing(4),display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}})),M=function(e){return Object(i.useEffect)((function(){g.Streamlit.setFrameHeight()})),Object(f.jsx)(Y,{elevation:0,children:e.loading?Object(f.jsx)(G.a,{}):Object(f.jsx)(_.a,{fontSize:"large"})})},F=r.a.memo(M),H=n(5),J=n.n(H),W=n(11);function B(e,t,n){var i=e||{};return t&&(!0===i.video?i.video={deviceId:t}:"object"!==typeof i.video&&null!=i.video||(i.video=Object(T.a)(Object(T.a)({},i.video),{},{deviceId:t}))),n&&(!0===i.audio?i.audio={deviceId:n}:"object"!==typeof i.audio&&null!=i.audio||(i.audio=Object(T.a)(Object(T.a)({},i.audio),{},{deviceId:n}))),i}var U={webRtcState:"STOPPED",sdpOffer:null,signallingTimedOut:!1,stream:null,error:null},K=function(e){return function(t,n){var i=function(e,t){switch(t.type){case"SIGNALLING_START":return Object(T.a)(Object(T.a)({},e),{},{webRtcState:"SIGNALLING",stream:null,error:null,signallingTimedOut:!1});case"SIGNALLING_TIMEOUT":return Object(T.a)(Object(T.a)({},e),{},{signallingTimedOut:!0});case"SET_STREAM":return Object(T.a)(Object(T.a)({},e),{},{stream:t.stream});case"SET_OFFER":return Object(T.a)(Object(T.a)({},e),{},{sdpOffer:t.offer});case"STOPPING":return Object(T.a)(Object(T.a)({},e),{},{webRtcState:"STOPPING",sdpOffer:null});case"STOPPED":return Object(T.a)(Object(T.a)({},e),{},{webRtcState:"STOPPED",sdpOffer:null,stream:null});case"START_PLAYING":return Object(T.a)(Object(T.a)({},e),{},{webRtcState:"PLAYING",sdpOffer:null});case"PROCESS_ANSWER_ERROR":return Object(T.a)(Object(T.a)({},e),{},{error:t.error});case"ERROR":return Object(T.a)(Object(T.a)({},e),{},{webRtcState:"STOPPED",sdpOffer:null,error:t.error})}}(t,n),r="PLAYING"===i.webRtcState,a=r!==("PLAYING"===t.webRtcState),o=i.sdpOffer,c=t.sdpOffer;return(a||o!==c)&&(c&&console.log("Send SDP offer",c),e({playing:r,sdpOffer:o?o.toJSON():""})),i}},z=function(e){return"RECVONLY"===e||"SENDONLY"===e||"SENDRECV"===e},q=function(e){return e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))};function Q(e){return g.Streamlit.setComponentValue(e)}n(125);var X=function(e){var t,n=Object(i.useState)({video:null,audio:null}),r=Object(O.a)(n,2),a=r[0],o=r[1],c=function(e,t,n,r){Object(i.useEffect)((function(){return r({playing:!1,sdpOffer:""})}),[]);var a=Object(i.useRef)(),o=Object(i.useRef)(),c=Object(i.useMemo)((function(){return K(r)}),[r]),d=Object(i.useReducer)(c,U),s=Object(O.a)(d,2),u=s[0],l=s[1],f=Object(i.useCallback)((function(){(function(){var e=Object(W.a)(J.a.mark((function e(){var t;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("STOPPING"!==u.webRtcState){e.next=2;break}return e.abrupt("return");case 2:if(t=o.current,o.current=void 0,l({type:"STOPPING"}),null!=t){e.next=7;break}return e.abrupt("return");case 7:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().catch((function(e){return l({type:"ERROR",error:e})})).finally((function(){l({type:"STOPPED"})}))}),[u.webRtcState]),v=Object(i.useRef)(f);v.current=f;var b=Object(i.useCallback)((function(){"STOPPED"===u.webRtcState&&function(){var i=Object(W.a)(J.a.mark((function i(){var r,c,d,s,u,f,b;return J.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(l({type:"SIGNALLING_START"}),a.current=setTimeout((function(){l({type:"SIGNALLING_TIMEOUT"})}),3e3),r=e.mode,c=e.rtcConfiguration||{},console.log("RTCConfiguration:",c),d=new RTCPeerConnection(c),"SENDRECV"!==r&&"RECVONLY"!==r||d.addEventListener("track",(function(e){var t=e.streams[0];l({type:"SET_STREAM",stream:t})})),"SENDRECV"!==r&&"SENDONLY"!==r){i.next=22;break}if(s=B(e.mediaStreamConstraints,null===t||void 0===t?void 0:t.deviceId,null===n||void 0===n?void 0:n.deviceId),console.log("MediaStreamConstraints:",s),!s.audio&&!s.video){i.next=19;break}if(null!=navigator.mediaDevices){i.next=13;break}throw new Error("navigator.mediaDevices is undefined. It seems the current document is not loaded securely.");case 13:if(null!=navigator.mediaDevices.getUserMedia){i.next=15;break}throw new Error("getUserMedia is not implemented in this browser");case 15:return i.next=17,navigator.mediaDevices.getUserMedia(s);case 17:(u=i.sent).getTracks().forEach((function(e){d.addTrack(e,u)}));case 19:if("SENDONLY"===r){f=Object(h.a)(d.getTransceivers());try{for(f.s();!(b=f.n()).done;)b.value.direction="sendonly"}catch(O){f.e(O)}finally{f.f()}}i.next=23;break;case 22:"RECVONLY"===r&&(d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"}));case 23:return console.log("transceivers",d.getTransceivers()),d.addEventListener("iceconnectionstatechange",(function(){console.log("iceconnectionstatechange",d.iceConnectionState),"disconnected"!==d.iceConnectionState&&"failed"!==d.iceConnectionState&&"closed"!==d.iceConnectionState||v.current()})),o.current=d,i.next=28,q(d).then((function(e){if(null==e)throw new Error("Failed to create an offer SDP");l({type:"SET_OFFER",offer:e})}));case 28:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}()().catch((function(e){return l({type:"ERROR",error:e})}))}),[null===n||void 0===n?void 0:n.deviceId,e.mediaStreamConstraints,e.mode,e.rtcConfiguration,u.webRtcState,null===t||void 0===t?void 0:t.deviceId]);return Object(i.useEffect)((function(){var t=o.current;if(null!=t){var n=e.sdpAnswerJson;if(null==t.remoteDescription&&n&&"SIGNALLING"===u.webRtcState){var i=JSON.parse(n);console.log("Receive answer sdpOffer",i),t.setRemoteDescription(i).then((function(){console.log("Remote description is set"),a.current&&clearTimeout(a.current),l({type:"START_PLAYING"})})).catch((function(e){l({type:"PROCESS_ANSWER_ERROR",error:e}),f()}))}}}),[e.sdpAnswerJson,u.webRtcState,f]),Object(i.useEffect)((function(){var t=e.desiredPlayingState;null!=t&&(!0===t&&"STOPPED"===u.webRtcState?b():!1!==t||"SIGNALLING"!==u.webRtcState&&"PLAYING"!==u.webRtcState||f())}),[e.desiredPlayingState,b,u.webRtcState,f]),{start:b,stop:f,state:u}}(e,a.video,a.audio,e.onComponentValueChange),d=c.state,s=c.start,u=c.stop,l=e.mode,v=e.disabled||"SIGNALLING"===d.webRtcState&&!d.signallingTimedOut||"STOPPING"===d.webRtcState||null!=e.desiredPlayingState,b=z(l)&&function(e){return"SENDRECV"===e||"RECVONLY"===e}(l),g=z(l)&&function(e){return"SENDRECV"===e||"SENDONLY"===e}(l),S={videoEnabled:!(t=e.mediaStreamConstraints)||!!t.video,audioEnabled:!t||!!t.audio},E=S.videoEnabled,y=S.audioEnabled,A=Object(i.useCallback)((function(e,t){o({video:e,audio:t})}),[]);return Object(f.jsxs)(j.a,{children:[d.error&&Object(f.jsxs)(p.a,{severity:"error",children:[d.error.name,": ",d.error.message]}),Object(f.jsx)(j.a,{py:1,display:"flex",children:d.stream?Object(f.jsx)(k,{stream:d.stream,userDefinedVideoAttrs:e.videoHtmlAttrs,userDefinedAudioAttrs:e.audioHtmlAttrs}):b&&Object(f.jsx)(F,{loading:"SIGNALLING"===d.webRtcState})}),Object(f.jsxs)(j.a,{display:"flex",justifyContent:"space-between",children:["PLAYING"===d.webRtcState||"SIGNALLING"===d.webRtcState?Object(f.jsx)(m.a,{variant:"contained",onClick:u,disabled:v,children:"Stop"}):Object(f.jsx)(m.a,{variant:"contained",color:"primary",onClick:s,disabled:v,children:"Start"}),g&&Object(f.jsx)(P,{videoEnabled:E,audioEnabled:y,onSelect:A,value:a})]})]})},Z=function(){var e=Object(c.useRenderData)(),t=e.args.mode,n=e.args.desired_playing_state,i=e.args.sdp_answer_json,r=e.args.rtc_configuration,a=e.args.media_stream_constraints,o=e.args.video_html_attrs,d=e.args.audio_html_attrs;if(!z(t))throw new Error("Invalid mode ".concat(t));return Object(f.jsx)(X,{disabled:e.disabled,mode:t,desiredPlayingState:n,sdpAnswerJson:i,rtcConfiguration:r,mediaStreamConstraints:a,videoHtmlAttrs:o,audioHtmlAttrs:d,onComponentValueChange:Q})};o.a.render(Object(f.jsx)(r.a.StrictMode,{children:Object(f.jsx)(c.StreamlitProvider,{children:Object(f.jsxs)(v,{children:[Object(f.jsx)(b.a,{}),Object(f.jsx)(Z,{})]})})}),document.getElementById("root"))},75:function(e,t,n){"use strict";(function(e){var i=n(0),r=n(94),a=n(133),o=n(10),c=n(4),d=Object(o.a)(r.a)((function(e){return{marginTop:e.theme.spacing(2)}}));t.a=function(t){var n=t.labelId,o=t.value,s=t.devices,u=t.onChange,l=Object(i.useCallback)((function(e){var t=s.find((function(t){return t.deviceId===e.target.value}));u(t||null)}),[s,u]);return 0===s.length?Object(c.jsx)(r.a,{value:"",disabled:!0,children:Object(c.jsx)("option",{"aria-label":"None",value:""})}):null==o?(e((function(){return u(s[0])})),null):Object(c.jsx)(d,{labelId:n,value:o.deviceId,onChange:l,children:s.map((function(e){return Object(c.jsx)(a.a,{value:e.deviceId,children:e.label},e.deviceId)}))})}}).call(this,n(118).setImmediate)}},[[124,1,2]]]);
//# sourceMappingURL=main.2d1be7e6.chunk.js.map