{"version":3,"file":"f1eea415.js","mappings":";;AAiEA;;AAKA;;AAOA;AACA;AACA;AACA;AACA;AAGA;AACA;AAIA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA","sources":["webpack://home-assistant-frontend/./src/panels/lovelace/entity-rows/hui-input-select-entity-row.ts"],"sourcesContent":["import \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { ifDefined } from \"lit/directives/if-defined\";\nimport { DOMAINS_HIDE_MORE_INFO } from \"../../../common/const\";\nimport { stopPropagation } from \"../../../common/dom/stop_propagation\";\nimport { computeDomain } from \"../../../common/entity/compute_domain\";\nimport { computeStateName } from \"../../../common/entity/compute_state_name\";\nimport \"../../../components/entity/state-badge\";\nimport \"../../../components/ha-paper-dropdown-menu\";\nimport { UNAVAILABLE_STATES } from \"../../../data/entity\";\nimport { forwardHaptic } from \"../../../data/haptics\";\nimport {\n  InputSelectEntity,\n  setInputSelectOption,\n} from \"../../../data/input_select\";\nimport { ActionHandlerEvent } from \"../../../data/lovelace\";\nimport { HomeAssistant } from \"../../../types\";\nimport { EntitiesCardEntityConfig } from \"../cards/types\";\nimport { actionHandler } from \"../common/directives/action-handler-directive\";\nimport { handleAction } from \"../common/handle-action\";\nimport { hasAction } from \"../common/has-action\";\nimport { hasConfigOrEntityChanged } from \"../common/has-changed\";\nimport { createEntityNotFoundWarning } from \"../components/hui-warning\";\nimport { LovelaceRow } from \"./types\";\n\n@customElement(\"hui-input-select-entity-row\")\nclass HuiInputSelectEntityRow extends LitElement implements LovelaceRow {\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @state() private _config?: EntitiesCardEntityConfig;\n\n  public setConfig(config: EntitiesCardEntityConfig): void {\n    if (!config || !config.entity) {\n      throw new Error(\"Entity must be specified\");\n    }\n\n    this._config = config;\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues): boolean {\n    return hasConfigOrEntityChanged(this, changedProps);\n  }\n\n  protected render(): TemplateResult {\n    if (!this.hass || !this._config) {\n      return html``;\n    }\n\n    const stateObj = this.hass.states[this._config.entity] as\n      | InputSelectEntity\n      | undefined;\n\n    if (!stateObj) {\n      return html`\n        <hui-warning>\n          ${createEntityNotFoundWarning(this.hass, this._config.entity)}\n        </hui-warning>\n      `;\n    }\n\n    const pointer =\n      (this._config.tap_action && this._config.tap_action.action !== \"none\") ||\n      (this._config.entity &&\n        !DOMAINS_HIDE_MORE_INFO.includes(computeDomain(this._config.entity)));\n\n    return html`\n      <state-badge\n        .stateObj=${stateObj}\n        .stateColor=${this._config.state_color}\n        .overrideIcon=${this._config.icon}\n        .overrideImage=${this._config.image}\n        class=${classMap({\n          pointer,\n        })}\n        @action=${this._handleAction}\n        .actionHandler=${actionHandler({\n          hasHold: hasAction(this._config!.hold_action),\n          hasDoubleClick: hasAction(this._config!.double_tap_action),\n        })}\n        tabindex=${ifDefined(pointer ? \"0\" : undefined)}\n      ></state-badge>\n      <ha-paper-dropdown-menu\n        .label=${this._config.name || computeStateName(stateObj)}\n        .value=${stateObj.state}\n        .disabled=${UNAVAILABLE_STATES.includes(stateObj.state)}\n        @iron-select=${this._selectedChanged}\n        @click=${stopPropagation}\n      >\n        <paper-listbox slot=\"dropdown-content\">\n          ${stateObj.attributes.options\n            ? stateObj.attributes.options.map(\n                (option) => html` <paper-item>${option}</paper-item> `\n              )\n            : \"\"}\n        </paper-listbox>\n      </ha-paper-dropdown-menu>\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    super.updated(changedProps);\n\n    if (!this.hass || !this._config) {\n      return;\n    }\n\n    const stateObj = this.hass.states[this._config.entity] as\n      | InputSelectEntity\n      | undefined;\n\n    if (!stateObj) {\n      return;\n    }\n\n    // Update selected after rendering the items or else it won't work in Firefox\n    if (stateObj.attributes.options) {\n      this.shadowRoot!.querySelector(\"paper-listbox\")!.selected =\n        stateObj.attributes.options.indexOf(stateObj.state);\n    }\n  }\n\n  private _handleAction(ev: ActionHandlerEvent) {\n    handleAction(this, this.hass!, this._config!, ev.detail.action!);\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: flex;\n        align-items: center;\n      }\n      ha-paper-dropdown-menu {\n        margin-left: 16px;\n        flex: 1;\n      }\n      paper-item {\n        cursor: pointer;\n        min-width: 200px;\n      }\n      .pointer {\n        cursor: pointer;\n      }\n      state-badge:focus {\n        outline: none;\n        background: var(--divider-color);\n        border-radius: 100%;\n      }\n    `;\n  }\n\n  private _selectedChanged(ev): void {\n    const stateObj = this.hass!.states[this._config!.entity];\n    const option = ev.target.selectedItem.innerText.trim();\n    if (option === stateObj.state) {\n      return;\n    }\n\n    forwardHaptic(\"light\");\n\n    setInputSelectOption(this.hass!, stateObj.entity_id, option);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-input-select-entity-row\": HuiInputSelectEntityRow;\n  }\n}\n"],"names":[],"sourceRoot":""}