{"version":3,"file":"9f8a8a7d.js","mappings":";AA+YA;AACA;AAPA;;;;AApBA","sources":["webpack://home-assistant-frontend/./src/components/ha-icon.ts"],"sourcesContent":["import \"@polymer/iron-icon/iron-icon\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { debounce } from \"../common/util/debounce\";\nimport { CustomIcon, customIconsets } from \"../data/custom_iconsets\";\nimport {\n  checkCacheVersion,\n  Chunks,\n  findIconChunk,\n  getIcon,\n  Icons,\n  MDI_PREFIXES,\n  writeCache,\n} from \"../data/iconsets\";\nimport \"./ha-svg-icon\";\n\ninterface DeprecatedIcon {\n  [key: string]: {\n    removeIn: string;\n    newName?: string;\n  };\n}\n\nconst mdiDeprecatedIcons: DeprecatedIcon = {\n  \"adobe-acrobat\": {\n    removeIn: \"2021.12\",\n  },\n  adobe: {\n    removeIn: \"2021.12\",\n  },\n  \"amazon-alexa\": {\n    removeIn: \"2021.12\",\n  },\n  amazon: {\n    removeIn: \"2021.12\",\n  },\n  \"android-auto\": {\n    removeIn: \"2021.12\",\n  },\n  \"android-debug-bridge\": {\n    removeIn: \"2021.12\",\n  },\n  \"apple-airplay\": {\n    newName: \"cast-variant\",\n    removeIn: \"2021.12\",\n  },\n  application: {\n    newName: \"application-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"application-cog\": {\n    newName: \"application-cog-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"application-settings\": {\n    newName: \"application-settings-outline\",\n    removeIn: \"2021.12\",\n  },\n  bandcamp: {\n    removeIn: \"2021.12\",\n  },\n  battlenet: {\n    removeIn: \"2021.12\",\n  },\n  blogger: {\n    removeIn: \"2021.12\",\n  },\n  \"bolnisi-cross\": {\n    newName: \"cross-bolnisi\",\n    removeIn: \"2021.12\",\n  },\n  \"boom-gate-up\": {\n    newName: \"boom-gate-arrow-up\",\n    removeIn: \"2021.12\",\n  },\n  \"boom-gate-up-outline\": {\n    newName: \"boom-gate-arrow-up-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"boom-gate-down\": {\n    newName: \"boom-gate-arrow-down\",\n    removeIn: \"2021.12\",\n  },\n  \"boom-gate-down-outline\": {\n    newName: \"boom-gate-arrow-down-outline\",\n    removeIn: \"2021.12\",\n  },\n  buddhism: {\n    newName: \"dharmachakra\",\n    removeIn: \"2021.12\",\n  },\n  buffer: {\n    removeIn: \"2021.12\",\n  },\n  \"cash-usd-outline\": {\n    removeIn: \"2021.12\",\n  },\n  \"cash-usd\": {\n    removeIn: \"2021.12\",\n  },\n  \"cellphone-android\": {\n    newName: \"cellphone\",\n    removeIn: \"2021.12\",\n  },\n  \"cellphone-erase\": {\n    newName: \"cellphone-remove\",\n    removeIn: \"2021.12\",\n  },\n  \"cellphone-iphone\": {\n    newName: \"cellphone\",\n    removeIn: \"2021.12\",\n  },\n  \"celtic-cross\": {\n    newName: \"cross-celtic\",\n    removeIn: \"2021.12\",\n  },\n  christianity: {\n    newName: \"cross\",\n    removeIn: \"2021.12\",\n  },\n  \"christianity-outline\": {\n    newName: \"cross-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"concourse-ci\": {\n    removeIn: \"2021.12\",\n  },\n  \"currency-usd-circle\": {\n    removeIn: \"2021.12\",\n  },\n  \"currency-usd-circle-outline\": {\n    removeIn: \"2021.12\",\n  },\n  \"do-not-disturb-off\": {\n    newName: \"minus-circle-off\",\n    removeIn: \"2021.12\",\n  },\n  \"do-not-disturb\": {\n    newName: \"minus-circle\",\n    removeIn: \"2021.12\",\n  },\n  douban: {\n    removeIn: \"2021.12\",\n  },\n  face: {\n    newName: \"face-man\",\n    removeIn: \"2021.12\",\n  },\n  \"face-outline\": {\n    newName: \"face-man-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"face-profile-woman\": {\n    newName: \"face-woman-profile\",\n    removeIn: \"2021.12\",\n  },\n  \"face-shimmer\": {\n    newName: \"face-man-shimmer\",\n    removeIn: \"2021.12\",\n  },\n  \"face-shimmer-outline\": {\n    newName: \"face-man-shimmer-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"file-pdf\": {\n    newName: \"file-pdf-box\",\n    removeIn: \"2021.12\",\n  },\n  \"file-pdf-outline\": {\n    newName: \"file-pdf-box\",\n    removeIn: \"2021.12\",\n  },\n  \"file-pdf-box-outline\": {\n    newName: \"file-pdf-box\",\n    removeIn: \"2021.12\",\n  },\n  \"flash-circle\": {\n    newName: \"lightning-bolt-circle\",\n    removeIn: \"2021.12\",\n  },\n  \"floor-lamp-variant\": {\n    newName: \"floor-lamp-torchiere-variant\",\n    removeIn: \"2021.12\",\n  },\n  gif: {\n    newName: \"file-gif-box\",\n    removeIn: \"2021.12\",\n  },\n  \"google-photos\": {\n    removeIn: \"2021.12\",\n  },\n  gradient: {\n    newName: \"gradient-vertical\",\n    removeIn: \"2021.12\",\n  },\n  hand: {\n    newName: \"hand-front-right\",\n    removeIn: \"2021.12\",\n  },\n  \"hand-left\": {\n    newName: \"hand-back-left\",\n    removeIn: \"2021.12\",\n  },\n  \"hand-right\": {\n    newName: \"hand-back-right\",\n    removeIn: \"2021.12\",\n  },\n  hinduism: {\n    newName: \"om\",\n    removeIn: \"2021.12\",\n  },\n  \"home-currency-usd\": {\n    removeIn: \"2021.12\",\n  },\n  iframe: {\n    newName: \"application-brackets\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-outline\": {\n    newName: \"application-brackets-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-array\": {\n    newName: \"application-array\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-array-outline\": {\n    newName: \"application-array-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-braces\": {\n    newName: \"application-braces\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-braces-outline\": {\n    newName: \"application-braces-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-parentheses\": {\n    newName: \"application-parentheses\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-parentheses-outline\": {\n    newName: \"application-parentheses-outline\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-variable\": {\n    newName: \"application-variable\",\n    removeIn: \"2021.12\",\n  },\n  \"iframe-variable-outline\": {\n    newName: \"application-variable-outline\",\n    removeIn: \"2021.12\",\n  },\n  islam: {\n    newName: \"star-crescent\",\n    removeIn: \"2021.12\",\n  },\n  judaism: {\n    newName: \"star-david\",\n    removeIn: \"2021.12\",\n  },\n  \"laptop-chromebook\": {\n    newName: \"laptop\",\n    removeIn: \"2021.12\",\n  },\n  \"laptop-mac\": {\n    newName: \"laptop\",\n    removeIn: \"2021.12\",\n  },\n  \"laptop-windows\": {\n    newName: \"laptop\",\n    removeIn: \"2021.12\",\n  },\n  \"microsoft-edge-legacy\": {\n    removeIn: \"2021.12\",\n  },\n  \"microsoft-yammer\": {\n    removeIn: \"2021.12\",\n  },\n  \"monitor-clean\": {\n    newName: \"monitor-shimmer\",\n    removeIn: \"2021.12\",\n  },\n  \"pdf-box\": {\n    newName: \"file-pdf-box\",\n    removeIn: \"2021.12\",\n  },\n  pharmacy: {\n    newName: \"mortar-pestle-plus\",\n    removeIn: \"2021.12\",\n  },\n  \"plus-one\": {\n    newName: \"numeric-positive-1\",\n    removeIn: \"2021.12\",\n  },\n  \"poll-box\": {\n    newName: \"chart-box\",\n    removeIn: \"2021.12\",\n  },\n  \"poll-box-outline\": {\n    newName: \"chart-box-outline\",\n    removeIn: \"2021.12\",\n  },\n  sparkles: {\n    newName: \"shimmer\",\n    removeIn: \"2021.12\",\n  },\n  \"tablet-ipad\": {\n    newName: \"tablet\",\n    removeIn: \"2021.12\",\n  },\n  teach: {\n    newName: \"human-male-board\",\n    removeIn: \"2021.12\",\n  },\n  telegram: {\n    removeIn: \"2021.12\",\n  },\n  \"television-clean\": {\n    newName: \"television-shimmer\",\n    removeIn: \"2021.12\",\n  },\n  \"text-subject\": {\n    newName: \"text-long\",\n    removeIn: \"2021.12\",\n  },\n  \"twitter-retweet\": {\n    newName: \"repeat-variant\",\n    removeIn: \"2021.12\",\n  },\n  untappd: {\n    removeIn: \"2021.12\",\n  },\n  vk: {\n    removeIn: \"2021.12\",\n  },\n  \"voice-off\": {\n    newName: \"account-voice-off\",\n    removeIn: \"2021.12\",\n  },\n  \"xamarian-outline\": {\n    newName: \"xamarian\",\n    removeIn: \"2021.12\",\n  },\n  xing: {\n    removeIn: \"2021.12\",\n  },\n  \"y-combinator\": {\n    removeIn: \"2021.12\",\n  },\n};\n\nconst chunks: Chunks = {};\n\n// Supervisor doesn't use icons, and should not update/downgrade the icon DB.\nif (!__SUPERVISOR__) {\n  checkCacheVersion();\n}\n\nconst debouncedWriteCache = debounce(() => writeCache(chunks), 2000);\n\nconst cachedIcons: Record<string, string> = {};\n\n@customElement(\"ha-icon\")\nexport class HaIcon extends LitElement {\n  @property() public icon?: string;\n\n  @state() private _path?: string;\n\n  @state() private _viewBox?;\n\n  @state() private _legacy = false;\n\n  public willUpdate(changedProps: PropertyValues) {\n    super.willUpdate(changedProps);\n    if (changedProps.has(\"icon\")) {\n      this._path = undefined;\n      this._viewBox = undefined;\n      this._loadIcon();\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (!this.icon) {\n      return html``;\n    }\n    if (this._legacy) {\n      return html`<iron-icon .icon=${this.icon}></iron-icon>`;\n    }\n    return html`<ha-svg-icon\n      .path=${this._path}\n      .viewBox=${this._viewBox}\n    ></ha-svg-icon>`;\n  }\n\n  private async _loadIcon() {\n    if (!this.icon) {\n      return;\n    }\n    const [iconPrefix, origIconName] = this.icon.split(\":\", 2);\n\n    let iconName = origIconName;\n\n    if (!iconPrefix || !iconName) {\n      return;\n    }\n\n    if (!MDI_PREFIXES.includes(iconPrefix)) {\n      if (iconPrefix in customIconsets) {\n        const customIconset = customIconsets[iconPrefix];\n        if (customIconset) {\n          this._setCustomPath(customIconset(iconName));\n        }\n        return;\n      }\n      this._legacy = true;\n      return;\n    }\n\n    this._legacy = false;\n\n    if (iconName in mdiDeprecatedIcons) {\n      const deprecatedIcon = mdiDeprecatedIcons[iconName];\n      let message: string;\n\n      if (deprecatedIcon.newName) {\n        message = `Icon ${iconPrefix}:${iconName} was renamed to ${iconPrefix}:${deprecatedIcon.newName}, please change your config, it will be removed in version ${deprecatedIcon.removeIn}.`;\n        iconName = deprecatedIcon.newName!;\n      } else {\n        message = `Icon ${iconPrefix}:${iconName} was removed from MDI, please replace this icon with an other icon in your config, it will be removed in version ${deprecatedIcon.removeIn}.`;\n      }\n      // eslint-disable-next-line no-console\n      console.warn(message);\n      fireEvent(this, \"write_log\", {\n        level: \"warning\",\n        message,\n      });\n    }\n\n    if (iconName in cachedIcons) {\n      this._path = cachedIcons[iconName];\n      return;\n    }\n\n    let databaseIcon: string | undefined;\n    try {\n      databaseIcon = await getIcon(iconName);\n    } catch (_err) {\n      // Firefox in private mode doesn't support IDB\n      // iOS Safari sometimes doesn't open the DB\n      databaseIcon = undefined;\n    }\n\n    if (databaseIcon) {\n      this._path = databaseIcon;\n      cachedIcons[iconName] = databaseIcon;\n      return;\n    }\n    const chunk = findIconChunk(iconName);\n\n    if (chunk in chunks) {\n      this._setPath(chunks[chunk], iconName);\n      return;\n    }\n\n    const iconPromise = fetch(`/static/mdi/${chunk}.json`).then((response) =>\n      response.json()\n    );\n    chunks[chunk] = iconPromise;\n    this._setPath(iconPromise, iconName);\n    debouncedWriteCache();\n  }\n\n  private async _setCustomPath(promise: Promise<CustomIcon>) {\n    const icon = await promise;\n    this._path = icon.path;\n    this._viewBox = icon.viewBox;\n  }\n\n  private async _setPath(promise: Promise<Icons>, iconName: string) {\n    const iconPack = await promise;\n    this._path = iconPack[iconName];\n    cachedIcons[iconName] = iconPack[iconName];\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        fill: currentcolor;\n      }\n    `;\n  }\n}\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon\": HaIcon;\n  }\n}\n"],"names":[],"sourceRoot":""}