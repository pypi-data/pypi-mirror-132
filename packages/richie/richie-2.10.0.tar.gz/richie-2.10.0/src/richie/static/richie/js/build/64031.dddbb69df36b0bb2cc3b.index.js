"use strict";(self.webpackChunkrichie_education=self.webpackChunkrichie_education||[]).push([[64031],{64031:function(e,n,r){r.r(n),r.d(n,{default:function(){return A}}),r(80044),r(26364),r(19701),r(10853),r(80238),r(6208),r(12938),r(86632),r(61928),r(54883),r(45007),r(68995),r(18821),r(54994),r(4845),r(39275),r(35054),r(32390);var t,o=r(89526),u=r(34323),l=r(38136),s=r(64968);!function(e){e[e.ONGOING_OPEN=0]="ONGOING_OPEN",e[e.FUTURE_OPEN=1]="FUTURE_OPEN",e[e.ARCHIVED_OPEN=2]="ARCHIVED_OPEN",e[e.FUTURE_NOT_YET_OPEN=3]="FUTURE_NOT_YET_OPEN",e[e.FUTURE_CLOSED=4]="FUTURE_CLOSED",e[e.ONGOING_CLOSED=5]="ONGOING_CLOSED",e[e.ARCHIVED_CLOSED=6]="ARCHIVED_CLOSED",e[e.TO_BE_SCHEDULED=7]="TO_BE_SCHEDULED"}(t||(t={}));var a=r(83560),i=(r(55862),r(5615)),c=(r(42900),r(72975),r(33290),r(78024)),d=r(80042),f=r(15799),E=r(22820),p=r(95411),m=c.Z.lms_backends||[];function O(e,n,r,t,o,u,l){try{var s=e[u](l),a=s.value}catch(e){return void r(e)}s.done?n(a):Promise.resolve(a).then(t,o)}function v(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var u=e.apply(n,r);function l(e){O(u,t,o,l,s,"next",e)}function s(e){O(u,t,o,l,s,"throw",e)}l(void 0)}))}}var N=function(e){var n,r,t,o=function(e){var n=function(e){return m.find((function(n){return new RegExp(n.course_regexp).test(e)}))}(e);switch(null==n?void 0:n.backend){case d.m.BASE:return(0,f.Z)(n);case d.m.OPENEDX_DOGWOOD:return(0,E.Z)(n);case d.m.OPENEDX_HAWTHORN:return(0,p.Z)(n)}var r=new Error("No LMS Backend found for ".concat(e,"."));throw(0,a.p)(r),r}(e);return{get:(t=v(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",o.enrollment.get(e,r));case 1:case"end":return n.stop()}}),n)}))),function(e){return t.apply(this,arguments)}),isEnrolled:(r=v(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.enrollment.isEnrolled(n));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),set:(n=v(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",o.enrollment.set(e,r));case 1:case"end":return n.stop()}}),n)}))),function(e){return n.apply(this,arguments)})}};function _(e,n,r,t,o,u,l){try{var s=e[u](l),a=s.value}catch(e){return void r(e)}s.done?n(a):Promise.resolve(a).then(t,o)}function h(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var u=e.apply(n,r);function l(e){_(u,t,o,l,s,"next",e)}function s(e){_(u,t,o,l,s,"throw",e)}l(void 0)}))}}var R=r(67557);function y(e,n,r,t,o,u,l){try{var s=e[u](l),a=s.value}catch(e){return void r(e)}s.done?n(a):Promise.resolve(a).then(t,o)}function L(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var u=e.apply(n,r);function l(e){y(u,t,o,l,s,"next",e)}function s(e){y(u,t,o,l,s,"throw",e)}l(void 0)}))}}function g(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function x(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function b(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?x(Object(r),!0).forEach((function(n){D(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function D(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var w,C,j=(0,u.vU)({enroll:{id:"components.CourseRunEnrollment.enroll",defaultMessage:[{type:0,value:"Enroll now"}]},enrolled:{id:"components.CourseRunEnrollment.enrolled",defaultMessage:[{type:0,value:"You are enrolled in this course run"}]},enrollmentClosed:{id:"components.CourseRunEnrollment.enrollmentClosed",defaultMessage:[{type:0,value:"Enrollment in this course run is closed at the moment"}]},enrollmentFailed:{id:"components.CourseRunEnrollment.enrollmentFailed",defaultMessage:[{type:0,value:"Your enrollment request failed."}]},goToCourse:{id:"components.CourseRunEnrollment.goToCourse",defaultMessage:[{type:0,value:"Go to course"}]},loadingInitial:{id:"components.CourseRunEnrollment.loadingInitial",defaultMessage:[{type:0,value:"Loading enrollment information..."}]},loginToEnroll:{id:"components.CourseRunEnrollment.loginToEnroll",defaultMessage:[{type:0,value:"Log in to enroll"}]}});!function(e){e.ANONYMOUS="anonymous",e.CLOSED="closed",e.LOADING="loading",e.ENROLLED="enrolled",e.ENROLLING="enrolling",e.ENROLLMENT_FAILED="enrollmentFailed",e.FAILED="failed",e.IDLE="idle"}(w||(w={})),function(e){e.UPDATE_CONTEXT="UPDATE_CONTEXT",e.ENROLL="ENROLL",e.ERROR="ERROR"}(C||(C={}));var T=function(e,n){var r=e.currentUser,o=e.courseRun,u=e.isEnrolled;switch(!0){case o.priority>t.ARCHIVED_OPEN:return w.CLOSED;case n===w.ENROLLING&&!u:return w.ENROLLMENT_FAILED;case null===r:return w.ANONYMOUS;case void 0===r||void 0===o||void 0===u:return w.LOADING;case!!u:return w.ENROLLED;case!u:return w.IDLE;default:throw new Error("Impossible state")}},I=function(e,n){var r=e.step,t=e.context;switch(n.type){case C.UPDATE_CONTEXT:var o=b(b({},t),n.payload);return{step:T(o,r),context:o};case C.ENROLL:return{step:w.ENROLLING,context:t};case C.ERROR:return b({step:w.FAILED,context:t},n.payload);default:return{step:r,context:t}}},A=function(e){var n,r,t=(0,s.kP)(),c=t.user,d=t.login,f=function(e){var n=(0,s.kP)().user,r=["enrollment",e],t=(0,i.useQueryClient)(),o=N(e),u=(0,i.useQuery)(r,h(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.get(n));case 1:case"end":return e.stop()}}),e)}))),{enabled:!!n}).data,l=(0,i.useQuery)([].concat(r,["is_active"]),h(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.isEnrolled(u));case 1:case"end":return e.stop()}}),e)}))),{enabled:void 0!==u}).data,a=(0,i.useMutation)((function(){return o.set(n)}),{mutationKey:r,onSuccess:function(){t.invalidateQueries(r)}}).mutateAsync;return{enrollment:u,enrollmentIsActive:l,setEnrollment:a}}(e.courseRun.resource_link),E=f.enrollmentIsActive,p=f.setEnrollment,m=(n=(0,o.useReducer)(I,function(e,n,r){return{step:T({currentUser:e,courseRun:n,isEnrolled:r}),context:{currentUser:e,courseRun:n,isEnrolled:r}}}(c,e.courseRun,E),(function(e){return e})),r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,u=[],l=!0,s=!1;try{for(r=r.call(e);!(l=(t=r.next()).done)&&(u.push(t.value),!n||u.length!==n);l=!0);}catch(e){s=!0,o=e}finally{try{l||null==r.return||r.return()}finally{if(s)throw o}}return u}}(n,r)||function(e,n){if(e){if("string"==typeof e)return g(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),O=m[0],v=O.context,_=v.currentUser,y=v.courseRun,x=O.error,D=O.step,A=m[1],P=(0,o.useCallback)(L(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A({type:C.ENROLL}),!y||!_){e.next=6;break}return e.next=4,p();case 4:n=e.sent,A({type:C.UPDATE_CONTEXT,payload:{isEnrolled:n}});case 6:case"end":return e.stop()}}),e)}))),[y,_,A]);switch((0,o.useEffect)((function(){A({payload:{currentUser:c,isEnrolled:E},type:C.UPDATE_CONTEXT})}),[c,E]),!0){case D===w.CLOSED:return(0,R.jsx)("div",{className:"course-run-enrollment__helptext",children:(0,R.jsx)(u._H,b({},j.enrollmentClosed))});case D===w.ANONYMOUS:return(0,R.jsx)("button",{onClick:d,className:"course-run-enrollment__cta",children:(0,R.jsx)(u._H,b({},j.loginToEnroll))});case D===w.LOADING:return(0,R.jsx)(l.$,{size:"small","aria-labelledby":"loading-course-run-".concat(y.id),children:(0,R.jsx)("span",{id:"loading-course-run-".concat(y.id),children:(0,R.jsx)(u._H,b({},j.loadingInitial))})});case D===w.IDLE:case D===w.ENROLLING:case D===w.ENROLLMENT_FAILED:return(0,R.jsxs)(o.Fragment,{children:[(0,R.jsxs)("button",{onClick:P,className:"course-run-enrollment__cta ".concat(D===w.ENROLLING?"course-run-enrollment__cta--loading":""),"aria-busy":D===w.ENROLLING,children:[(0,R.jsx)(u._H,b({},j.enroll)),D===w.ENROLLING?(0,R.jsx)("span",{"aria-hidden":"true",children:(0,R.jsx)(l.$,{})}):null]}),D===w.ENROLLMENT_FAILED?(0,R.jsx)("div",{className:"course-run-enrollment__errortext",children:(0,R.jsx)(u._H,b({},j.enrollmentFailed))}):null]});case D===w.ENROLLED:return y.starts_in_message?(0,R.jsxs)("div",{children:[y.dashboard_link?(0,R.jsx)("a",{href:y.dashboard_link,className:"course-run-enrollment__cta",children:(0,R.jsx)(u._H,b({},j.enrolled))}):(0,R.jsx)("p",{className:"course-run-enrollment__helptext",children:(0,R.jsx)(u._H,b({},j.enrolled))}),(0,R.jsx)("p",{className:"course-run-enrollment__helptext",children:y.starts_in_message})]}):(0,R.jsxs)("div",{children:[(0,R.jsx)("a",{href:y.resource_link,className:"course-run-enrollment__cta",children:(0,R.jsx)(u._H,b({},j.goToCourse))}),(0,R.jsx)("div",{className:"course-run-enrollment__helptext",children:(0,R.jsx)(u._H,b({},j.enrolled))})]})}return D===w.FAILED&&x?(0,a.p)(x):(0,a.p)(new Error("<CourseRunEnrollment /> in an impossible state, ".concat(JSON.stringify(D)))),null}},42900:function(e,n,r){var t=r(19882),o=r(68671).find,u=r(6677),l="find",s=!0;l in[]&&Array(1).find((function(){s=!1})),t({target:"Array",proto:!0,forced:s},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),u(l)}}]);
//# sourceMappingURL=64031.dddbb69df36b0bb2cc3b.index.js.map