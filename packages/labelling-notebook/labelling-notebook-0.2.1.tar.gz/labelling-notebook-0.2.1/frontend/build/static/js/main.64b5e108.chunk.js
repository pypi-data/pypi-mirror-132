(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{185:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),i=t(26),o=t.n(i),c=t(82),l=t(6),u=t(22),d=t(7),s=t(5),h=t(9),g=t(8),f=(t(60),t(103),t(74)),m=t.n(f),b=t(50),v=t.n(b),p=t(76),x=t(54),E=function(){return fetch.apply(void 0,arguments).then((function(e){return e.ok?e.json():null}))};var w,O,j,y,k,S,z=t(37),C=g.a.div(w||(w=Object(d.a)(["\n    padding: 0;\n    overflow-y: scroll;\n    \n    div.rendered-react-keyed-file-browser {\n        .action-bar { \n            display: none;\n        }\n    \n        .files {\n            .name svg {\n                margin-right: 0.3em;\n                margin-top:-0.2em;\n            }\n            \n            \n            table tr td:last-child,\n            table tr th:last-child {\n                display: none;\n            }\n            \n            table tr:not(:last-child) td,\n            table tr {\n                border: none;\n                td { border: none; }\n                th { border: none; }\n            }\n        }\n    }\n"])));function L(e){var n=Object(x.a)("/api/files",E).data,t=n||[];return r.a.createElement(C,null,r.a.createElement(m.a,{files:t,filterRenderer:function(){return r.a.createElement("div",null)},detailRenderer:function(){return r.a.createElement("div",null)},icons:{Image:r.a.createElement(z.c,null),Folder:r.a.createElement(z.a,null),FolderOpen:r.a.createElement(z.b,null)},onSelect:function(n){if(console.log(n),n)return e.onSelectImage?e.onSelectImage(n.key):null}}))}var M,R,A,P,T=function(e){var n=e.leftPane,t=e.rightPane,i=e.className,o=e.componentsSize,c=e.onComponentsResize,l=e.children,u=Object(a.createRef)(),d=Object(a.useState)(null),g=Object(h.a)(d,2),f=g[0],m=g[1],b=o.left.width,v=o.right.width,p=function(e){if(f&&u.current){var n=b,t=v;"leftPane"==f.resizingTarget&&(n=b+e-f.xPosition),"rightPane"==f.resizingTarget&&(t=v-e+f.xPosition),x(n,t),m(Object(s.a)(Object(s.a)({},f),{},{xPosition:e}))}},x=function(e,n){if(u.current){var t=u.current.clientHeight,a=u.current.clientWidth;c&&c({left:{height:t,width:e},center:{height:t,width:a-n-e},right:{height:t,width:n}})}},E=function(e){e.preventDefault(),p(e.clientX)},w=function(e){p(e.touches[0].clientX)},O=function(){m(null)};return r.a.useEffect((function(){return document.addEventListener("mousemove",E),document.addEventListener("touchmove",w),document.addEventListener("mouseup",O),function(){document.removeEventListener("mousemove",E),document.removeEventListener("touchmove",w),document.removeEventListener("mouseup",O)}})),Object(a.useLayoutEffect)((function(){if(u.current){var e=function(){return window.requestAnimationFrame((function(){return x(b,v)}))};return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e),function(){window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}}}),[u]),r.a.createElement(W,{className:"".concat(null!==i&&void 0!==i?i:""),ref:u},r.a.createElement(X,{width:b,setWidth:function(e){return x(e,v)}},n),r.a.createElement(D,{onDraggingStart:function(e){return m({xPosition:e,resizingTarget:"leftPane"})},onDraggingEnd:function(){return m(null)}}),r.a.createElement(J,null,l),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(D,{onDraggingStart:function(e){return m({xPosition:e,resizingTarget:"rightPane"})},onDraggingEnd:function(){return m(null)}}),r.a.createElement(X,{width:v,setWidth:function(e){return x(b,e)}},t)))},D=function(e){var n=e.onDraggingStart,t=e.onDraggingEnd;return r.a.createElement(N,{onMouseDown:function(e){return n(e.clientX)},onTouchStart:function(e){return n(e.touches[0].clientX)},onTouchEnd:t},r.a.createElement(F,null))},X=function(e){var n=e.children,t=e.width,i=e.setWidth,o=Object(a.createRef)();return Object(a.useEffect)((function(){if(o.current){if(!t)return void i(o.current.clientWidth);o.current.style.width="".concat(t,"px")}}),[o,t,i]),r.a.createElement(I,{ref:o},n)},N=g.a.div(O||(O=Object(d.a)(["\n  cursor: col-resize;\n  align-self: stretch;\n  display: flex;\n  align-items: center;\n"]))),F=g.a.div(j||(j=Object(d.a)(["\n  height: 100%;\n  border: 1px solid #ddd;\n"]))),I=g.a.div(y||(y=Object(d.a)(["\n  overflow: hidden;\n  height: 100%;\n"]))),J=g.a.div(k||(k=Object(d.a)(["\n  flex: 1;\n  height: 100%;\n  overflow-x: hidden;\n"]))),W=g.a.div(S||(S=Object(d.a)([" {\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n"]))),Y=t(79),B=t.n(Y),U=t(80),q=t.n(U),H=(t(159),t(160),t(84)),_=t(189);function G(e){var n=e.imageInfo,t=e.tags,i=e.annotations,o=e.selectedAnnotation,c=e.onSelectAnnotation,l=e.onChangeTags,u=e.onChangeAnnotations,d=function(e,n){var t=e.map((function(e){return{value:e,label:e}}));return[t,function(e){if(n){var t=e.map((function(e){return e.value}));n(t)}}]}(t,l),g=Object(h.a)(d,2),f=g[0],m=g[1],b=function(e,n){var t=Object(a.useMemo)((function(){return e.map((function(e){var n=Object(s.a)({},e),t='{\n  "x":'.concat(e.x,', "y":').concat(e.y,', "width":').concat(e.width,', "height":').concat(e.height,",\n");return delete n.color,delete n.x,delete n.y,delete n.width,delete n.height,JSON.stringify(n,null,2).replace("{",t).replace("\n\n","\n")}))}),[e]),i=Object(a.useState)(t),o=Object(h.a)(i,2),c=o[0],l=o[1];r.a.useEffect((function(){l(t)}),[t]);return[c,function(e,n){c[e]=n,l(c)},function(e){c[e]=t[e],l(c)},function(t){var a=JSON.parse(c[t]);if(a&&n){var r=e.slice();r[t]=a,n(r)}}]}(i,u),v=Object(h.a)(b,4),p=v[0],x=v[1],E=v[2],w=v[3],O=function(e){c&&o===e&&c(void 0)};return r.a.createElement(V,null,n&&r.a.createElement(Z,null,r.a.createElement("h4",null,n.name),r.a.createElement("p",null,n.width," x ",n.height)),r.a.createElement($,null,r.a.createElement("h5",null,"Tags:"),r.a.createElement(H.a,{isMulti:!0,value:f,onChange:function(e){return m(e)},formatCreateLabel:function(e){return'Add tag "'.concat(e,'"')}})),r.a.createElement($,null,r.a.createElement("h5",null,"Annotations:"),i.map((function(e,n){return r.a.createElement(B.a,{key:n,trigger:r.a.createElement("div",null,r.a.createElement(ee,{style:{backgroundColor:e.color||"white"}}),r.a.createElement("span",null,"Annotation (at ",r.a.createElement("i",null,"x=",e.x),", ",r.a.createElement("i",null,"y=",e.y,")"))),transitionTime:100,openedClassName:"open",open:o===n,onOpening:function(){return function(e){c&&c(e)}(n)},onClosing:function(){O(n),E(n)}},p[n]&&r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{value:p[n],mode:"json",theme:"github",width:"100%",height:"".concat(20*p[n].split("\n").length,"px"),onChange:function(e){return x(n,e)},cursorStart:p[n].length-1}),r.a.createElement(_.a,{size:"sm",variant:"primary",disabled:!K(p[n]),onClick:function(){O(n),w(n)}},"Save")))}))))}function K(e){try{JSON.parse(e)}catch(n){return!1}return!0}var Q,V=g.a.div(M||(M=Object(d.a)(["\n    position: relative;\n    overflow-x: hidden;\n    height: 100%;\n    width: 100%;\n    \n    .Collapsible {\n    \n        padding: 0px;\n        \n        &:hover {\n            background: #eee;\n        }\n        \n        &.open {\n            background: #e8e8e8;\n        }\n        \n        >span {\n            width: 100%;\n            display: block;\n            margin-bottom: 5px;\n            padding: 8px 8px;\n        }\n        \n        >div {\n            padding: 0px 8px;\n        }\n        \n        button {\n            float: right;\n            margin: 8px 0px;\n        }\n    }\n"]))),Z=g.a.div(R||(R=Object(d.a)(["\n    padding: 20px 10px;\n    margin-bottom: 30px;\n    \n    color: rgba(200,200,200, 1);\n    background-color: rgba(17,24,39, 1);\n"]))),$=g.a.div(A||(A=Object(d.a)(["\n    padding: 10px;\n    margin-bottom: 20px;\n    color: rgba(17,24,39, 1);\n"]))),ee=g.a.span(P||(P=Object(d.a)(["\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 5px;\n    top: 3px;\n    position: relative;\n"]))),ne=t(23);function te(e,n){var t=n.x,a=n.y,r=n.width,i=n.height,o=e.scale,c=e.offset;return Object(s.a)(Object(s.a)({},n),{},{x:o*t+c.x,y:o*a+c.y,width:o*r,height:o*i})}function ae(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=n.x,r=n.y,i=n.width,o=n.height,c=e.scale,l=e.offset,u={x:(a-l.x)/c,y:(r-l.y)/c,width:i/c,height:o/c};return t?Object(s.a)(Object(s.a)({},n),{},{x:Math.round(u.x),y:Math.round(u.y),width:Math.round(u.width),height:Math.round(u.height)}):u}function re(e){var n=e.image,t=e.width,a=e.height,i=e.annotations,o=e.onChangeAnnotations,c=e.selectedAnnotation,l=e.onSelectAnnotation||function(e){},u=r.a.useState(null),d=Object(h.a)(u,2),g=d[0],f=d[1],m=r.a.useState(null),b=Object(h.a)(m,2),v=b[0],p=b[1];if(!n.element)return r.a.createElement(ie,null);var x={width:t,height:a},E=function(e,n){var t=e.width/n.width,a=n.height*t;return a<=e.height?{offset:{x:0,y:(e.height-a)/2},scale:t}:(t=e.height/n.height,{offset:{x:(e.width-n.width*t)/2,y:0},scale:t})}(x,n);return r.a.createElement(ie,null,r.a.createElement(ne.d,Object.assign({},x,{onMouseDown:function(e){(e.target===e.target.getStage()||e.target.image)&&(c&&c>=0?l(void 0):(f({x:e.evt.layerX,y:e.evt.layerY}),p({x:e.evt.layerX,y:e.evt.layerY})))},onMouseUp:function(e){if(g){f(null),p(null);var n=ce(g,v);if(n.width<10||n.height<10)return;var t=i.slice();t.push(ae(E,n)),o&&o(t),l(t.length-1)}},onMouseMove:function(e){g&&p({x:e.evt.layerX,y:e.evt.layerY})}}),r.a.createElement(ne.b,null,r.a.createElement(ne.a,Object.assign({image:n.element},te(E,Object(s.a)({x:0,y:0},n)))),i.map((function(e,n){var t=JSON.stringify(e);return r.a.createElement(oe,{key:t,color:e.color||"#00000ff",shapeProps:te(E,e),isSelected:n===c,onSelect:function(){l(n)},onChange:function(e){var t=i.slice();t[n]=ae(E,e),o&&o(t)}})})),g&&v&&r.a.createElement(ne.c,Object.assign({},ce(g,v),{fill:"rgba(1, 1,1,0.5)"})))))}var ie=g.a.div(Q||(Q=Object(d.a)(["\n    position: relative;\n    overflow-x: hidden;\n    height: 100%;\n    width: 100%;\n    background-color:#eee;\n"]))),oe=function(e){var n=e.shapeProps,t=e.color,a=e.isSelected,i=e.onSelect,o=e.onChange,c=r.a.useRef(),l=r.a.useRef();return r.a.useEffect((function(){a&&(l.current.nodes([c.current]),l.current.getLayer().batchDraw())}),[a]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.c,Object.assign({fill:t,opacity:.5,onClick:i,onTap:i,ref:c},n,{draggable:a,onDragEnd:function(e){o(Object(s.a)(Object(s.a)({},n),{},{x:e.target.x(),y:e.target.y()}))},onTransformEnd:function(e){var t=c.current,a=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),o(Object(s.a)(Object(s.a)({},n),{},{x:t.x(),y:t.y(),width:Math.max(5,t.width()*a),height:Math.max(t.height()*r)}))}})),a&&r.a.createElement(ne.e,{ref:l,rotateEnabled:!1,boundBoxFunc:function(e,n){return n.width<5||n.height<5?e:n}}))};function ce(e,n){var t=Math.min(e.x,n.x),a=Math.max(e.x,n.x),r=Math.min(e.y,n.y);return{x:t,y:r,width:a-t,height:Math.max(e.y,n.y)-r}}var le,ue,de,se,he,ge=t(52),fe=t.n(ge),me=[{lightness:.5,saturation:.7,hue:220},{lightness:.5,saturation:1,hue:200}];function be(){var e=Object(u.d)("key",u.c),n=Object(h.a)(e,2),t=n[0],i=n[1],o=Object(u.d)("index",u.a),c=Object(h.a)(o,2),l=c[0],d=c[1],g=function(e){var n=e?"/api/files/image/"+e:null,t=r.a.useState(null),a=Object(h.a)(t,2),i=a[0],o=a[1];return r.a.useEffect((function(){if(n){var e=document.createElement("img");return e.addEventListener("load",t),e.addEventListener("error",a),e.src=n,function(){e.removeEventListener("load",t),e.removeEventListener("error",a),o(null)}}function t(){o({element:e,width:e.width,height:e.height})}function a(){o(null)}}),[n]),[i]}(t),f=Object(h.a)(g,1)[0],m=function(e){var n=e?"/api/files/image_data/"+e:"",t=Object(x.a)(n,E),a=t.data,r=t.mutate;return[a,function(){var e=Object(p.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:"PUT",body:JSON.stringify(t)});case 2:a=e.sent,r(Object(s.a)(Object(s.a)({},t),a));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()]}(t),b=Object(h.a)(m,2),w=b[0],O=b[1],j=(null===w||void 0===w?void 0:w.annotations)||[],y=Object(a.useMemo)((function(){return j.map((function(e,n){var t=n===l?new fe.a(me[1]):new fe.a(me[0]);return Object(s.a)(Object(s.a)({},e),{},{color:t.hex("")})}))}),[w,l]),k=function(e){e.forEach((function(e){delete e.color})),O(Object(s.a)(Object(s.a)({},w),{},{annotations:e}))},S=(null===w||void 0===w?void 0:w.tags)||[],z=Object(a.useState)({left:{width:350,height:-1},right:{width:450,height:-1},center:{width:100,height:-1}}),C=Object(h.a)(z,2),M=C[0],R=C[1],A=function(e){e.target===document.body&&("Escape"===e.key&&d(void 0),"Backspace"===e.key&&(null!=l&&(j.splice(l,1),k(j)),d(void 0)))};return Object(a.useEffect)((function(){return window.addEventListener("keydown",A),function(){window.removeEventListener("keydown",A)}})),r.a.createElement(ve,null,r.a.createElement(T,{componentsSize:M,onComponentsResize:function(e){R(e)},leftPane:r.a.createElement(xe,null,r.a.createElement(L,{onSelectImage:function(e){i(e),d(null)}})),rightPane:f&&r.a.createElement(G,{imageInfo:{name:t||"",width:f.width,height:f.height},tags:S,onChangeTags:function(e){O(Object(s.a)(Object(s.a)({},w),{},{tags:e}))},annotations:y,selectedAnnotation:l,onSelectAnnotation:d,onChangeAnnotations:k})},f&&f.element&&r.a.createElement(pe,null,r.a.createElement(re,{width:M.center.width,height:M.center.height,image:f,annotations:y,selectedAnnotation:l,onSelectAnnotation:d,onChangeAnnotations:k}))))}var ve=g.a.div(le||(le=Object(d.a)(["\n    height: 100vh;\n    \n    .Resizer {\n      background: #000;\n      opacity: 0.2;\n      z-index: 1;\n      -moz-box-sizing: border-box;\n      -webkit-box-sizing: border-box;\n      box-sizing: border-box;\n      -moz-background-clip: padding;\n      -webkit-background-clip: padding;\n      background-clip: padding-box;\n    }\n      \n    .Resizer:hover {\n      -webkit-transition: all 2s ease;\n      transition: all 2s ease;\n    }\n    \n    .Resizer.horizontal {\n      height: 11px;\n      margin: -5px 0;\n      border-top: 5px solid rgba(255, 255, 255, 0);\n      border-bottom: 5px solid rgba(255, 255, 255, 0);\n      cursor: row-resize;\n      width: 100%;\n    }\n    \n    .Resizer.horizontal:hover {\n      border-top: 5px solid rgba(0, 0, 0, 0.5);\n      border-bottom: 5px solid rgba(0, 0, 0, 0.5);\n    }\n    \n    .Resizer.vertical {\n      width: 11px;\n      margin: 0 -5px;\n      border-left: 5px solid rgba(255, 255, 255, 0);\n      border-right: 5px solid rgba(255, 255, 255, 0);\n      cursor: col-resize;\n    }\n    \n    .Resizer.vertical:hover {\n      border-left: 5px solid rgba(0, 0, 0, 0.5);\n      border-right: 5px solid rgba(0, 0, 0, 0.5);\n    }\n    .Resizer.disabled {\n      cursor: not-allowed;\n    }\n    .Resizer.disabled:hover {\n      border-color: transparent;\n    }\n"]))),pe=(g.a.div(ue||(ue=Object(d.a)(["\n    height: 100%;\n"]))),g.a.div(de||(de=Object(d.a)(["\n    height: 100%;\n"])))),xe=(g.a.div(se||(se=Object(d.a)(["\n    height: 100%;\n"]))),g.a.div(he||(he=Object(d.a)(["\n    height: 100%;\n    overflow: scroll;\n    background-color: rgba(17,24,39, 1);\n    color: rgba(156,163,175, 1);\n    \n    .files {\n        tbody {\n            tr, tr a {\n                color: rgba(156,163,175, 1);\n            }\n            \n            tr:hover {\n                background-color: rgba(255, 255, 255, 0.05);\n            }\n            \n            tr.selected, tr.selected a {\n                rgba(229,231,235,1);\n                background-color: rgba(55,65,81,1);\n            }\n        }\n    }\n"]))));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c.a,null,r.a.createElement(u.b,{ReactRouterRoute:l.a},r.a.createElement(be,null)))),document.getElementById("root"))},88:function(e,n,t){e.exports=t(185)}},[[88,1,2]]]);
//# sourceMappingURL=main.64b5e108.chunk.js.map